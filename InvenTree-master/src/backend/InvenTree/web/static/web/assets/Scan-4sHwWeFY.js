import{r as p,K as Q,ag as V,ab as i,j as e,aE as B,av as U,aC as E,e as v,an as F,bz as R,ao as q,Q as P,N as j,c as b,d as z,ac as H,bX as L,al as Z,by as T,$ as M,S as A,aj as C,aq as G}from"./index-Db7AGPIq.js";import{R as O,k as D}from"./Filter-BgnAqEQC.js";import{a as W,aw as J,P as K,ax as X,S as _,ay as Y}from"./ThemeContext-CxdCkKtz.js";import{P as $}from"./PageTitle-B4iaHXKM.js";import{A as ee}from"./ActionButton-Cv5j5I5R.js";import{u as se,c as te,I as ae}from"./InvenTreeTable-DmN557zY.js";import{I as ne}from"./IconAlertCircle-DEV3UHRn.js";import"./DesktopAppView-BuH2j218.js";import"./IconChevronDown-CzbIU38Y.js";import"./index-DRtKJP-e.js";import"./QRCode-BaIEIQ2d.js";import"./browser-DSycY7kT.js";import"./IconDotsVertical-D8D3XsjG.js";import"./IconTags-DnGx22aA.js";function oe(d=[]){const[f,o]=p.useState(d);return[f,{setState:o,append:(...s)=>o(t=>[...t,...s]),prepend:(...s)=>o(t=>[...s,...t]),insert:(s,...t)=>o(c=>[...c.slice(0,s),...t,...c.slice(s)]),pop:()=>o(s=>{const t=[...s];return t.pop(),t}),shift:()=>o(s=>{const t=[...s];return t.shift(),t}),apply:s=>o(t=>t.map((c,n)=>s(c,n))),applyWhere:(s,t)=>o(c=>c.map((n,h)=>s(n,h)?t(n,h):n)),remove:(...s)=>o(t=>t.filter((c,n)=>!s.includes(n))),reorder:({from:s,to:t})=>o(c=>{const n=[...c],h=c[s];return n.splice(s,1),n.splice(t,0,h),n}),swap:({from:s,to:t})=>o(c=>{const n=[...c],h=n[s],N=n[t];return n.splice(t,1,h),n.splice(s,1,N),n}),setItem:(s,t)=>o(c=>{const n=[...c];return n[s]=t,n}),setItemProp:(s,t,c)=>o(n=>{const h=[...n];return h[s]={...h[s],[t]:c},h}),filter:s=>{o(t=>t.filter(s))}}]}/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M4 17v-10l7 10v-10",key:"svg-0"}],["path",{d:"M15 17h5",key:"svg-1"}],["path",{d:"M17.5 10m-2.5 0a2.5 3 0 1 0 5 0a2.5 3 0 1 0 -5 0",key:"svg-2"}]],ce=Q("outline","number","Number",ie);function re({records:d,onItemsSelected:f,onItemsDeleted:o}){const g=W(),x=V(),m=se("barcode-scan-results","id"),S=p.useMemo(()=>[{accessor:"instance",title:i._({id:"HX5SVx"}),sortable:!1,switchable:!1,render:r=>r.instance?e.jsx(O,{model:r.model,instance:r.instance}):"-"},{accessor:"model",title:i._({id:"scu3wk"}),sortable:!1},{accessor:"barcode",title:i._({id:"ap+FLU"}),sortable:!1},{accessor:"timestamp",title:i._({id:"8TMaZI"}),sortable:!1,render:r=>r.timestamp?.toLocaleString()}],[]),k=p.useCallback(r=>{const a=[];return r.model&&r.pk&&r.instance&&a.push(te({title:i._({id:"Go4fl6"}),modelId:r.instance?.pk,modelType:r.model,navigate:g,hidden:!x.hasViewPermission(r.model)})),a},[]),I=p.useMemo(()=>[e.jsx(ee,{disabled:!m.hasSelectedRecords,icon:e.jsx(J,{}),color:"red",tooltip:i._({id:"QZQ+5V"}),onClick:()=>{o(m.selectedIds),m.clearSelectedRecords()}})],[m.hasSelectedRecords,m.selectedIds]);return p.useEffect(()=>{f(m.selectedIds)},[m.selectedIds]),e.jsx(e.Fragment,{children:e.jsx(ae,{tableState:m,tableData:d,columns:S,props:{enableFilters:!1,enableSelection:!0,enablePagination:!1,enableSearch:!1,enableRefresh:!1,rowActions:k,tableActions:I}})})}function _e(){const[d,f]=oe([]),[o,g]=K({key:"scan-history",defaultValue:[]}),[x,m]=p.useState([]),S=p.useCallback(a=>{if(!a.model||!a.pk)return;if(d.find(l=>l.model==a.model&&l.pk==a.pk)){B("duplicate-barcode"),U({id:"duplicate-barcode",title:i._({id:"euc6Ns"}),message:i._({id:"6IETQS"}),color:"orange"});return}const u=E[a.model];v.get(F(u.api_endpoint,a.pk)).then(l=>{a.instance=l.data,f.append(a)}).catch(l=>{R({error:l,title:i._({id:"DFEq8c"}),message:i._({id:"beMwe+"})})})},[v,d]),k=p.useCallback(a=>{v.post(F(q.barcode),{barcode:a}).then(u=>{const l=u?.data??{};let w=!1;for(const y of Object.keys(E))l[y]?.pk&&(w=!0,S({id:P(),barcode:a,data:l,timestamp:D().toDate(),source:"scan",model:y,pk:l[y]?.pk}));w||f.append({id:P(),barcode:a,data:l,timestamp:D().toDate(),source:"scan"})}).catch(u=>{R({error:u,message:i._({id:"I3WmwV"}),title:i._({id:"72IS8c"}),field:"error"})})},[S]);p.useEffect(()=>{d.length!==0&&g(d)},[d]),p.useEffect(()=>{f.setState(o)},[o]);const I=p.useMemo(()=>d.filter(a=>x.includes(a.id)),[x,d]),r=p.useMemo(()=>{const a=new Set(I.map(u=>u.model));return a.size===0?e.jsxs(j,{gap:0,children:[e.jsx(X,{color:"orange"}),e.jsx(b,{id:"dQStih"})]}):a.size>1?e.jsxs(j,{gap:0,children:[e.jsx(ne,{color:"orange"}),e.jsx(b,{id:"Oik3bo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{fz:"sm",c:"dimmed",children:e.jsx(b,{id:"9dx+P4"})}),e.jsx(j,{children:e.jsx(H,{onClick:L,title:i._({id:"wBMjJ2"}),variant:"default",children:e.jsx(ce,{})})})]})},[I]);return e.jsxs(e.Fragment,{children:[e.jsx($,{title:i._({id:"kSFUZe"})}),e.jsx(j,{justify:"space-between",children:e.jsx(j,{justify:"left",children:e.jsx(_,{size:"xl",children:e.jsx(b,{id:"kSFUZe"})})})}),e.jsx(Z,{h:"md"}),e.jsxs(T,{maw:"100%",children:[e.jsxs(T.Col,{span:4,children:[e.jsx(M,{p:"sm",shadow:"xs",children:e.jsxs(A,{gap:"xs",children:[e.jsx(_,{size:"lg",children:i._({id:"n5kv5D"})}),e.jsx(C,{}),e.jsx(Y,{onScan:k})]})}),e.jsx(M,{p:"sm",shadow:"xs",children:e.jsxs(A,{gap:"xs",children:[e.jsx(_,{size:"lg",children:i._({id:"bwRvnp"})}),e.jsx(C,{}),x.length===0?e.jsx(G,{title:i._({id:"65vtJ8"}),color:"blue",children:e.jsx(b,{id:"mB/UHi"})}):e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsx(b,{id:"sQhVFe",values:{0:x.length}})}),r]})]})})]}),e.jsx(T.Col,{span:8,children:e.jsx(M,{p:"sm",shadow:"xs",children:e.jsxs(A,{gap:"xs",children:[e.jsx(j,{justify:"space-between",children:e.jsx(_,{size:"lg",children:i._({id:"Ku9qqT"})})}),e.jsx(C,{}),e.jsx(re,{records:d,onItemsSelected:a=>{m(a)},onItemsDeleted:a=>{const u=d.filter(l=>!a.includes(l.id));f.setState(u),g(u)}})]})})})]})]})}export{_e as default};
//# sourceMappingURL=Scan-4sHwWeFY.js.map
