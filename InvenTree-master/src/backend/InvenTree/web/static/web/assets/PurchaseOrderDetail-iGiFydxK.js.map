{"version":3,"file":"PurchaseOrderDetail-iGiFydxK.js","sources":["../../../../../../frontend/src/tables/purchasing/PurchaseOrderLineItemTable.tsx","../../../../../../frontend/src/pages/purchasing/PurchaseOrderDetail.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { Text } from '@mantine/core';\nimport { IconFileArrowLeft, IconSquareArrowRight } from '@tabler/icons-react';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { ActionButton } from '@lib/components/ActionButton';\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport { ProgressBar } from '@lib/components/ProgressBar';\nimport {\n  type RowAction,\n  RowDeleteAction,\n  RowDuplicateAction,\n  RowEditAction,\n  RowViewAction\n} from '@lib/components/RowActions';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport { formatDecimal } from '@lib/functions/Formatting';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { useNavigate } from 'react-router-dom';\nimport ImporterDrawer from '../../components/importer/ImporterDrawer';\nimport { RenderInstance } from '../../components/render/Instance';\nimport { formatCurrency } from '../../defaults/formatters';\nimport { dataImporterSessionFields } from '../../forms/ImporterForms';\nimport {\n  usePurchaseOrderLineItemFields,\n  useReceiveLineItems\n} from '../../forms/PurchaseOrderForms';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport useStatusCodes from '../../hooks/UseStatusCodes';\nimport { useTable } from '../../hooks/UseTable';\nimport { useGlobalSettingsState } from '../../states/SettingsStates';\nimport { useUserState } from '../../states/UserState';\nimport {\n  CurrencyColumn,\n  DescriptionColumn,\n  LinkColumn,\n  LocationColumn,\n  NoteColumn,\n  PartColumn,\n  ProjectCodeColumn,\n  ReferenceColumn,\n  TargetDateColumn\n} from '../ColumnRenderers';\nimport { InvenTreeTable } from '../InvenTreeTable';\nimport { TableHoverCard } from '../TableHoverCard';\n\n/*\n * Display a table of purchase order line items, for a specific order\n */\nexport function PurchaseOrderLineItemTable({\n  order,\n  orderDetailRefresh,\n  orderId,\n  currency,\n  supplierId,\n  editable,\n  params\n}: Readonly<{\n  order: any;\n  orderDetailRefresh: () => void;\n  orderId: number;\n  currency: string;\n  supplierId?: number;\n  editable: boolean;\n  params?: any;\n}>) {\n  const table = useTable('purchase-order-line-item');\n\n  const globalSettings = useGlobalSettingsState();\n  const navigate = useNavigate();\n  const user = useUserState();\n\n  // Data import\n  const [importOpened, setImportOpened] = useState<boolean>(false);\n  const [selectedSession, setSelectedSession] = useState<number | undefined>(\n    undefined\n  );\n\n  const importSessionFields = useMemo(() => {\n    const fields = dataImporterSessionFields({\n      modelType: ModelType.purchaseorderlineitem\n    });\n\n    // Specify override values for import\n    fields.field_overrides.value = {\n      order: orderId\n    };\n\n    // Specify default values based on the order data\n    fields.field_defaults.value = {\n      purchase_price_currency:\n        order?.order_currency || order?.supplier_detail?.currency || undefined\n    };\n\n    fields.field_filters.value = {\n      part: {\n        supplier: supplierId,\n        active: true\n      }\n    };\n\n    return fields;\n  }, [order, orderId, supplierId]);\n\n  const importLineItems = useCreateApiFormModal({\n    url: ApiEndpoints.import_session_list,\n    title: t`Import Line Items`,\n    fields: importSessionFields,\n    onFormSuccess: (response: any) => {\n      setSelectedSession(response.pk);\n      setImportOpened(true);\n    }\n  });\n\n  const [singleRecord, setSingleRecord] = useState(null);\n\n  const receiveLineItems = useReceiveLineItems({\n    items: singleRecord ? [singleRecord] : table.selectedRecords,\n    orderPk: orderId,\n    destinationPk: order.destination,\n    formProps: {\n      // Timeout is a small hack to prevent function being called before re-render\n      onClose: () => {\n        table.clearSelectedRecords();\n        table.refreshTable();\n        setTimeout(() => setSingleRecord(null), 500);\n      }\n    }\n  });\n\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      PartColumn({\n        part: 'part_detail',\n        ordering: 'part_name'\n      }),\n      {\n        accessor: 'part_detail.IPN',\n        sortable: true,\n        ordering: 'IPN'\n      },\n      DescriptionColumn({\n        accessor: 'part_detail.description'\n      }),\n      ReferenceColumn({}),\n      ProjectCodeColumn({}),\n      {\n        accessor: 'build_order',\n        title: t`Build Order`,\n        sortable: true,\n        defaultVisible: false,\n        render: (record: any) => {\n          if (record.build_order_detail) {\n            return (\n              <RenderInstance\n                instance={record.build_order_detail}\n                model={ModelType.build}\n              />\n            );\n          } else {\n            return '-';\n          }\n        }\n      },\n      {\n        accessor: 'quantity',\n        title: t`Quantity`,\n        sortable: true,\n        switchable: false,\n        render: (record: any) => {\n          const supplier_part = record?.supplier_part_detail ?? {};\n          const part = record?.part_detail ?? supplier_part?.part_detail ?? {};\n          const extra = [];\n\n          if (\n            supplier_part?.pack_quantity_native != undefined &&\n            supplier_part.pack_quantity_native != 1\n          ) {\n            const total = record.quantity * supplier_part.pack_quantity_native;\n\n            extra.push(\n              <Text key='pack-quantity' size='sm'>\n                {t`Pack Quantity`}: {supplier_part.pack_quantity}\n              </Text>\n            );\n\n            extra.push(\n              <Text key='total-quantity' size='sm'>\n                {t`Total Quantity`}: {formatDecimal(total)} {part?.units}\n              </Text>\n            );\n          }\n\n          return (\n            <TableHoverCard\n              value={formatDecimal(record.quantity)}\n              extra={extra}\n              title={t`Quantity`}\n            />\n          );\n        }\n      },\n      {\n        accessor: 'received',\n        title: t`Received`,\n        sortable: false,\n\n        render: (record: any) => (\n          <ProgressBar\n            progressLabel={true}\n            value={record.received}\n            maximum={record.quantity}\n          />\n        )\n      },\n      {\n        accessor: 'supplier_part_detail.packaging',\n        sortable: false,\n        title: t`Packaging`,\n        defaultVisible: false\n      },\n      {\n        accessor: 'supplier_part_detail.pack_quantity',\n        sortable: false,\n        title: t`Pack Quantity`\n      },\n      {\n        accessor: 'sku',\n        title: t`Supplier Code`,\n        switchable: false,\n        sortable: true,\n        ordering: 'SKU'\n      },\n      LinkColumn({\n        accessor: 'supplier_part_detail.link',\n        title: t`Supplier Link`,\n        sortable: false,\n        defaultVisible: false\n      }),\n      {\n        accessor: 'mpn',\n        ordering: 'MPN',\n        title: t`Manufacturer Code`,\n        sortable: true,\n        defaultVisible: false\n      },\n      CurrencyColumn({\n        accessor: 'purchase_price',\n        title: t`Unit Price`\n      }),\n      {\n        accessor: 'total_price',\n        title: t`Total Price`,\n        render: (record: any) =>\n          formatCurrency(record.purchase_price, {\n            currency: record.purchase_price_currency,\n            multiplier: record.quantity\n          })\n      },\n      TargetDateColumn({}),\n      LocationColumn({\n        accessor: 'destination_detail',\n        sortable: false,\n        title: t`Destination`\n      }),\n      NoteColumn({}),\n      LinkColumn({})\n    ];\n  }, [orderId, user]);\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'received',\n        label: t`Received`,\n        description: t`Show line items which have been received`\n      }\n    ];\n  }, []);\n\n  const addPurchaseOrderFields = usePurchaseOrderLineItemFields({\n    create: true,\n    orderId: orderId,\n    supplierId: supplierId,\n    currency: currency\n  });\n\n  const [initialData, setInitialData] = useState<any>({});\n\n  const newLine = useCreateApiFormModal({\n    url: ApiEndpoints.purchase_order_line_list,\n    title: t`Add Line Item`,\n    fields: addPurchaseOrderFields,\n    initialData: {\n      ...initialData,\n      purchase_price_currency: currency\n    },\n    onFormSuccess: orderDetailRefresh,\n    table: table\n  });\n\n  const [selectedLine, setSelectedLine] = useState<number>(0);\n\n  const editLineItemFields = usePurchaseOrderLineItemFields({\n    create: false,\n    orderId: orderId,\n    supplierId: supplierId,\n    currency: currency\n  });\n\n  const editLine = useEditApiFormModal({\n    url: ApiEndpoints.purchase_order_line_list,\n    pk: selectedLine,\n    title: t`Edit Line Item`,\n    fields: editLineItemFields,\n    onFormSuccess: orderDetailRefresh,\n    table: table\n  });\n\n  const deleteLine = useDeleteApiFormModal({\n    url: ApiEndpoints.purchase_order_line_list,\n    pk: selectedLine,\n    title: t`Delete Line Item`,\n    onFormSuccess: orderDetailRefresh,\n    table: table\n  });\n\n  const poStatus = useStatusCodes({ modelType: ModelType.purchaseorder });\n\n  const orderPlaced: boolean = useMemo(() => {\n    return order.status == poStatus.PLACED;\n  }, [order, poStatus]);\n\n  const rowActions = useCallback(\n    (record: any): RowAction[] => {\n      const received = (record?.received ?? 0) >= (record?.quantity ?? 0);\n\n      const canEdit: boolean =\n        editable && user.hasChangeRole(UserRoles.purchase_order);\n\n      return [\n        {\n          hidden: received || !orderPlaced,\n          title: t`Receive line item`,\n          icon: <IconSquareArrowRight />,\n          color: 'green',\n          onClick: () => {\n            setSingleRecord(record);\n            receiveLineItems.open();\n          }\n        },\n        RowEditAction({\n          hidden: !canEdit,\n          onClick: () => {\n            setSelectedLine(record.pk);\n            editLine.open();\n          }\n        }),\n        RowDuplicateAction({\n          hidden: !canEdit || !user.hasAddRole(UserRoles.purchase_order),\n          onClick: () => {\n            setInitialData({ ...record });\n            newLine.open();\n          }\n        }),\n        RowDeleteAction({\n          hidden: !canEdit || !user.hasDeleteRole(UserRoles.purchase_order),\n          onClick: () => {\n            setSelectedLine(record.pk);\n            deleteLine.open();\n          }\n        }),\n        RowViewAction({\n          hidden: !record.build_order,\n          title: t`View Build Order`,\n          modelType: ModelType.build,\n          modelId: record.build_order,\n          navigate: navigate\n        })\n      ];\n    },\n    [orderId, user, editable, orderPlaced]\n  );\n\n  // Custom table actions\n  const tableActions = useMemo(() => {\n    return [\n      <ActionButton\n        key='import-line-items'\n        hidden={!editable || !user.hasAddRole(UserRoles.purchase_order)}\n        tooltip={t`Import Line Items`}\n        icon={<IconFileArrowLeft />}\n        onClick={() => importLineItems.open()}\n      />,\n      <AddItemButton\n        key='add-line-item'\n        tooltip={t`Add Line Item`}\n        onClick={() => {\n          setInitialData({\n            order: orderId\n          });\n          newLine.open();\n        }}\n        hidden={!editable || !user?.hasAddRole(UserRoles.purchase_order)}\n      />,\n      <ActionButton\n        key='receive-items'\n        text={t`Receive items`}\n        icon={<IconSquareArrowRight />}\n        onClick={() => receiveLineItems.open()}\n        disabled={table.selectedRecords.length === 0}\n        hidden={!orderPlaced || !user.hasChangeRole(UserRoles.purchase_order)}\n      />\n    ];\n  }, [orderId, user, table, editable, orderPlaced]);\n\n  return (\n    <>\n      {importLineItems.modal}\n      {receiveLineItems.modal}\n      {newLine.modal}\n      {editLine.modal}\n      {deleteLine.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.purchase_order_line_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          enableSelection: true,\n          enableDownload: true,\n          params: {\n            ...params,\n            order: orderId,\n            part_detail: true\n          },\n          rowActions: rowActions,\n          tableActions: tableActions,\n          tableFilters: tableFilters,\n          modelType: ModelType.supplierpart,\n          modelField: 'part'\n        }}\n      />\n      <ImporterDrawer\n        sessionId={selectedSession ?? -1}\n        opened={selectedSession != undefined && importOpened}\n        onClose={() => {\n          setSelectedSession(undefined);\n          setImportOpened(false);\n          table.refreshTable();\n        }}\n      />\n    </>\n  );\n}\n","import { t } from '@lingui/core/macro';\nimport { Accordion, Grid, Skeleton, Stack } from '@mantine/core';\nimport { IconInfoCircle, IconList, IconPackages } from '@tabler/icons-react';\nimport { type ReactNode, useMemo } from 'react';\nimport { useParams } from 'react-router-dom';\n\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport AdminButton from '../../components/buttons/AdminButton';\nimport PrimaryActionButton from '../../components/buttons/PrimaryActionButton';\nimport { PrintingActions } from '../../components/buttons/PrintingActions';\nimport {\n  type DetailsField,\n  DetailsTable\n} from '../../components/details/Details';\nimport { DetailsImage } from '../../components/details/DetailsImage';\nimport { ItemDetailsGrid } from '../../components/details/ItemDetails';\nimport {\n  BarcodeActionDropdown,\n  CancelItemAction,\n  DuplicateItemAction,\n  EditItemAction,\n  HoldItemAction,\n  OptionsActionDropdown\n} from '../../components/items/ActionDropdown';\nimport { StylishText } from '../../components/items/StylishText';\nimport InstanceDetail from '../../components/nav/InstanceDetail';\nimport { PageDetail } from '../../components/nav/PageDetail';\nimport AttachmentPanel from '../../components/panels/AttachmentPanel';\nimport NotesPanel from '../../components/panels/NotesPanel';\nimport type { PanelType } from '../../components/panels/Panel';\nimport { PanelGroup } from '../../components/panels/PanelGroup';\nimport ParametersPanel from '../../components/panels/ParametersPanel';\nimport { StatusRenderer } from '../../components/render/StatusRenderer';\nimport { formatCurrency } from '../../defaults/formatters';\nimport { usePurchaseOrderFields } from '../../forms/PurchaseOrderForms';\nimport {\n  useCreateApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useInstance } from '../../hooks/UseInstance';\nimport useStatusCodes from '../../hooks/UseStatusCodes';\nimport { useGlobalSettingsState } from '../../states/SettingsStates';\nimport { useUserState } from '../../states/UserState';\nimport ExtraLineItemTable from '../../tables/general/ExtraLineItemTable';\nimport { PurchaseOrderLineItemTable } from '../../tables/purchasing/PurchaseOrderLineItemTable';\nimport { StockItemTable } from '../../tables/stock/StockItemTable';\n\n/**\n * Detail page for a single PurchaseOrder\n */\nexport default function PurchaseOrderDetail() {\n  const { id } = useParams();\n\n  const user = useUserState();\n  const globalSettings = useGlobalSettingsState();\n\n  const {\n    instance: order,\n    instanceQuery,\n    refreshInstance\n  } = useInstance({\n    endpoint: ApiEndpoints.purchase_order_list,\n    pk: id,\n    params: {\n      supplier_detail: true\n    },\n    refetchOnMount: true\n  });\n\n  const orderCurrency = useMemo(() => {\n    return (\n      order.order_currency ||\n      order.supplier_detail?.currency ||\n      globalSettings.getSetting('INVENTREE_DEFAULT_CURRENCY')\n    );\n  }, [order, globalSettings]);\n\n  const purchaseOrderFields = usePurchaseOrderFields({});\n\n  const duplicatePurchaseOrderFields = usePurchaseOrderFields({\n    duplicateOrderId: order.pk\n  });\n\n  const editPurchaseOrder = useEditApiFormModal({\n    url: ApiEndpoints.purchase_order_list,\n    pk: id,\n    title: t`Edit Purchase Order`,\n    fields: purchaseOrderFields,\n    onFormSuccess: () => {\n      refreshInstance();\n    }\n  });\n\n  const poStatus = useStatusCodes({ modelType: ModelType.purchaseorder });\n\n  const orderOpen: boolean = useMemo(() => {\n    return (\n      order.status == poStatus.PENDING ||\n      order.status == poStatus.PLACED ||\n      order.status == poStatus.ON_HOLD\n    );\n  }, [order, poStatus]);\n\n  const lineItemsEditable: boolean = useMemo(() => {\n    if (orderOpen) {\n      return true;\n    } else {\n      return globalSettings.isSet('PURCHASEORDER_EDIT_COMPLETED_ORDERS');\n    }\n  }, [orderOpen, globalSettings]);\n\n  const duplicatePurchaseOrderInitialData = useMemo(() => {\n    const data = { ...order };\n    // if we set the reference to null/undefined, it will be left blank in the form\n    // if we omit the reference altogether, it will be auto-generated via reference pattern\n    // from the OPTIONS response\n    delete data.reference;\n    return data;\n  }, [order]);\n\n  const duplicatePurchaseOrder = useCreateApiFormModal({\n    url: ApiEndpoints.purchase_order_list,\n    title: t`Add Purchase Order`,\n    fields: duplicatePurchaseOrderFields,\n    initialData: duplicatePurchaseOrderInitialData,\n    follow: true,\n    modelType: ModelType.purchaseorder\n  });\n\n  const detailsPanel = useMemo(() => {\n    if (instanceQuery.isFetching) {\n      return <Skeleton />;\n    }\n\n    const tl: DetailsField[] = [\n      {\n        type: 'text',\n        name: 'reference',\n        label: t`Reference`,\n        copy: true\n      },\n      {\n        type: 'text',\n        name: 'supplier_reference',\n        label: t`Supplier Reference`,\n        icon: 'reference',\n        hidden: !order.supplier_reference,\n        copy: true\n      },\n      {\n        type: 'link',\n        name: 'supplier',\n        icon: 'suppliers',\n        label: t`Supplier`,\n        model: ModelType.company\n      },\n      {\n        type: 'text',\n        name: 'description',\n        label: t`Description`,\n        copy: true\n      },\n      {\n        type: 'status',\n        name: 'status',\n        label: t`Status`,\n        model: ModelType.purchaseorder\n      },\n      {\n        type: 'status',\n        name: 'status_custom_key',\n        label: t`Custom Status`,\n        model: ModelType.purchaseorder,\n        icon: 'status',\n        hidden:\n          !order.status_custom_key || order.status_custom_key == order.status\n      }\n    ];\n\n    const tr: DetailsField[] = [\n      {\n        type: 'progressbar',\n        name: 'completed',\n        icon: 'progress',\n        label: t`Completed Line Items`,\n        total: order.line_items,\n        progress: order.completed_lines\n      },\n      {\n        type: 'link',\n        model: ModelType.stocklocation,\n        link: true,\n        name: 'destination',\n        label: t`Destination`,\n        hidden: !order.destination\n      },\n      {\n        type: 'text',\n        name: 'currency',\n        label: t`Order Currency`,\n        value_formatter: () => orderCurrency\n      },\n      {\n        type: 'text',\n        name: 'total_price',\n        label: t`Total Cost`,\n        value_formatter: () => {\n          return formatCurrency(order?.total_price, {\n            currency: order?.order_currency || order?.supplier_detail?.currency\n          });\n        }\n      }\n    ];\n\n    const bl: DetailsField[] = [\n      {\n        type: 'link',\n        external: true,\n        name: 'link',\n        label: t`Link`,\n        copy: true,\n        hidden: !order.link\n      },\n      {\n        type: 'text',\n        name: 'contact_detail.name',\n        label: t`Contact`,\n        icon: 'user',\n        copy: true,\n        hidden: !order.contact\n      },\n      {\n        type: 'text',\n        name: 'contact_detail.email',\n        label: t`Contact Email`,\n        icon: 'email',\n        copy: true,\n        hidden: !order.contact_detail?.email\n      },\n      {\n        type: 'text',\n        name: 'contact_detail.phone',\n        label: t`Contact Phone`,\n        icon: 'phone',\n        copy: true,\n        hidden: !order.contact_detail?.phone\n      },\n      {\n        type: 'text',\n        name: 'project_code_label',\n        label: t`Project Code`,\n        icon: 'reference',\n        copy: true,\n        hidden: !order.project_code\n      },\n      {\n        type: 'text',\n        name: 'responsible',\n        label: t`Responsible`,\n        badge: 'owner',\n        hidden: !order.responsible\n      }\n    ];\n\n    const br: DetailsField[] = [\n      {\n        type: 'date',\n        name: 'creation_date',\n        label: t`Creation Date`,\n        copy: true,\n        icon: 'calendar'\n      },\n      {\n        type: 'date',\n        name: 'issue_date',\n        label: t`Issue Date`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !order.issue_date\n      },\n      {\n        type: 'date',\n        name: 'start_date',\n        label: t`Start Date`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !order.start_date\n      },\n      {\n        type: 'date',\n        name: 'target_date',\n        label: t`Target Date`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !order.target_date\n      },\n      {\n        type: 'date',\n        name: 'complete_date',\n        icon: 'calendar_check',\n        label: t`Completion Date`,\n        copy: true,\n        hidden: !order.complete_date\n      }\n    ];\n\n    return (\n      <ItemDetailsGrid>\n        <Grid grow>\n          <DetailsImage\n            appRole={UserRoles.purchase_order}\n            apiPath={ApiEndpoints.company_list}\n            src={order.supplier_detail?.image}\n            pk={order.supplier}\n          />\n          <Grid.Col span={{ base: 12, sm: 8 }}>\n            <DetailsTable fields={tl} item={order} />\n          </Grid.Col>\n        </Grid>\n        <DetailsTable fields={tr} item={order} />\n        <DetailsTable fields={bl} item={order} />\n        <DetailsTable fields={br} item={order} />\n      </ItemDetailsGrid>\n    );\n  }, [order, orderCurrency, instanceQuery]);\n\n  const orderPanels: PanelType[] = useMemo(() => {\n    return [\n      {\n        name: 'detail',\n        label: t`Order Details`,\n        icon: <IconInfoCircle />,\n        content: detailsPanel\n      },\n      {\n        name: 'line-items',\n        label: t`Line Items`,\n        icon: <IconList />,\n        content: (\n          <Accordion\n            multiple={true}\n            defaultValue={['line-items', 'extra-items']}\n          >\n            <Accordion.Item value='line-items' key='lineitems'>\n              <Accordion.Control>\n                <StylishText size='lg'>{t`Line Items`}</StylishText>\n              </Accordion.Control>\n              <Accordion.Panel>\n                <PurchaseOrderLineItemTable\n                  order={order}\n                  orderDetailRefresh={refreshInstance}\n                  currency={orderCurrency}\n                  orderId={Number(id)}\n                  editable={lineItemsEditable}\n                  supplierId={Number(order.supplier)}\n                />\n              </Accordion.Panel>\n            </Accordion.Item>\n            <Accordion.Item value='extra-items' key='extraitems'>\n              <Accordion.Control>\n                <StylishText size='lg'>{t`Extra Line Items`}</StylishText>\n              </Accordion.Control>\n              <Accordion.Panel>\n                <ExtraLineItemTable\n                  endpoint={ApiEndpoints.purchase_order_extra_line_list}\n                  orderId={order.pk}\n                  orderDetailRefresh={refreshInstance}\n                  currency={orderCurrency}\n                  editable={lineItemsEditable}\n                  role={UserRoles.purchase_order}\n                />\n              </Accordion.Panel>\n            </Accordion.Item>\n          </Accordion>\n        )\n      },\n      {\n        name: 'received-stock',\n        label: t`Received Stock`,\n        icon: <IconPackages />,\n        content: (\n          <StockItemTable\n            tableName='received-stock'\n            params={{\n              purchase_order: id\n            }}\n          />\n        )\n      },\n      ParametersPanel({\n        model_type: ModelType.purchaseorder,\n        model_id: order.pk\n      }),\n      AttachmentPanel({\n        model_type: ModelType.purchaseorder,\n        model_id: order.pk\n      }),\n      NotesPanel({\n        model_type: ModelType.purchaseorder,\n        model_id: order.pk\n      })\n    ];\n  }, [order, id, user]);\n\n  const issueOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.purchase_order_issue, order.pk),\n    title: t`Issue Purchase Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Issue this order`,\n    successMessage: t`Order issued`\n  });\n\n  const cancelOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.purchase_order_cancel, order.pk),\n    title: t`Cancel Purchase Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Cancel this order`,\n    successMessage: t`Order cancelled`\n  });\n\n  const holdOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.purchase_order_hold, order.pk),\n    title: t`Hold Purchase Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Place this order on hold`,\n    successMessage: t`Order placed on hold`\n  });\n\n  const completeOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.purchase_order_complete, order.pk),\n    title: t`Complete Purchase Order`,\n    successMessage: t`Order completed`,\n    timeout: 10000,\n    fields: {\n      accept_incomplete: {}\n    },\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Mark this order as complete`\n  });\n\n  const poActions = useMemo(() => {\n    const canEdit: boolean = user.hasChangeRole(UserRoles.purchase_order);\n\n    const canIssue: boolean =\n      canEdit &&\n      (order.status == poStatus.PENDING || order.status == poStatus.ON_HOLD);\n\n    const canHold: boolean =\n      canEdit &&\n      (order.status == poStatus.PENDING || order.status == poStatus.PLACED);\n\n    const canComplete: boolean = canEdit && order.status == poStatus.PLACED;\n\n    const canCancel: boolean =\n      canEdit &&\n      order.status != poStatus.CANCELLED &&\n      order.status != poStatus.COMPLETE;\n\n    return [\n      <PrimaryActionButton\n        title={t`Issue Order`}\n        icon='issue'\n        hidden={!canIssue}\n        color='blue'\n        onClick={issueOrder.open}\n      />,\n      <PrimaryActionButton\n        title={t`Complete Order`}\n        icon='complete'\n        hidden={!canComplete}\n        color='green'\n        onClick={completeOrder.open}\n      />,\n      <AdminButton model={ModelType.purchaseorder} id={order.pk} />,\n      <BarcodeActionDropdown\n        model={ModelType.purchaseorder}\n        pk={order.pk}\n        hash={order?.barcode_hash}\n      />,\n      <PrintingActions\n        modelType={ModelType.purchaseorder}\n        items={[order.pk]}\n        enableLabels\n        enableReports\n      />,\n      <OptionsActionDropdown\n        tooltip={t`Order Actions`}\n        actions={[\n          EditItemAction({\n            hidden: !canEdit,\n            tooltip: t`Edit order`,\n            onClick: () => {\n              editPurchaseOrder.open();\n            }\n          }),\n          DuplicateItemAction({\n            hidden: !user.hasAddRole(UserRoles.purchase_order),\n            onClick: () => duplicatePurchaseOrder.open(),\n            tooltip: t`Duplicate order`\n          }),\n          HoldItemAction({\n            tooltip: t`Hold order`,\n            hidden: !canHold,\n            onClick: holdOrder.open\n          }),\n          CancelItemAction({\n            tooltip: t`Cancel order`,\n            hidden: !canCancel,\n            onClick: cancelOrder.open\n          })\n        ]}\n      />\n    ];\n  }, [id, order, user, poStatus]);\n\n  const orderBadges: ReactNode[] = useMemo(() => {\n    return instanceQuery.isLoading\n      ? []\n      : [\n          <StatusRenderer\n            status={order.status_custom_key}\n            type={ModelType.purchaseorder}\n            options={{ size: 'lg' }}\n          />\n        ];\n  }, [order, instanceQuery]);\n\n  const subtitle: string = useMemo(() => {\n    let t = order.supplier_detail?.name || '';\n\n    if (order.supplier_reference) {\n      t += ` (${order.supplier_reference})`;\n    }\n\n    return t;\n  }, [order]);\n\n  return (\n    <>\n      {issueOrder.modal}\n      {holdOrder.modal}\n      {cancelOrder.modal}\n      {completeOrder.modal}\n      {editPurchaseOrder.modal}\n      {duplicatePurchaseOrder.modal}\n      <InstanceDetail\n        query={instanceQuery}\n        requiredRole={UserRoles.purchase_order}\n      >\n        <Stack gap='xs'>\n          <PageDetail\n            title={`${t`Purchase Order`}: ${order.reference}`}\n            subtitle={subtitle}\n            imageUrl={order.supplier_detail?.image}\n            breadcrumbs={[{ name: t`Purchasing`, url: '/purchasing/' }]}\n            lastCrumb={[\n              {\n                name: order.reference,\n                url: `/purchasing/purchase-order/${order.pk}`\n              }\n            ]}\n            actions={poActions}\n            badges={orderBadges}\n            editAction={editPurchaseOrder.open}\n            editEnabled={user.hasChangePermission(ModelType.purchaseorder)}\n          />\n          <PanelGroup\n            pageKey='purchaseorder'\n            panels={orderPanels}\n            model={ModelType.purchaseorder}\n            instance={order}\n            reloadInstance={refreshInstance}\n            id={order.pk}\n          />\n        </Stack>\n      </InstanceDetail>\n    </>\n  );\n}\n"],"names":["PurchaseOrderLineItemTable","order","orderDetailRefresh","orderId","currency","supplierId","editable","params","table","useTable","useGlobalSettingsState","navigate","useNavigate","user","useUserState","importOpened","setImportOpened","useState","selectedSession","setSelectedSession","undefined","importSessionFields","useMemo","fields","dataImporterSessionFields","modelType","ModelType","purchaseorderlineitem","field_overrides","value","field_defaults","purchase_price_currency","order_currency","supplier_detail","field_filters","part","supplier","active","importLineItems","useCreateApiFormModal","url","ApiEndpoints","import_session_list","title","_i18n","_","id","onFormSuccess","response","pk","singleRecord","setSingleRecord","receiveLineItems","useReceiveLineItems","items","selectedRecords","orderPk","destinationPk","destination","formProps","onClose","clearSelectedRecords","refreshTable","setTimeout","tableColumns","PartColumn","ordering","accessor","sortable","DescriptionColumn","ReferenceColumn","ProjectCodeColumn","defaultVisible","render","record","build_order_detail","RenderInstance","build","switchable","supplier_part","supplier_part_detail","part_detail","extra","pack_quantity_native","total","quantity","push","jsxs","Text","pack_quantity","formatDecimal","units","jsx","TableHoverCard","ProgressBar","received","LinkColumn","CurrencyColumn","formatCurrency","purchase_price","multiplier","TargetDateColumn","LocationColumn","NoteColumn","tableFilters","name","label","description","addPurchaseOrderFields","usePurchaseOrderLineItemFields","create","initialData","setInitialData","newLine","purchase_order_line_list","selectedLine","setSelectedLine","editLineItemFields","editLine","useEditApiFormModal","deleteLine","useDeleteApiFormModal","poStatus","useStatusCodes","purchaseorder","orderPlaced","status","PLACED","rowActions","useCallback","canEdit","hasChangeRole","UserRoles","purchase_order","hidden","icon","IconSquareArrowRight","color","onClick","open","RowEditAction","RowDuplicateAction","hasAddRole","RowDeleteAction","hasDeleteRole","RowViewAction","build_order","modelId","tableActions","ActionButton","IconFileArrowLeft","AddItemButton","length","Fragment","modal","InvenTreeTable","apiUrl","enableSelection","enableDownload","supplierpart","modelField","ImporterDrawer","PurchaseOrderDetail","useParams","globalSettings","instance","instanceQuery","refreshInstance","useInstance","endpoint","purchase_order_list","refetchOnMount","orderCurrency","getSetting","purchaseOrderFields","usePurchaseOrderFields","duplicatePurchaseOrderFields","duplicateOrderId","editPurchaseOrder","orderOpen","PENDING","ON_HOLD","lineItemsEditable","isSet","duplicatePurchaseOrderInitialData","data","reference","duplicatePurchaseOrder","follow","detailsPanel","isFetching","Skeleton","tl","type","copy","supplier_reference","model","company","status_custom_key","tr","line_items","progress","completed_lines","stocklocation","link","value_formatter","total_price","bl","external","contact","contact_detail","email","phone","project_code","badge","responsible","br","issue_date","start_date","target_date","complete_date","ItemDetailsGrid","Grid","DetailsImage","company_list","image","base","sm","DetailsTable","orderPanels","IconInfoCircle","content","IconList","Accordion","StylishText","Number","ExtraLineItemTable","purchase_order_extra_line_list","IconPackages","StockItemTable","ParametersPanel","model_type","model_id","AttachmentPanel","NotesPanel","issueOrder","purchase_order_issue","preFormWarning","successMessage","cancelOrder","purchase_order_cancel","holdOrder","purchase_order_hold","completeOrder","purchase_order_complete","timeout","accept_incomplete","poActions","canIssue","canHold","canComplete","canCancel","CANCELLED","COMPLETE","PrimaryActionButton","AdminButton","BarcodeActionDropdown","barcode_hash","PrintingActions","OptionsActionDropdown","EditItemAction","tooltip","DuplicateItemAction","HoldItemAction","CancelItemAction","orderBadges","isLoading","StatusRenderer","size","subtitle","t","InstanceDetail","Stack","PageDetail","hasChangePermission","PanelGroup"],"mappings":"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"}