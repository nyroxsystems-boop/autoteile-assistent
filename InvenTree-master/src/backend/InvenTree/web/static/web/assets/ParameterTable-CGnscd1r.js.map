{"version":3,"file":"ParameterTable-CGnscd1r.js","sources":["../../../../../../frontend/src/tables/general/ParameterTable.tsx"],"sourcesContent":["import {\n  ApiEndpoints,\n  ModelType,\n  RowDeleteAction,\n  RowEditAction,\n  YesNoButton,\n  apiUrl,\n  formatDecimal\n} from '@lib/index';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { t } from '@lingui/core/macro';\nimport { IconFileUpload, IconPlus } from '@tabler/icons-react';\nimport { useCallback, useMemo, useState } from 'react';\nimport ImporterDrawer from '../../components/importer/ImporterDrawer';\nimport { ActionDropdown } from '../../components/items/ActionDropdown';\nimport { useParameterFields } from '../../forms/CommonForms';\nimport { dataImporterSessionFields } from '../../forms/ImporterForms';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport {\n  DateColumn,\n  DescriptionColumn,\n  NoteColumn,\n  UserColumn\n} from '../ColumnRenderers';\nimport { UserFilter } from '../Filter';\nimport { InvenTreeTable } from '../InvenTreeTable';\nimport { TableHoverCard } from '../TableHoverCard';\n\n/**\n * Construct a table listing parameters\n */\nexport function ParameterTable({\n  modelType,\n  modelId,\n  allowEdit = true\n}: {\n  modelType: ModelType;\n  modelId: number;\n  allowEdit?: boolean;\n}) {\n  const table = useTable('parameters');\n  const user = useUserState();\n\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'template_detail.name',\n        switchable: false,\n        sortable: true,\n        ordering: 'name'\n      },\n      DescriptionColumn({\n        accessor: 'template_detail.description'\n      }),\n      {\n        accessor: 'data',\n        switchable: false,\n        sortable: true,\n        render: (record) => {\n          const template = record.template_detail;\n\n          if (template?.checkbox) {\n            return <YesNoButton value={record.data} />;\n          }\n\n          const extra: any[] = [];\n\n          if (\n            template.units &&\n            record.data_numeric &&\n            record.data_numeric != record.data\n          ) {\n            const numeric = formatDecimal(record.data_numeric, { digits: 15 });\n            extra.push(`${numeric} [${template.units}]`);\n          }\n\n          return (\n            <TableHoverCard\n              value={record.data}\n              extra={extra}\n              title={t`Internal Units`}\n            />\n          );\n        }\n      },\n      {\n        accessor: 'template_detail.units',\n        ordering: 'units',\n        sortable: true\n      },\n      NoteColumn({}),\n      DateColumn({\n        accessor: 'updated',\n        title: t`Last Updated`,\n        sortable: true,\n        switchable: true\n      }),\n      UserColumn({\n        accessor: 'updated_by_detail',\n        ordering: 'updated_by',\n        title: t`Updated By`\n      })\n    ];\n  }, [user]);\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'enabled',\n        label: 'Enabled',\n        description: t`Show parameters for enabled templates`,\n        type: 'boolean'\n      },\n      UserFilter({\n        name: 'updated_by',\n        label: t`Updated By`,\n        description: t`Filter by user who last updated the parameter`\n      })\n    ];\n  }, []);\n\n  const [selectedParameter, setSelectedParameter] = useState<any | undefined>(\n    undefined\n  );\n\n  const [importOpened, setImportOpened] = useState<boolean>(false);\n\n  const [selectedSession, setSelectedSession] = useState<number | undefined>(\n    undefined\n  );\n\n  const importSessionFields = useMemo(() => {\n    const fields = dataImporterSessionFields({\n      modelType: ModelType.parameter\n    });\n\n    fields.field_overrides.value = {\n      model_type: modelType,\n      model_id: modelId\n    };\n\n    return fields;\n  }, [modelType, modelId]);\n\n  const importParameters = useCreateApiFormModal({\n    url: ApiEndpoints.import_session_list,\n    title: t`Import Parameters`,\n    fields: importSessionFields,\n    onFormSuccess: (response: any) => {\n      setSelectedSession(response.pk);\n      setImportOpened(true);\n    }\n  });\n\n  const newParameter = useCreateApiFormModal({\n    url: ApiEndpoints.parameter_list,\n    title: t`Add Parameter`,\n    fields: useParameterFields({ modelType, modelId }),\n    initialData: {\n      data: ''\n    },\n    table: table\n  });\n\n  const editParameter = useEditApiFormModal({\n    url: ApiEndpoints.parameter_list,\n    pk: selectedParameter?.pk,\n    title: t`Edit Parameter`,\n    fields: useParameterFields({ modelType, modelId }),\n    table: table\n  });\n\n  const deleteParameter = useDeleteApiFormModal({\n    url: ApiEndpoints.parameter_list,\n    pk: selectedParameter?.pk,\n    title: t`Delete Parameter`,\n    table: table\n  });\n\n  const tableActions = useMemo(() => {\n    return [\n      <ActionDropdown\n        key='add-parameter-actions'\n        tooltip={t`Add Parameters`}\n        position='bottom-start'\n        icon={<IconPlus />}\n        hidden={!user.hasAddPermission(modelType)}\n        actions={[\n          {\n            name: t`Create Parameter`,\n            icon: <IconPlus />,\n            tooltip: t`Create a new parameter`,\n            onClick: () => {\n              setSelectedParameter(undefined);\n              newParameter.open();\n            }\n          },\n          {\n            name: t`Import from File`,\n            icon: <IconFileUpload />,\n            tooltip: t`Import parameters from a file`,\n            onClick: () => {\n              importParameters.open();\n            }\n          }\n        ]}\n      />\n    ];\n  }, [allowEdit, user]);\n\n  const rowActions = useCallback(\n    (record: any) => {\n      return [\n        RowEditAction({\n          tooltip: t`Edit Parameter`,\n          onClick: () => {\n            setSelectedParameter(record);\n            editParameter.open();\n          },\n          hidden: !user.hasChangePermission(modelType)\n        }),\n        RowDeleteAction({\n          tooltip: t`Delete Parameter`,\n          onClick: () => {\n            setSelectedParameter(record);\n            deleteParameter.open();\n          },\n          hidden: !user.hasDeletePermission(modelType)\n        })\n      ];\n    },\n    [user]\n  );\n\n  return (\n    <>\n      {newParameter.modal}\n      {editParameter.modal}\n      {deleteParameter.modal}\n      {importParameters.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.parameter_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          enableDownload: true,\n          enableBulkDelete: allowEdit != false,\n          enableSelection: allowEdit != false,\n          rowActions: allowEdit == false ? undefined : rowActions,\n          tableActions: allowEdit == false ? undefined : tableActions,\n          tableFilters: tableFilters,\n          params: {\n            model_type: modelType,\n            model_id: modelId\n          }\n        }}\n      />\n      <ImporterDrawer\n        sessionId={selectedSession ?? -1}\n        opened={selectedSession !== undefined && importOpened}\n        onClose={() => {\n          setSelectedSession(undefined);\n          setImportOpened(false);\n          table.refreshTable();\n        }}\n      />\n    </>\n  );\n}\n"],"names":["ParameterTable","modelType","modelId","allowEdit","table","useTable","user","useUserState","tableColumns","useMemo","accessor","switchable","sortable","ordering","DescriptionColumn","render","record","template","template_detail","checkbox","jsx","YesNoButton","data","extra","units","data_numeric","numeric","formatDecimal","digits","push","TableHoverCard","_i18n","_","id","NoteColumn","DateColumn","title","UserColumn","tableFilters","name","label","description","type","UserFilter","selectedParameter","setSelectedParameter","useState","undefined","importOpened","setImportOpened","selectedSession","setSelectedSession","importSessionFields","fields","dataImporterSessionFields","ModelType","parameter","field_overrides","value","model_type","model_id","importParameters","useCreateApiFormModal","url","ApiEndpoints","import_session_list","onFormSuccess","response","pk","newParameter","parameter_list","useParameterFields","initialData","editParameter","useEditApiFormModal","deleteParameter","useDeleteApiFormModal","tableActions","ActionDropdown","IconPlus","hasAddPermission","icon","tooltip","onClick","open","IconFileUpload","rowActions","useCallback","RowEditAction","hidden","hasChangePermission","RowDeleteAction","hasDeletePermission","jsxs","Fragment","modal","InvenTreeTable","apiUrl","enableDownload","enableBulkDelete","enableSelection","params","ImporterDrawer","refreshTable"],"mappings":"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"}