{"version":3,"file":"CommonForms-DKQecQmS.js","sources":["../../../../../../frontend/src/forms/CommonForms.tsx"],"sourcesContent":["import { IconUsers } from '@tabler/icons-react';\nimport { useEffect, useMemo, useState } from 'react';\n\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport type { ModelType } from '@lib/enums/ModelType';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { ApiFormFieldSet } from '@lib/types/Forms';\nimport { t } from '@lingui/core/macro';\nimport type {\n  StatusCodeInterface,\n  StatusCodeListInterface\n} from '../components/render/StatusRenderer';\nimport { useApi } from '../contexts/ApiContext';\nimport { useGlobalStatusState } from '../states/GlobalStatusState';\n\nexport function projectCodeFields(): ApiFormFieldSet {\n  return {\n    code: {},\n    description: {},\n    responsible: {\n      icon: <IconUsers />\n    }\n  };\n}\n\nexport function useCustomStateFields(): ApiFormFieldSet {\n  // Status codes\n  const statusCodes = useGlobalStatusState();\n\n  // Selected base status class\n  const [statusClass, setStatusClass] = useState<string>('');\n\n  // Construct a list of status options based on the selected status class\n  const statusOptions: any[] = useMemo(() => {\n    const options: any[] = [];\n\n    const valuesList = Object.values(statusCodes.status ?? {}).find(\n      (value: StatusCodeListInterface) => value.status_class === statusClass\n    );\n\n    Object.values(valuesList?.values ?? {}).forEach(\n      (value: StatusCodeInterface) => {\n        options.push({\n          value: value.key,\n          display_name: value.label\n        });\n      }\n    );\n\n    return options;\n  }, [statusCodes, statusClass]);\n\n  return useMemo(() => {\n    return {\n      reference_status: {\n        onValueChange(value) {\n          setStatusClass(value);\n        }\n      },\n      logical_key: {\n        field_type: 'choice',\n        choices: statusOptions\n      },\n      key: {},\n      name: {},\n      label: {},\n      color: {},\n      model: {}\n    };\n  }, [statusOptions]);\n}\n\nexport function customUnitsFields(): ApiFormFieldSet {\n  return {\n    name: {},\n    definition: {},\n    symbol: {}\n  };\n}\n\nexport function extraLineItemFields(): ApiFormFieldSet {\n  return {\n    order: {\n      hidden: true\n    },\n    reference: {},\n    description: {},\n    quantity: {},\n    price: {},\n    price_currency: {},\n    project_code: {\n      description: t`Select project code for this line item`\n    },\n    notes: {},\n    link: {}\n  };\n}\n\nexport function useParameterFields({\n  modelType,\n  modelId\n}: {\n  modelType: ModelType;\n  modelId: number;\n}): ApiFormFieldSet {\n  const api = useApi();\n\n  // Valid field choices\n  const [choices, setChoices] = useState<any[]>([]);\n\n  // Field type for \"data\" input\n  const [fieldType, setFieldType] = useState<'string' | 'boolean' | 'choice'>(\n    'string'\n  );\n\n  const [data, setData] = useState<string>('');\n\n  // Reset the field type and choices when the model changes\n  useEffect(() => {\n    setFieldType('string');\n    setChoices([]);\n    setData('');\n  }, [modelType, modelId]);\n\n  return useMemo(() => {\n    return {\n      model_type: {\n        hidden: true,\n        value: modelType\n      },\n      model_id: {\n        hidden: true,\n        value: modelId\n      },\n      template: {\n        filters: {\n          for_model: modelType,\n          enabled: true\n        },\n        onValueChange: (value: any, record: any) => {\n          // Adjust the type of the \"data\" field based on the selected template\n          if (record?.checkbox) {\n            // This is a \"checkbox\" field\n            setChoices([]);\n            setFieldType('boolean');\n          } else if (record?.choices) {\n            const _choices: string[] = record.choices.split(',');\n\n            if (_choices.length > 0) {\n              setChoices(\n                _choices.map((choice) => {\n                  return {\n                    display_name: choice.trim(),\n                    value: choice.trim()\n                  };\n                })\n              );\n              setFieldType('choice');\n            } else {\n              setChoices([]);\n              setFieldType('string');\n            }\n          } else if (record?.selectionlist) {\n            api\n              .get(\n                apiUrl(ApiEndpoints.selectionlist_detail, record.selectionlist)\n              )\n              .then((res) => {\n                setChoices(\n                  res.data.choices.map((item: any) => {\n                    return {\n                      value: item.value,\n                      display_name: item.label\n                    };\n                  })\n                );\n                setFieldType('choice');\n              });\n          } else {\n            setChoices([]);\n            setFieldType('string');\n          }\n        }\n      },\n      data: {\n        value: data,\n        onValueChange: (value: any) => {\n          setData(value);\n        },\n        type: fieldType,\n        field_type: fieldType,\n        choices: fieldType === 'choice' ? choices : undefined,\n        default: fieldType === 'boolean' ? false : undefined,\n        adjustValue: (value: any) => {\n          // Coerce boolean value into a string (required by backend)\n\n          let v: string = value.toString().trim();\n\n          if (fieldType === 'boolean') {\n            if (v.toLowerCase() !== 'true') {\n              v = 'false';\n            }\n          }\n\n          return v;\n        }\n      },\n      note: {}\n    };\n  }, [data, modelType, fieldType, choices, modelId]);\n}\n"],"names":["projectCodeFields","code","description","responsible","icon","IconUsers","useCustomStateFields","statusCodes","useGlobalStatusState","statusClass","setStatusClass","useState","statusOptions","useMemo","options","valuesList","Object","values","status","find","value","status_class","forEach","push","key","display_name","label","reference_status","onValueChange","logical_key","field_type","choices","name","color","model","customUnitsFields","definition","symbol","extraLineItemFields","order","hidden","reference","quantity","price","price_currency","project_code","_i18n","_","id","notes","link","useParameterFields","modelType","modelId","api","useApi","setChoices","fieldType","setFieldType","data","setData","useEffect","model_type","model_id","template","filters","for_model","enabled","record","checkbox","_choices","split","length","map","choice","trim","selectionlist","get","apiUrl","ApiEndpoints","selectionlist_detail","then","res","item","type","undefined","default","adjustValue","v","toString","toLowerCase","note"],"mappings":"4KAeO,SAASA,GAAqC,CACnD,MAAO,CACLC,KAAM,CAAA,EACNC,YAAa,CAAA,EACbC,YAAa,CACXC,WAAOC,EAAA,CAAA,CAAS,CAAA,CAClB,CAEJ,CAEO,SAASC,GAAwC,CAEtD,MAAMC,EAAcC,EAAAA,EAGd,CAACC,EAAaC,CAAc,EAAIC,EAAAA,SAAiB,EAAE,EAGnDC,EAAuBC,EAAAA,QAAQ,IAAM,CACzC,MAAMC,EAAiB,CAAA,EAEjBC,EAAaC,OAAOC,OAAOV,EAAYW,QAAU,CAAA,CAAE,EAAEC,KACxDC,GAAmCA,EAAMC,eAAiBZ,CAC7D,EAEAO,cAAOC,OAAOF,GAAYE,QAAU,CAAA,CAAE,EAAEK,QACrCF,GAA+B,CAC9BN,EAAQS,KAAK,CACXH,MAAOA,EAAMI,IACbC,aAAcL,EAAMM,KAAAA,CACrB,CACH,CACF,EAEOZ,CACT,EAAG,CAACP,EAAaE,CAAW,CAAC,EAE7B,OAAOI,EAAAA,QAAQ,KACN,CACLc,iBAAkB,CAChBC,cAAcR,EAAO,CACnBV,EAAeU,CAAK,CACtB,CAAA,EAEFS,YAAa,CACXC,WAAY,SACZC,QAASnB,CAAAA,EAEXY,IAAK,CAAA,EACLQ,KAAM,CAAA,EACNN,MAAO,CAAA,EACPO,MAAO,CAAA,EACPC,MAAO,CAAA,CAAC,GAET,CAACtB,CAAa,CAAC,CACpB,CAEO,SAASuB,GAAqC,CACnD,MAAO,CACLH,KAAM,CAAA,EACNI,WAAY,CAAA,EACZC,OAAQ,CAAA,CAAC,CAEb,CAEO,SAASC,GAAuC,CACrD,MAAO,CACLC,MAAO,CACLC,OAAQ,EAAA,EAEVC,UAAW,CAAA,EACXvC,YAAa,CAAA,EACbwC,SAAU,CAAA,EACVC,MAAO,CAAA,EACPC,eAAgB,CAAA,EAChBC,aAAc,CACZ3C,YAAW4C,EAAAC,EAAE,CAAAC,GAAA,QAAA,CAAwC,CAAC,EAExDC,MAAO,CAAA,EACPC,KAAM,CAAA,CAAC,CAEX,CAEO,SAASC,EAAmB,CACjCC,UAAAA,EACAC,QAAAA,CAIF,EAAoB,CAClB,MAAMC,EAAMC,EAAAA,EAGN,CAACxB,EAASyB,CAAU,EAAI7C,EAAAA,SAAgB,CAAA,CAAE,EAG1C,CAAC8C,EAAWC,CAAY,EAAI/C,EAAAA,SAChC,QACF,EAEM,CAACgD,EAAMC,CAAO,EAAIjD,EAAAA,SAAiB,EAAE,EAG3CkD,OAAAA,EAAAA,UAAU,IAAM,CACdH,EAAa,QAAQ,EACrBF,EAAW,CAAA,CAAE,EACbI,EAAQ,EAAE,CACZ,EAAG,CAACR,EAAWC,CAAO,CAAC,EAEhBxC,EAAAA,QAAQ,KACN,CACLiD,WAAY,CACVtB,OAAQ,GACRpB,MAAOgC,CAAAA,EAETW,SAAU,CACRvB,OAAQ,GACRpB,MAAOiC,CAAAA,EAETW,SAAU,CACRC,QAAS,CACPC,UAAWd,EACXe,QAAS,EAAA,EAEXvC,cAAeA,CAACR,EAAYgD,IAAgB,CAE1C,GAAIA,GAAQC,SAEVb,EAAW,CAAA,CAAE,EACbE,EAAa,SAAS,UACbU,GAAQrC,QAAS,CAC1B,MAAMuC,EAAqBF,EAAOrC,QAAQwC,MAAM,GAAG,EAE/CD,EAASE,OAAS,GACpBhB,EACEc,EAASG,IAAKC,IACL,CACLjD,aAAciD,EAAOC,KAAAA,EACrBvD,MAAOsD,EAAOC,KAAAA,CAAK,EAEtB,CACH,EACAjB,EAAa,QAAQ,IAErBF,EAAW,CAAA,CAAE,EACbE,EAAa,QAAQ,EAEzB,MAAWU,GAAQQ,cACjBtB,EACGuB,IACCC,EAAOC,EAAaC,qBAAsBZ,EAAOQ,aAAa,CAChE,EACCK,KAAMC,GAAQ,CACb1B,EACE0B,EAAIvB,KAAK5B,QAAQ0C,IAAKU,IACb,CACL/D,MAAO+D,EAAK/D,MACZK,aAAc0D,EAAKzD,KAAAA,EAEtB,CACH,EACAgC,EAAa,QAAQ,CACvB,CAAC,GAEHF,EAAW,CAAA,CAAE,EACbE,EAAa,QAAQ,EAEzB,CAAA,EAEFC,KAAM,CACJvC,MAAOuC,EACP/B,cAAgBR,GAAe,CAC7BwC,EAAQxC,CAAK,CACf,EACAgE,KAAM3B,EACN3B,WAAY2B,EACZ1B,QAAS0B,IAAc,SAAW1B,EAAUsD,OAC5CC,QAAS7B,IAAc,UAAY,GAAQ4B,OAC3CE,YAAcnE,GAAe,CAG3B,IAAIoE,EAAYpE,EAAMqE,SAAAA,EAAWd,KAAAA,EAEjC,OAAIlB,IAAc,WACZ+B,EAAEE,YAAAA,IAAkB,SACtBF,EAAI,SAIDA,CACT,CAAA,EAEFG,KAAM,CAAA,CAAC,GAER,CAAChC,EAAMP,EAAWK,EAAW1B,EAASsB,CAAO,CAAC,CACnD"}