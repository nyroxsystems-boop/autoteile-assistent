import{ag as V,r as a,ab as t,bb as u,ao as _,j as o,aq as G,b1 as b,an as J}from"./index-Db7AGPIq.js";import{A as K}from"./ActionButton-Cv5j5I5R.js";import{u as U,R as P,c as H,I as T}from"./InvenTreeTable-DmN557zY.js";import{f as Z}from"./formatters-B4ehJgEk.js";import{h as z}from"./SalesOrderForms-DoG2xqUe.js";import{y as O,j as Q,b as W,c as $,e as I}from"./Filter-BgnAqEQC.js";import{u as ee}from"./UseStockAdjustActions-BrgagWbF.js";import{R as te,D as j,S as se,P as ie,f as ae}from"./ColumnRenderers-BUH0stTX.js";import{a as le,ac as oe,H as re}from"./ThemeContext-CxdCkKtz.js";function Ae({partId:r,stockId:x,orderId:n,lineItemId:M,shipmentId:h,showPartInfo:d,showOrderInfo:c,allowEdit:m,isSubTable:s,modelTarget:v,modelField:S}){const p=V(),y=le(),q=a.useMemo(()=>{let e="salesorderallocations";return r&&(e+="-part"),s&&(e+="-sub"),e},[r,s]),i=U(q),D=a.useMemo(()=>{const e=[{name:"outstanding",label:t._({id:"aimnwe"}),description:t._({id:"ILsgZ4"})},{name:"assigned_to_shipment",label:t._({id:"uvBviC"}),description:t._({id:"U6KGSj"})},O()];return r&&e.push(Q()),e},[r]),X=a.useMemo(()=>[te({accessor:"order_detail.reference",title:t._({id:"LozYBo"}),switchable:!1,sortable:!0,hidden:c!=!0}),j({accessor:"order_detail.description",hidden:c!=!0}),se({accessor:"order_detail.status",model:u.salesorder,title:t._({id:"acIJ41"}),hidden:c!=!0}),ie({hidden:d!=!0,part:"part_detail"}),j({accessor:"part_detail.description",hidden:d!=!0}),{accessor:"part_detail.IPN",title:t._({id:"3wXEsN"}),hidden:d!=!0,sortable:!0,ordering:"IPN"},{accessor:"serial",title:t._({id:"AXeJt4"}),sortable:!0,switchable:!0,render:e=>e?.item_detail?.serial},{accessor:"batch",title:t._({id:"Vea6Aj"}),sortable:!0,switchable:!0,render:e=>e?.item_detail?.batch},{accessor:"available",title:t._({id:"I8CEek"}),sortable:!1,hidden:s,render:e=>e?.item_detail?.quantity},{accessor:"quantity",title:t._({id:"Tk6w1l"}),sortable:!0},ae({accessor:"location_detail",switchable:!0,sortable:!0}),{accessor:"shipment_detail.reference",title:t._({id:"4fws5M"}),switchable:!0,sortable:!1,render:e=>e.shipment_detail?.reference??t._({id:"Xmnh8X"})},{accessor:"shipment_date",title:t._({id:"MFQxyA"}),switchable:!0,sortable:!0,render:e=>e.shipment_detail?.shipment_date?Z(e.shipment_detail.shipment_date):e.shipment?t._({id:"BVdqnq"}):t._({id:"Xmnh8X"})}],[c,d,s]),[k,g]=a.useState(0),[w,B]=a.useState(null),L=z({orderId:n,shipment:w}),C=W({url:_.sales_order_allocation_list,pk:k,fields:L,title:t._({id:"+2kti8"}),onFormSuccess:()=>i.refreshTable()}),F=$({url:_.sales_order_allocation_list,pk:k,title:t._({id:"pZuBa9"}),preFormContent:o.jsx(G,{color:"red",title:t._({id:"f/P5VY"}),children:t._({id:"NgdYvc"})}),submitText:t._({id:"t/YqKh"}),onFormSuccess:()=>i.refreshTable()}),N=a.useCallback(e=>{const l=!!e.shipment_detail?.shipment_date;return[P({tooltip:t._({id:"+2kti8"}),hidden:l||!m||!p.hasChangeRole(b.sales_order),onClick:()=>{g(e.pk),B(e.shipment),C.open()}}),{title:t._({id:"t/YqKh"}),tooltip:t._({id:"GN9iO5"}),icon:o.jsx(oe,{}),color:"red",hidden:l||!m||!p.hasDeleteRole(b.sales_order),onClick:()=>{g(e.pk),F.open()}},H({tooltip:t._({id:"GtJdx7"}),title:t._({id:"GtJdx7"}),hidden:!e.shipment||!!h,modelId:e.shipment,modelType:u.salesordershipment,navigate:y})]},[m,h,p]),Y=a.useMemo(()=>({items:i.selectedRecords.filter(l=>!!l.item_detail).map(l=>({...l.item_detail,part_detail:l.part_detail,location_detail:l.location_detail})),model:u.stockitem,refresh:i.refreshTable}),[i.selectedRecords,i.refreshTable]),f=ee({formProps:Y,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),A=a.useMemo(()=>(i.selectedRecords?.filter(e=>!e.shipment_detail?.shipment_date)??[]).map(e=>e.pk),[i.selectedRecords]),R=I({url:_.sales_order_allocation_list,items:A,title:t._({id:"jLpOuT"}),fields:{shipment:{filters:{order:n,shipped:!1}}},onFormSuccess:i.refreshTable}),E=a.useMemo(()=>[f.dropdown,o.jsx(K,{tooltip:t._({id:"7m2EYK"}),icon:o.jsx(re,{}),onClick:()=>{R.open()},disabled:A.length==0,hidden:!n||!m||!p.hasChangeRole(b.sales_order)})],[m,A,n,p,f.dropdown]);return o.jsxs(o.Fragment,{children:[R.modal,C.modal,F.modal,!s&&f.modals.map(e=>e.modal),o.jsx(T,{url:J(_.sales_order_allocation_list),tableState:i,columns:X,props:{params:{part_detail:d??!1,order_detail:c??!1,item_detail:!0,location_detail:!0,line:M,part:r,order:n,shipment:h,item:x},enableSearch:!s,enableRefresh:!s,enableColumnSwitching:!s,enableFilters:!s,enableDownload:!s,enableSelection:!s,minHeight:s?100:void 0,rowActions:N,tableActions:s?void 0:E,tableFilters:D,modelField:S??"order",enableReports:!s,enableLabels:!s,printingAccessor:"item",modelType:v??u.salesorder}})]})}export{Ae as S};
//# sourceMappingURL=SalesOrderAllocationTable-siytHB8m.js.map
