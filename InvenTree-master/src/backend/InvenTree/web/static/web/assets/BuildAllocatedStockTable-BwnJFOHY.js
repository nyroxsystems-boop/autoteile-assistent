import{ag as L,r as a,ab as e,bb as _,ao as p,j as o,aq as v,b1 as r,an as B}from"./index-Db7AGPIq.js";import{u as E,R as V,I as Y}from"./InvenTreeTable-DmN557zY.js";import{A as K}from"./ActionButton-Cv5j5I5R.js";import{g as P}from"./BuildForms-BotNgtQh.js";import{j as U,y as O,b as X,c as J}from"./Filter-BgnAqEQC.js";import{u as W}from"./UseStockAdjustActions-BrgagWbF.js";import{R as G,S as Z,P as z,c as g,f as H}from"./ColumnRenderers-BUH0stTX.js";import{I as x}from"./IconCircleDashedCheck-DnGBn8Eq.js";import{ac as Q}from"./ThemeContext-CxdCkKtz.js";function ce({buildId:u,stockId:T,partId:c,showBuildInfo:d,showPartInfo:n,allowEdit:k,modelTarget:j,modelField:I}){const l=L(),s=E(c?"buildallocatedstock-part":"buildallocatedstock"),F=a.useMemo(()=>{const t=[{name:"tracked",label:e._({id:"ML+087"}),description:e._({id:"mVVw+/"})}];return c&&t.push(U()),t.push(O()),t},[c]),w=a.useMemo(()=>[G({accessor:"build_detail.reference",title:e._({id:"YxwWvi"}),switchable:!1,hidden:d!=!0}),{accessor:"build_detail.title",title:e._({id:"Nu4oKW"}),hidden:d!=!0},Z({accessor:"build_detail.status",model:_.build,title:e._({id:"acIJ41"}),hidden:d!=!0}),z({hidden:!n,switchable:!1}),{accessor:"part_detail.IPN",ordering:"IPN",hidden:!n,title:e._({id:"3wXEsN"}),sortable:!0,switchable:!0},{hidden:!n,accessor:"bom_reference",title:e._({id:"N2C89m"}),sortable:!0,switchable:!0},{accessor:"serial",title:e._({id:"AXeJt4"}),sortable:!1,switchable:!0,render:t=>t?.stock_item_detail?.serial},{accessor:"batch",title:e._({id:"Vea6Aj"}),sortable:!1,switchable:!0,render:t=>t?.stock_item_detail?.batch},g({accessor:"available",title:e._({id:"csDS2L"})}),g({accessor:"quantity",title:e._({id:"A/ybx7"}),sortable:!0,switchable:!1}),H({accessor:"location_detail",switchable:!0,sortable:!0}),{accessor:"install_into",title:e._({id:"gILim+"}),sortable:!0},{accessor:"sku",title:e._({id:"nne72x"}),render:t=>t?.supplier_part_detail?.SKU,sortable:!0}],[]),[h,f]=a.useState(0),C=X({pk:h,url:p.build_item_list,title:e._({id:"Tqnsor"}),fields:{stock_item:{disabled:!0},quantity:{}},table:s}),R=J({pk:h,url:p.build_item_list,title:e._({id:"pZuBa9"}),submitText:e._({id:"t/YqKh"}),table:s,preFormContent:o.jsx(v,{color:"red",title:e._({id:"f/P5VY"}),children:e._({id:"NgdYvc"})})}),[A,S]=a.useState([]),D=a.useMemo(()=>A.filter(t=>!t.part_detail?.trackable),[A]),m=P({buildId:u??0,allocatedItems:D,onFormSuccess:()=>{s.clearSelectedRecords(),s.refreshTable()}}),M=a.useMemo(()=>({items:s.selectedRecords.filter(i=>!!i.stock_item_detail).map(i=>({...i.stock_item_detail,part_detail:i.part_detail,location_detail:i.location_detail})),model:_.stockitem,refresh:s.refreshTable}),[s.selectedRecords,s.refreshTable]),b=W({formProps:M,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),q=a.useCallback(t=>{const N=(t.part_detail??{})?.trackable??!1;return[{color:"green",icon:o.jsx(x,{}),title:e._({id:"gyu1Ok"}),tooltip:e._({id:"8nBqTf"}),hidden:!u||N||!l.hasChangeRole(r.build),onClick:()=>{S([t]),m.open()}},V({hidden:!l.hasChangeRole(r.build),onClick:()=>{f(t.pk),C.open()}}),{title:e._({id:"t/YqKh"}),tooltip:e._({id:"GN9iO5"}),icon:o.jsx(Q,{}),color:"red",hidden:!l.hasDeleteRole(r.build),onClick:()=>{f(t.pk),R.open()}}]},[l]),y=a.useMemo(()=>[b.dropdown,o.jsx(K,{icon:o.jsx(x,{}),tooltip:e._({id:"8nBqTf"}),hidden:!l.hasChangeRole(r.build),disabled:s.selectedRecords.length==0,color:"green",onClick:()=>{S(s.selectedRecords),m.open()}},"consume-stock")],[l,s.selectedRecords,b.dropdown]);return o.jsxs(o.Fragment,{children:[C.modal,R.modal,m.modal,b.modals.map(t=>t.modal),o.jsx(Y,{tableState:s,url:B(p.build_item_list),columns:w,props:{params:{build:u,part:c,stock_item:T,build_detail:d??!1,part_detail:n??!1,location_detail:!0,stock_detail:!0,supplier_detail:!0},enableBulkDelete:k&&l.hasDeleteRole(r.build),enableDownload:!0,enableSelection:k&&l.hasDeleteRole(r.build),rowActions:q,tableActions:y,tableFilters:F,enableLabels:!0,enableReports:!0,printingAccessor:"stock_item",modelField:I??"stock_item",modelType:j??_.stockitem}})]})}export{ce as B};
//# sourceMappingURL=BuildAllocatedStockTable-BwnJFOHY.js.map
