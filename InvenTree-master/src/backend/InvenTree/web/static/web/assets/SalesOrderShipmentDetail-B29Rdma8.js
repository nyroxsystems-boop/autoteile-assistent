import{ag as z,r as a,ao as l,j as t,b4 as G,ab as s,bb as r,d as j,by as S,b1 as v,a7 as Q,S as q,aD as I}from"./index-Db7AGPIq.js";import{a8 as K,n as H,b as N,c as V,a as Z,k as $}from"./Filter-BgnAqEQC.js";import{P as L}from"./PrimaryActionButton-CsYjCYWq.js";import{B as W,P as X,O as J,E as ee,C as te}from"./InvenTreeTable-DmN557zY.js";import{I as se,D as u,a as ie}from"./InstanceDetail-CF-uHhEW.js";import{D as _}from"./DetailsBadge-rxZ_XzUd.js";import{D as re,A as oe,N as ae}from"./NotesPanel-BpiQDImp.js";import{P as ne}from"./PageDetail-Bm50kpyR.js";import{P as de}from"./PanelGroup-Bif3iIGQ.js";import{f as D}from"./formatters-B4ehJgEk.js";import{d as le,e as me,f as ce,g as pe}from"./SalesOrderForms-DoG2xqUe.js";import{u as F}from"./UseInstance-BPJQEWDW.js";import{S as _e}from"./SalesOrderAllocationTable-siytHB8m.js";import{E as ue,a as he,r as be,ac as ke}from"./ThemeContext-CxdCkKtz.js";import{I as fe}from"./IconBookmark-1j99fCof.js";import"./DesktopAppView-BuH2j218.js";import"./ActionButton-Cv5j5I5R.js";import"./IconChevronDown-CzbIU38Y.js";import"./index-DRtKJP-e.js";import"./QRCode-BaIEIQ2d.js";import"./browser-DSycY7kT.js";import"./IconDotsVertical-D8D3XsjG.js";import"./IconTags-DnGx22aA.js";import"./YesNoButton-BaVgP5u9.js";import"./ModelType-DSs66IM7.js";import"./GenericErrorPage-D-1fKCA7.js";import"./NotFound-CsJ_VLc_.js";import"./PermissionDenied-BDbEipg4.js";import"./use-hover-Cq0v4QX_.js";import"./index-Chjiymov.js";import"./AttachmentLink-D_UWVUZG.js";import"./PageTitle-B4iaHXKM.js";import"./PluginUIFeature-DCu8wTdG.js";import"./RemoteComponent-uZoHDwds.js";import"./ColumnRenderers-BUH0stTX.js";import"./IconUsers-Dr_Sln9A.js";import"./IconAddressBook-CdNRMeyy.js";import"./UseStockAdjustActions-BrgagWbF.js";function it(){const{id:A}=ue(),m=z(),P=he();a.useMemo(()=>m.userId(),[m]);const{instance:e,instanceQuery:c,refreshInstance:p}=F({endpoint:l.sales_order_shipment_list,pk:A,params:{order_detail:!0}}),{instance:n,instanceQuery:b}=F({endpoint:l.company_list,pk:e.order_detail?.customer,hasPrimaryKey:!0}),i=a.useMemo(()=>!e.shipment_date,[e]),d=a.useMemo(()=>!!e.checked_by,[e]),k=a.useMemo(()=>{if(c.isFetching||b.isFetching)return t.jsx(G,{});const o={...e,customer:n?.pk,customer_name:n?.name,customer_reference:e.order_detail?.customer_reference},B=[{type:"link",model:r.salesorder,name:"order",label:s._({id:"LozYBo"}),icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",icon:"customers",label:s._({id:"876pfE"}),model:r.company,model_field:"name",hidden:!o.customer},{type:"link",external:!0,name:"link",label:s._({id:"yzF66j"}),copy:!0,hidden:!e.link}],U=[{type:"text",name:"customer_reference",icon:"serial",label:s._({id:"ZVUe1A"}),hidden:!o.customer_reference,copy:!0},{type:"text",name:"reference",icon:"serial",label:s._({id:"Dwgrby"}),copy:!0},{type:"text",name:"tracking_number",label:s._({id:"DTku8S"}),icon:"trackable",value_formatter:()=>e.tracking_number||"---",copy:!!e.tracking_number},{type:"text",name:"invoice_number",label:s._({id:"MhyecB"}),icon:"serial",value_formatter:()=>e.invoice_number||"---",copy:!!e.invoice_number}],R=e.shipment_address_detail||e.order_detail?.address_detail,O=[{type:"text",name:"address",label:s._({id:"g6yaYE"}),icon:"address",value_formatter:()=>R?t.jsx(K,{instance:e.shipment_address_detail||e.order_detail?.address_detail}):t.jsx(j,{size:"sm",c:"red",children:s._({id:"dm2vYF"})})}],T=[{type:"text",name:"allocated_items",icon:"packages",label:s._({id:"sdy17V"})},{type:"text",name:"checked_by",label:s._({id:"3hwu1C"}),icon:"check",value_formatter:()=>e.checked_by_detail?t.jsx(H,{instance:e.checked_by_detail}):t.jsx(j,{size:"sm",c:"red",children:s._({id:"zjdtIu"})})},{type:"text",name:"shipment_date",label:s._({id:"MFQxyA"}),icon:"calendar",value_formatter:()=>D(e.shipment_date),hidden:!e.shipment_date},{type:"text",name:"delivery_date",label:s._({id:"ovm9ir"}),icon:"calendar",value_formatter:()=>D(e.delivery_date),hidden:!e.delivery_date}];return t.jsx(t.Fragment,{children:t.jsxs(se,{children:[t.jsxs(S,{grow:!0,children:[t.jsx(re,{appRole:v.sales_order,apiPath:l.company_list,src:n?.image,pk:n?.pk,imageActions:{selectExisting:!1,downloadImage:!1,uploadFile:!1,deleteFile:!1}}),t.jsx(S.Col,{span:{base:12,sm:8},children:t.jsx(u,{fields:B,item:o})})]}),t.jsx(u,{fields:U,item:o}),t.jsx(u,{fields:O,item:o}),t.jsx(u,{fields:T,item:o})]})})},[e,c,n,b]),C=a.useMemo(()=>[{name:"detail",label:s._({id:"aaEiwW"}),icon:t.jsx(be,{}),content:k},{name:"items",label:s._({id:"MD2yP5"}),icon:t.jsx(fe,{}),content:t.jsx(_e,{orderId:e.order,shipmentId:e.pk,showPartInfo:!0,allowEdit:i,modelField:"item",modelTarget:r.stockitem})},oe({model_type:r.salesordershipment,model_id:e.pk}),ae({model_type:r.salesordershipment,model_id:e.pk})],[i,e,k]),M=le({pending:i,customerId:e.order_detail?.customer}),h=N({url:l.sales_order_shipment_list,pk:e.pk,fields:M,title:s._({id:"rX/5YH"}),onFormSuccess:p}),f=V({url:l.sales_order_shipment_list,pk:e.pk,title:s._({id:"YAsuZ2"}),onFormSuccess:()=>{P(I(r.salesorder,e.order))}}),E=me({}),x=Z({url:l.sales_order_shipment_complete,pk:e.pk,fields:E,title:s._({id:"/IxVda"}),focus:"tracking_number",initialData:{...e,shipment_date:$().format("YYYY-MM-DD")},onFormSuccess:p}),y=ce({shipmentId:e.pk,onSuccess:p}),g=pe({shipmentId:e.pk,onSuccess:p}),Y=a.useMemo(()=>c.isFetching?[]:[t.jsx(_,{label:s._({id:"UbRKMZ"}),color:"gray",visible:i},"pending"),t.jsx(_,{label:s._({id:"VSGGki"}),color:"green",visible:i&&d},"checked"),t.jsx(_,{label:s._({id:"WPp4C4"}),color:"red",visible:i&&!d},"not-checked"),t.jsx(_,{label:s._({id:"AoOqHM"}),color:"green",visible:!i},"shipped"),t.jsx(_,{label:s._({id:"BTOhSm"}),color:"blue",visible:!!e.delivery_date},"delivered")],[i,d,e.deliveryDate,c.isFetching]),w=a.useMemo(()=>{const o=m.hasChangePermission(r.salesordershipment);return[t.jsx(L,{title:s._({id:"1mYYQ6"}),icon:"sales_orders",hidden:!i,color:"green",onClick:()=>{x.open()}},"send-shipment"),t.jsx(W,{model:r.salesordershipment,pk:e.pk,hash:e?.barcode_hash},"barcode"),t.jsx(X,{modelType:r.salesordershipment,items:[e.pk],enableLabels:!0,enableReports:!0},"print"),t.jsx(J,{tooltip:s._({id:"8ijAtN"}),actions:[ee({hidden:!o,onClick:h.open,tooltip:s._({id:"rX/5YH"})}),{hidden:!i||d,name:s._({id:"9td1Wl"}),tooltip:s._({id:"Hg9xwv"}),icon:t.jsx(Q,{color:"green"}),onClick:y.open},{hidden:!i||!d,name:s._({id:"KtJ7KJ"}),tooltip:s._({id:"s7mDq/"}),icon:t.jsx(ke,{color:"red"}),onClick:g.open},te({hidden:!i,onClick:f.open,tooltip:s._({id:"YAsuZ2"})})]},"actions")]},[d,i,m,e]);return t.jsxs(t.Fragment,{children:[x.modal,h.modal,f.modal,y.modal,g.modal,t.jsx(ie,{query:c,requiredRole:v.sales_order,children:t.jsxs(q,{gap:"xs",children:[t.jsx(ne,{title:`${s._({id:"qGSobR"})}: ${e.reference}`,subtitle:`${s._({id:"LozYBo"})}: ${e.order_detail?.reference}`,breadcrumbs:[{name:s._({id:"mUv9U4"}),url:"/sales/"},{name:e.order_detail?.reference,url:I(r.salesorder,e.order)}],badges:Y,imageUrl:n?.image,editAction:h.open,editEnabled:m.hasChangePermission(r.salesordershipment),actions:w}),t.jsx(de,{pageKey:"salesordershipment",panels:C,model:r.salesordershipment,reloadInstance:p,instance:e,id:e.pk})]})})]})}export{it as default};
//# sourceMappingURL=SalesOrderShipmentDetail-B29Rdma8.js.map
