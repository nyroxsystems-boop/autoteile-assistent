import{K as qe,ag as ee,ab as t,an as S,ao as p,r as o,bb as l,j as s,b1 as b,b4 as K,az as fe,N as M,d as V,aa as G,am as ne,av as re,a7 as ze,ak as N,al as Ee,O as de,aD as w,by as ce,as as T,bG as Be,S as Ue,bE as Ne}from"./index-Db7AGPIq.js";import{a8 as Ke,v as ye,r as ge,a9 as Oe,a as je,E as We,w as Le,aa as Ve,S as ue,U as Ge,a6 as Ye,t as me,F as Qe,G as He}from"./ThemeContext-CxdCkKtz.js";import{A as Xe}from"./ActionButton-Cv5j5I5R.js";import{A as Je}from"./AdminButton-BR7cWvGK.js";import{u as te,I as se,R as $e,a as Ze,e as et,B as tt,P as st,A as at,O as it,b as lt,E as ot,D as nt}from"./InvenTreeTable-DmN557zY.js";import{I as rt,D as L,a as dt}from"./InstanceDetail-CF-uHhEW.js";import{D as I}from"./DetailsBadge-rxZ_XzUd.js";import{D as ct,A as ut,N as mt}from"./NotesPanel-BpiQDImp.js";import{N as pt}from"./NavigationTree-D8kcQU6q.js";import{P as _t}from"./PageDetail-Bm50kpyR.js";import{P as kt}from"./PanelGroup-Bif3iIGQ.js";import{L as bt}from"./LocateItemButton-CGQeChN6.js";import{a as O,f as Y,d as ve,b as Se,c as Ae,o as pe,p as Ie,g as ht,q as xt,r as ft,s as yt,t as gt,v as jt,w as vt,U as St,n as At}from"./Filter-BgnAqEQC.js";import{I as It,O as wt}from"./OrderPartsWizard-BcMgRjfh.js";import{u as we}from"./DesktopAppView-BuH2j218.js";import{f as _e,b as ke}from"./formatters-B4ehJgEk.js";import{b as Tt,d as Mt,e as be,a as Ct,f as he,g as Rt}from"./PluginUIFeature-DCu8wTdG.js";import{u as xe}from"./UseInstance-BPJQEWDW.js";import{u as Dt}from"./UseStockAdjustActions-BrgagWbF.js";import{B as Ft}from"./BuildAllocatedStockTable-BwnJFOHY.js";import{S as Pt}from"./SalesOrderAllocationTable-siytHB8m.js";import{P as qt,S as zt,D as Te,N as Et,a as Me,U as Bt}from"./ColumnRenderers-BUH0stTX.js";import{S as Ut}from"./StockItemTable-CHHhSxX_.js";import{W as Nt}from"./index-DRtKJP-e.js";import{P as Kt}from"./YesNoButton-BaVgP5u9.js";import{A as Ot}from"./AttachmentLink-D_UWVUZG.js";import{R as Wt}from"./RowExpansionIcon-DC7o6kBm.js";import{b as Lt}from"./IconChevronDown-CzbIU38Y.js";import{I as Vt}from"./IconBookmark-1j99fCof.js";import{I as Gt}from"./IconChecklist-CFul5P3t.js";import"./QRCode-BaIEIQ2d.js";import"./browser-DSycY7kT.js";import"./IconDotsVertical-D8D3XsjG.js";import"./IconTags-DnGx22aA.js";import"./ModelType-DSs66IM7.js";import"./GenericErrorPage-D-1fKCA7.js";import"./NotFound-CsJ_VLc_.js";import"./PermissionDenied-BDbEipg4.js";import"./use-hover-Cq0v4QX_.js";import"./index-Chjiymov.js";import"./IconChevronRight-V14UdNcU.js";import"./PageTitle-B4iaHXKM.js";import"./RemoteComponent-uZoHDwds.js";import"./UsePlugins-BAQCKs7Q.js";import"./CompanyForms-CIJgkbDe.js";import"./IconAt-rYwKGkPn.js";import"./IconUsers-Dr_Sln9A.js";import"./IconAddressBook-CdNRMeyy.js";import"./BuildForms-BotNgtQh.js";import"./IconCircleDashedCheck-DnGBn8Eq.js";import"./SalesOrderForms-DoG2xqUe.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M8 16v.01",key:"svg-1"}],["path",{d:"M8 12v.01",key:"svg-2"}],["path",{d:"M8 8v.01",key:"svg-3"}],["path",{d:"M16 16v.01",key:"svg-4"}],["path",{d:"M16 12v.01",key:"svg-5"}],["path",{d:"M16 8v.01",key:"svg-6"}],["path",{d:"M12 8v.01",key:"svg-7"}],["path",{d:"M12 16v.01",key:"svg-8"}]],Qt=qe("outline","box-padding","BoxPadding",Yt);function Ht({stockItem:c}){const r=te("stock_item_install"),m=ee(),g=Tt({stockItem:c}),u=O({url:S(p.stock_install),pk:c.pk,title:t._({id:"erPDED"}),table:r,successMessage:t._({id:"g+zcGQ"}),fields:g}),[h,x]=o.useState({}),n=Mt(),e=O({url:S(p.stock_uninstall),pk:h.pk,title:t._({id:"q2BZiX"}),table:r,successMessage:t._({id:"ibtYlF"}),fields:n,initialData:{location:c.location??c.part_detail?.default_location}}),f=o.useMemo(()=>[qt({part:"part_detail"}),{accessor:"quantity",switchable:!1,render:_=>{let A=Y(_.quantity);return _.serial&&_.quantity==1&&(A=`# ${_.serial}`),A}},{accessor:"batch",switchable:!1},zt({model:l.stockitem})],[]),P=o.useMemo(()=>[s.jsx(ve,{tooltip:t._({id:"erPDED"}),onClick:()=>{u.open()},hidden:!m.hasChangeRole(b.stock)||c.is_building||c.part_detail?.assembly!=!0},"install")],[c,m]),v=o.useCallback(_=>[{title:t._({id:"fo0VXg"}),tooltip:t._({id:"mGSvSz"}),onClick:()=>{x(_),e.open()},icon:s.jsx(Ke,{}),hidden:!m.hasChangeRole(b.stock)}],[m]);return s.jsxs(s.Fragment,{children:[u.modal,e.modal,c.pk?s.jsx(se,{url:S(p.stock_item_list),tableState:r,columns:f,props:{tableActions:P,enableSelection:!0,enableLabels:!0,enableReports:!0,rowActions:v,modelType:l.stockitem,params:{belongs_to:c.pk,part_detail:!0}}}):s.jsx(K,{})]})}function Xt({partId:c,itemId:r}){const m=we(),g=ee(),u=te("stocktests"),h=fe(),x=o.useMemo(()=>h.isSet("TEST_STATION_DATA"),[h]),{data:n}=ye({queryKey:["stocktesttemplates",c,r],queryFn:async()=>c?m.get(S(p.part_test_template_list),{params:{part:c,include_inherited:!0,enabled:!0}}).then(d=>d.data):[]});o.useEffect(()=>{u.refreshTable()},[n]);const e=o.useCallback(d=>{const a=n?.map(k=>({...k,templateId:k.pk,results:[]}))??[];return d.forEach(k=>{a.find(y=>y.templateId==k.template)||a.push({...k.template_detail,templateId:k.template,results:[]})}),d.sort((k,y)=>k.pk>y.pk?1:-1).forEach(k=>{const y=a.findIndex(U=>U.templateId==k.template);y>=0&&(a[y]={...a[y],...k},a[y].results.push(k))}),a},[c,r,n]),f=o.useCallback(d=>[{accessor:"test",title:t._({id:"NnH3pK"}),switchable:!1,sortable:!0,render:a=>{const k=a.enabled??a.template_detail?.enabled,y=a.stock_item!=null&&a.stock_item!=r,U=a.results&&a.results.length>1;return s.jsxs(M,{justify:"space-between",wrap:"nowrap",children:[s.jsxs(M,{gap:"xs",children:[!d&&s.jsx(Wt,{enabled:U,expanded:u.isRowExpanded(a.pk)}),s.jsxs(V,{style:{fontStyle:y?"italic":void 0},c:k?void 0:"red",children:[!a.templateId&&"- ",a.test_name??a.template_detail?.test_name]})]}),s.jsxs(M,{justify:"right",children:[a.results&&a.results.length>1&&s.jsx(G,{label:t._({id:"isbwWo"}),children:s.jsx(ne,{color:"lightblue",variant:"filled",children:a.results.length})}),y&&s.jsx(G,{label:t._({id:"yd1WJ/"}),children:s.jsx(ge,{size:16,color:"blue"})})]})]})}},{accessor:"result",title:t._({id:"RD6AE9"}),switchable:!1,sortable:!0,render:a=>a.result===void 0?s.jsx(ne,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}):s.jsx(Kt,{value:a.result})},Te({}),{accessor:"value",title:t._({id:"wMHvYH"})},{accessor:"attachment",title:t._({id:"UY1vmE"}),render:a=>a.attachment&&s.jsx(Ot,{attachment:a.attachment}),noContext:!0},Et({}),Me({}),Bt({accessor:"user_detail",ordering:"user"}),{accessor:"test_station",sortable:!0,title:t._({id:"18Lf3c"}),hidden:!x},{accessor:"started_datetime",sortable:!0,title:t._({id:"JEGlfK"}),hidden:!x,render:a=>s.jsx(M,{justify:"space-between",children:_e(a.started_datetime,{showTime:!0,showSeconds:!0})})},{accessor:"finished_datetime",sortable:!0,title:t._({id:"4dQFvz"}),hidden:!x,render:a=>s.jsx(M,{justify:"space-between",children:_e(a.finished_datetime,{showTime:!0,showSeconds:!0})})}],[r,x,u.expandedRecords]),P=o.useMemo(()=>f(!1),[r,x,u.expandedRecords]),[v,_]=o.useState(void 0),A=be({partId:c,itemId:r,templateId:v,editing:!1}),q=be({partId:c,itemId:r,templateId:v,editing:!0}),z=O({url:p.stock_test_result_list,fields:o.useMemo(()=>({...A}),[A]),initialData:{template:v,result:!0},title:t._({id:"VzkBcq"}),table:u,successMessage:t._({id:"VivtT0"})}),[C,R]=o.useState(0),D=Se({url:p.stock_test_result_list,pk:C,fields:o.useMemo(()=>({...q}),[q]),title:t._({id:"1HKt5e"}),onFormSuccess:()=>u.refreshTable,successMessage:t._({id:"G0v/SO"})}),E=Ae({url:p.stock_test_result_list,pk:C,title:t._({id:"381PhV"}),table:u,successMessage:t._({id:"xbuMqN"})}),Q=o.useCallback(d=>{m.post(S(p.stock_test_result_list),{template:d,stock_item:r,result:!0}).then(()=>{u.refreshTable(),re({title:t._({id:"uUlW4e"}),message:t._({id:"uiR3yF"}),color:"green"})}).catch(()=>{re({title:t._({id:"SlfejT"}),message:t._({id:"VjER3N"}),color:"red"})})},[r]),W=o.useCallback(d=>d.stock_item!=null&&d.stock_item!=r?[]:[{title:t._({id:"up/ozE"}),color:"green",icon:s.jsx(ze,{}),hidden:!d.templateId||d?.requires_attachment||d?.requires_value||d.result,onClick:()=>Q(d.templateId)},{title:t._({id:"m16xKo"}),tooltip:t._({id:"VzkBcq"}),color:"green",icon:s.jsx(Oe,{}),hidden:!g.hasAddRole(b.stock)||!d.templateId,onClick:()=>{_(d.templateId),z.open()}},$e({tooltip:t._({id:"1HKt5e"}),hidden:!g.hasChangeRole(b.stock)||!d.template_detail,onClick:()=>{R(d.pk),D.open()}}),Ze({tooltip:t._({id:"381PhV"}),hidden:!g.hasDeleteRole(b.stock)||!d.template_detail,onClick:()=>{R(d.pk),E.open()}})],[g,r]),H=o.useMemo(()=>[{name:"required",label:t._({id:"TMLAx2"}),description:t._({id:"sKK8za"})},{name:"include_installed",label:t._({id:"TD72EF"}),description:t._({id:"BYeSw1"})},{name:"result",label:t._({id:"nqMwPi"}),description:t._({id:"bcwRe2"})},{name:"enabled",label:t._({id:"RxzN1M"}),description:t._({id:"+kMQXd"})}],[]),B=o.useMemo(()=>[s.jsx(ve,{tooltip:t._({id:"VzkBcq"}),onClick:()=>{_(void 0),z.open()},hidden:!g.hasAddRole(b.stock)},"add-test-result")],[g]),X=o.useMemo(()=>{const d=[...f(!0),{accessor:"actions",title:"  ",hidden:!1,switchable:!1,width:50,render:a=>s.jsx(et,{actions:W(a)??[]})}];return{allowMultiple:!0,expandable:({record:a})=>u.isRowExpanded(a.pk)||a.results&&a.results.length>1,content:({record:a})=>{if(!a||!a.results||a.results.length<2)return null;const k=a?.results??[];return s.jsx(Nt,{idAccessor:"test",noHeader:!0,columns:d,records:k.slice(0,-1)},a.pk)}}},[f,u.isRowExpanded]);return s.jsxs(s.Fragment,{children:[z.modal,D.modal,E.modal,s.jsx(se,{url:S(p.stock_test_result_list),tableState:u,columns:P,props:{dataFormatter:e,enablePagination:!1,tableActions:B,tableFilters:H,rowActions:W,rowExpansion:X,params:{stock_item:r,user_detail:!0,attachment_detail:!0,template_detail:!0}}})]})}function Jt({itemId:c}){const r=je(),m=te("stock_tracking"),g=o.useCallback(x=>{const n=x?.deltas??{},e=[{label:t._({id:"igx8Og"}),key:"stockitem",details:n.stockitem_detail&&pe({instance:n.stockitem_detail,link:!0})},{label:t._({id:"igx8Og"}),key:"item",details:n.item_detail&&pe({instance:n.item_detail,link:!0})},{label:t._({id:"uAQUqI"}),key:"status",details:n.status&&Ie({status:n.status,type:l.stockitem})},{label:t._({id:"VbWX2u"}),key:"quantity",details:Y(n.quantity)},{label:t._({id:"hp8OtS"}),key:"added",details:n.added},{label:t._({id:"eps54V"}),key:"removed",details:n.removed},{label:t._({id:"vgP+9p"}),key:"part",details:n.part_detail&&ht({instance:n.part_detail,link:!0,navigate:r})},{label:t._({id:"wJijgU"}),key:"location",details:n.location_detail&&xt({instance:n.location_detail,link:!0,navigate:r})},{label:t._({id:"YxwWvi"}),key:"buildorder",details:n.buildorder_detail&&ft({instance:n.buildorder_detail,link:!0,navigate:r})},{label:t._({id:"KxySMG"}),key:"purchaseorder",details:n.purchaseorder_detail&&yt({instance:n.purchaseorder_detail,link:!0,navigate:r})},{label:t._({id:"LozYBo"}),key:"salesorder",details:n.salesorder_detail&&gt({instance:n.salesorder_detail,link:!0,navigate:r})},{label:t._({id:"Z6ve1w"}),key:"returnorder",details:n.returnorder_detail&&jt({instance:n.returnorder_detail,link:!0,navigate:r})},{label:t._({id:"876pfE"}),key:"customer",details:n.customer_detail&&vt({instance:n.customer_detail,link:!0,navigate:r})}];return s.jsx(N,{striped:!0,children:s.jsx(N.Tbody,{children:e.map(f=>f.details&&s.jsxs(N.Tr,{children:[s.jsx(N.Td,{children:s.jsx(V,{children:f.label})}),s.jsx(N.Td,{children:f.details})]},f.key))})})},[r]),u=o.useMemo(()=>[St({name:"user",label:t._({id:"7PzzBU"}),description:t._({id:"FVjW63"})})],[]),h=o.useMemo(()=>[Me({switchable:!1}),Te({accessor:"label"}),{accessor:"details",title:t._({id:"URmyfc"}),switchable:!1,render:g},{accessor:"notes",title:t._({id:"1DBGsz"}),sortable:!1,switchable:!0},{accessor:"user",title:t._({id:"7PzzBU"}),render:x=>x.user_detail?At({instance:x.user_detail}):s.jsx(V,{size:"sm",fs:"italic",children:t._({id:"L5d7xh"})})}],[]);return s.jsx(se,{tableState:m,url:S(p.stock_tracking_list),columns:h,props:{params:{item:c,user_detail:!0},enableDownload:!0,tableFilters:u}})}function Hs(){const{id:c}=We(),r=we(),m=ee(),g=fe(),u=o.useMemo(()=>g.isSet("STOCK_ENABLE_EXPIRY"),[g]),h=je(),[x,n]=o.useState(!1),{instance:e,refreshInstance:f,refreshInstancePromise:P,instanceQuery:v}=xe({endpoint:p.stock_item_list,pk:c,params:{part_detail:!0,location_detail:!0,path_detail:!0}}),{instance:_,instanceQuery:A}=xe({endpoint:p.stock_serial_info,pk:c}),q=Ct({partId:e.part}),z=o.useMemo(()=>{const i={...e},j=e?.part_detail??{};if(i.available_stock=Math.max(0,i.quantity-i.allocated),v.isFetching)return s.jsx(K,{});const $=[{name:"part",label:t._({id:"mY+KgP"}),type:"link",model:l.part},{name:"part_detail.IPN",label:t._({id:"3wXEsN"}),type:"text",copy:!0,icon:"part",hidden:!j.IPN},{name:"part_detail.revision",label:t._({id:"6LTyxl"}),type:"string",copy:!0,icon:"revision",hidden:!j.revision},{name:"status",type:"status",label:t._({id:"uAQUqI"}),model:l.stockitem},{name:"status_custom_key",type:"status",label:t._({id:"4DvUAJ"}),model:l.stockitem,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status},{type:"link",name:"link",label:t._({id:"yzF66j"}),external:!0,copy:!0,hidden:!e.link}],Z=[{type:"text",name:"serial",label:t._({id:"AXeJt4"}),hidden:!e.serial,value_formatter:()=>s.jsxs(M,{gap:"xs",justify:"space-apart",children:[s.jsx(V,{children:e.serial}),s.jsx(Ee,{flex:10}),s.jsxs(M,{gap:2,justify:"right",children:[_.previous?.pk&&s.jsx(G,{label:t._({id:"6nb2iE"}),position:"top",children:s.jsx(de,{p:3,"aria-label":"previous-serial-number",leftSection:s.jsx(It,{}),variant:"transparent",size:"sm",onClick:()=>{h(w(l.stockitem,_.previous.pk))},children:_.previous.serial})}),s.jsx(Xe,{icon:s.jsx(Le,{size:18}),tooltip:t._({id:"jfMcvL"}),tooltipAlignment:"top",variant:"transparent",onClick:q.open}),_.next?.pk&&s.jsx(G,{label:t._({id:"TVYdHj"}),position:"top",children:s.jsx(de,{p:3,"aria-label":"next-serial-number",rightSection:s.jsx(Lt,{}),variant:"transparent",size:"sm",onClick:()=>{h(w(l.stockitem,_.next.pk))},children:_.next.serial})})]})]})},{type:"number",name:"quantity",label:t._({id:"VbWX2u"}),unit:j?.units,hidden:!!e.serial&&e.quantity==1},{type:"number",name:"available_stock",label:t._({id:"csDS2L"}),unit:j?.units,icon:"stock"},{type:"number",name:"allocated",label:t._({id:"8oSGoC"}),unit:j?.units,icon:"tick_off",hidden:!e.allocated},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!e.batch}],Fe=[{name:"supplier_part",label:t._({id:"nne72x"}),type:"link",model_field:"SKU",model:l.supplierpart,hidden:!e.supplier_part},{type:"link",name:"location",label:t._({id:"wJijgU"}),model:l.stocklocation,hidden:!e.location},{type:"link",name:"belongs_to",label:t._({id:"QPoAhl"}),model_filters:{part_detail:!0},model_formatter:F=>{let oe=F?.part_detail?.full_name??F?.name;return F.serial&&F.quantity==1&&(oe+=` # ${F.serial}`),oe},icon:"stock",model:l.stockitem,hidden:!e.belongs_to},{type:"link",name:"parent",icon:"sitemap",label:t._({id:"0o0T0n"}),model:l.stockitem,hidden:!e.parent,model_formatter:F=>t._({id:"94QKKW"})},{type:"link",name:"consumed_by",label:t._({id:"H00rnl"}),model:l.build,hidden:!e.consumed_by,icon:"build",model_field:"reference"},{type:"link",name:"build",label:t._({id:"YxwWvi"}),model:l.build,hidden:!e.build,model_field:"reference"},{type:"link",name:"purchase_order",label:t._({id:"KxySMG"}),model:l.purchaseorder,hidden:!e.purchase_order,icon:"purchase_orders",model_field:"reference"},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),model:l.salesorder,hidden:!e.sales_order,icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",label:t._({id:"876pfE"}),model:l.company,hidden:!e.customer}],Pe=[{type:"date",name:"expiry_date",label:t._({id:"uaSvqt"}),hidden:!u||!e.expiry_date,icon:"calendar"},{type:"text",name:"purchase_price",label:t._({id:"vWelsN"}),icon:"currency",hidden:!e.purchase_price,value_formatter:()=>ke(e.purchase_price,{currency:e.purchase_price_currency})},{type:"text",name:"stock_value",label:t._({id:"g9RfVq"}),icon:"currency",hidden:!e.purchase_price||e.quantity==1||e.quantity==0,value_formatter:()=>ke(e.purchase_price,{currency:e.purchase_price_currency,multiplier:e.quantity})},{type:"text",name:"packaging",icon:"part",label:t._({id:"pD/Ew0"}),hidden:!e.packaging},{type:"text",name:"updated",icon:"calendar",label:t._({id:"K7P0jz"})},{type:"text",name:"stocktake",icon:"calendar",label:t._({id:"whZ7zT"}),hidden:!e.stocktake}];return s.jsxs(rt,{children:[s.jsxs(ce,{grow:!0,children:[s.jsx(ct,{appRole:b.part,apiPath:p.part_list,src:e.part_detail?.image??e?.part_detail?.thumbnail,pk:e.part}),s.jsx(ce.Col,{span:{base:12,sm:8},children:s.jsx(L,{fields:$,item:i})})]}),s.jsx(L,{fields:Z,item:i}),s.jsx(L,{fields:Fe,item:i}),s.jsx(L,{fields:Pe,item:i})]})},[e,_,A.isFetching,v.isFetching,u]),C=o.useMemo(()=>e?.part_detail?.component&&!e?.sales_order&&!e?.belongs_to,[e]),R=o.useMemo(()=>e?.part_detail?.salable,[e]),D=ye({queryKey:["tracked-bom-item",e.pk,e.part],queryFn:()=>!e.pk||!e.part||!e.part_detail?.assembly?!1:r.get(S(p.bom_list),{params:{part:e.part,sub_part_trackable:!0,limit:1}}).then(i=>i.status==200?i.data.count>0:null)}),E=o.useMemo(()=>e?.installed_items?!0:D.data?D.data:e?.part_detail?.assembly,[D,e]),Q=o.useMemo(()=>[{name:"details",label:t._({id:"hBG+yp"}),icon:s.jsx(ge,{}),content:z},{name:"tracking",label:t._({id:"IdrYoA"}),icon:s.jsx(Ve,{}),content:e.pk?s.jsx(Jt,{itemId:e.pk}):s.jsx(K,{})},{name:"allocations",label:t._({id:"KwhnxF"}),icon:s.jsx(Vt,{}),hidden:!e.in_stock||!R&&!C,content:s.jsxs(T,{multiple:!0,defaultValue:["buildAllocations","salesAllocations"],children:[C&&s.jsxs(T.Item,{value:"buildAllocations",children:[s.jsx(T.Control,{children:s.jsx(ue,{size:"lg",children:t._({id:"KCpl4N"})})}),s.jsx(T.Panel,{children:s.jsx(Ft,{stockId:e.pk,modelField:"build",modelTarget:l.build,showBuildInfo:!0})})]},"buildAllocations"),R&&s.jsxs(T.Item,{value:"salesAllocations",children:[s.jsx(T.Control,{children:s.jsx(ue,{size:"lg",children:t._({id:"DaWMWw"})})}),s.jsx(T.Panel,{children:s.jsx(Pt,{stockId:e.pk,modelField:"order",modelTarget:l.salesorder,showOrderInfo:!0})})]},"salesAllocations")]})},{name:"test-results",label:t._({id:"isbwWo"}),icon:s.jsx(Gt,{}),hidden:!e?.part_detail?.testable,content:e?.pk?s.jsx(Xt,{itemId:e.pk,partId:e.part}):s.jsx(K,{})},{name:"installed_items",label:t._({id:"xnskHi"}),icon:s.jsx(Qt,{}),hidden:!E,content:s.jsx(Ht,{stockItem:e})},{name:"child_items",label:t._({id:"K4v96J"}),icon:s.jsx(Ge,{}),hidden:(e?.child_items??0)==0,content:e?.pk?s.jsx(Ut,{tableName:"child-stock",params:{ancestor:e.pk}}):s.jsx(K,{})},ut({model_type:l.stockitem,model_id:e.pk}),mt({model_type:l.stockitem,model_id:e.pk})],[R,C,E,e,_,A,c,m]),W=o.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.location_path??[]).map(i=>({name:i.name,url:w(l.stocklocation,i.pk)}))],[e]),H=he({create:!1,stockItem:e,partId:e.part,modalId:"edit-stock-item"}),B=Se({url:p.stock_item_list,pk:e.pk,title:t._({id:"gQgYNs"}),modalId:"edit-stock-item",fields:H,onFormSuccess:f}),X=he({create:!0,modalId:"duplicate-stock-item"}),d=o.useMemo(()=>{const i={...e,serial_numbers:e.serial};return delete i.serial,i},[e]),a=O({url:p.stock_item_list,title:t._({id:"bJLEQT"}),modalId:"duplicate-stock-item",fields:X,initialData:{...d},follow:!0,successMessage:null,modelType:l.stockitem,onFormSuccess:i=>{if(Array.isArray(i)&&i.length>0)if(i.length==1)h(w(l.stockitem,i[0]?.pk));else{const j=i.length;Ne.show({title:t._({id:"7Vas0a"}),message:t._({id:"DHdcSX",values:{n:j}}),color:"green"})}}}),k=o.useMemo(()=>{},[e]),y=Ae({url:p.stock_item_list,pk:e.pk,title:t._({id:"BJoa27"}),preFormContent:k,onFormSuccess:()=>{h(w(l.part,e.part))}}),U=o.useMemo(()=>({items:[e],model:l.stockitem,refresh:()=>{const i=e?.location;P().then(j=>{j.status=="error"&&h(i?w(l.stocklocation,i):Be(l.stockitem))})},filters:{in_stock:!0}}),[e]),J=Dt({formProps:U,delete:!1,assign:!!e.in_stock,return:!!e.consumed_by||!!e.customer,merge:!1}),Ce=Rt({partId:e.part,trackable:e.part_detail?.trackable,modalId:"stock-item-serialize"}),ae=O({url:p.stock_serialize,pk:e.pk,title:t._({id:"ETKLHa"}),modalId:"stock-item-serialize",fields:Ce,initialData:{quantity:e.quantity,destination:e.location??e.part_detail?.default_location},onFormSuccess:i=>{i.length>=e.quantity?h(w(l.stockitem,i[0].pk)):f()},successMessage:t._({id:"Hkw/xj"})}),ie=wt({parts:e.part_detail?[e.part_detail]:[]}),le=Ye({title:t._({id:"kiz1mM"}),modelType:l.stocklocation,callback:async(i,j)=>{const $=j.stocklocation.pk;return r.post(S(p.stock_transfer),{location:$,items:[{pk:e.pk,quantity:e.quantity}]}).then(()=>(f(),{success:t._({id:"vdb1YW"})})).catch(Z=>(console.log("Error scanning stock item:",Z),{error:t._({id:"TL3ZFM"})}))}}),Re=o.useMemo(()=>{m.hasChangeRole(b.stock)&&!e.sales_order&&!e.belongs_to&&!e.customer&&e.consumed_by,e.is_building;const i=e.serial,j=i!=null&&i!=null&&i!=""&&e.quantity==1;return[s.jsx(Je,{model:l.stockitem,id:e.pk}),s.jsx(bt,{stockId:e.pk}),s.jsx(tt,{model:l.stockitem,pk:e.pk,hash:e?.barcode_hash,perm:m.hasChangeRole(b.stock),actions:[{name:t._({id:"MeG2ih"}),icon:s.jsx(me,{icon:"location"}),tooltip:t._({id:"8Otzst"}),onClick:le.open}]}),s.jsx(st,{modelType:l.stockitem,items:[e.pk],enableReports:!0,enableLabels:!0}),s.jsx(at,{tooltip:t._({id:"ClJC3x"}),icon:s.jsx(He,{}),actions:[...J.menuActions,{name:t._({id:"Wlr+mY"}),tooltip:t._({id:"Vmnyam"}),hidden:j||e?.quantity<1||e?.part_detail?.trackable!=!0,icon:s.jsx(me,{icon:"serial",iconProps:{color:"blue"}}),onClick:()=>{ae.open()}},{name:t._({id:"UYUgdb"}),tooltip:t._({id:"cUzrZK"}),hidden:!m.hasAddRole(b.purchase_order)||!e.part_detail?.active||!e.part_detail?.purchaseable,icon:s.jsx(Qe,{color:"blue"}),onClick:()=>{ie.openWizard()}}]}),s.jsx(it,{tooltip:t._({id:"oPF3fX"}),actions:[lt({hidden:!m.hasAddRole(b.stock),onClick:()=>a.open()}),ot({hidden:!m.hasChangeRole(b.stock),onClick:()=>B.open()}),nt({hidden:!m.hasDeleteRole(b.stock),onClick:()=>y.open()})]})]},[c,e,m,J.menuActions]),De=o.useMemo(()=>{let i=(e?.quantity??0)-(e?.allocated??0);return i=Math.max(0,i),v.isLoading?[]:[s.jsx(I,{color:"yellow",label:t._({id:"BE5Q6v"}),visible:e.is_building}),s.jsx(I,{color:"blue",label:`${t._({id:"AXeJt4"})}: ${e.serial}`,visible:!!e.serial},"serial"),s.jsx(I,{color:"blue",label:`${t._({id:"VbWX2u"})}: ${Y(e.quantity)}`,visible:!e.serial},"quantity"),s.jsx(I,{color:"yellow",label:`${t._({id:"csDS2L"})}: ${Y(i)}`,visible:e.in_stock&&!e.serial&&i!=e.quantity},"available"),s.jsx(I,{color:"blue",label:`${t._({id:"Vea6Aj"})}: ${e.batch}`,visible:!!e.batch},"batch"),s.jsx(Ie,{status:e.status_custom_key||e.status,type:l.stockitem,options:{size:"lg"}},"status"),s.jsx(I,{color:"yellow",label:t._({id:"1ba70W"}),visible:u&&e.stale&&!e.expired},"stale"),s.jsx(I,{color:"orange",label:t._({id:"M1RnFv"}),visible:u&&e.expired},"expired"),s.jsx(I,{color:"red",label:t._({id:"jqzUyM"}),visible:e.in_stock==!1},"unavailable")]},[e,v,u]);return s.jsxs(s.Fragment,{children:[q.modal,le.dialog,s.jsx(dt,{query:v,requiredPermission:l.stockitem,children:s.jsxs(Ue,{children:[m.hasViewRole(b.stock_location)&&s.jsx(pt,{title:t._({id:"1eBWAw"}),modelType:l.stocklocation,endpoint:p.stock_location_tree,opened:x,onClose:()=>n(!1),selectedId:e?.location}),s.jsx(_t,{title:t._({id:"igx8Og"}),subtitle:e.part_detail?.full_name,imageUrl:e.part_detail?.thumbnail,editAction:B.open,editEnabled:m.hasChangePermission(l.stockitem),badges:De,breadcrumbs:m.hasViewRole(b.stock_location)?W:void 0,lastCrumb:[{name:e.name,url:`/stock/item/${e.pk}/`}],breadcrumbAction:()=>{n(!0)},actions:Re}),s.jsx(kt,{pageKey:"stockitem",panels:Q,model:l.stockitem,id:e.pk,instance:e})]})}),B.modal,a.modal,y.modal,ae.modal,J.modals.map(i=>i.modal),ie.wizard]})}export{Hs as default};
//# sourceMappingURL=StockDetail-BlVGaqlf.js.map
