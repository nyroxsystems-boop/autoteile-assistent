{"version":3,"file":"ManufacturerPartTable-D3cTQGW8.js","sources":["../../../../../../frontend/src/tables/purchasing/ManufacturerPartTable.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { type ReactNode, useCallback, useMemo, useState } from 'react';\n\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport {\n  type RowAction,\n  RowDeleteAction,\n  RowDuplicateAction,\n  RowEditAction\n} from '@lib/components/RowActions';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { useManufacturerPartFields } from '../../forms/CompanyForms';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport {\n  CompanyColumn,\n  DescriptionColumn,\n  LinkColumn,\n  PartColumn\n} from '../ColumnRenderers';\nimport { InvenTreeTable } from '../InvenTreeTable';\n\n/*\n * Construct a table listing manufacturer parts\n */\nexport function ManufacturerPartTable({\n  manufacturerId,\n  partId\n}: Readonly<{\n  manufacturerId?: number;\n  partId?: number;\n}>): ReactNode {\n  const tableId: string = useMemo(() => {\n    let tId = 'manufacturer-part';\n\n    if (manufacturerId) {\n      tId += '-manufacturer';\n    }\n\n    if (partId) {\n      tId += '-part';\n    }\n\n    return tId;\n  }, [manufacturerId, partId]);\n\n  const table = useTable(tableId);\n\n  const user = useUserState();\n\n  // Construct table columns for this table\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      PartColumn({\n        switchable: !!partId\n      }),\n      {\n        accessor: 'part_detail.IPN',\n        title: t`IPN`,\n        sortable: false,\n        switchable: true\n      },\n      {\n        accessor: 'manufacturer',\n        sortable: true,\n        render: (record: any) => (\n          <CompanyColumn company={record?.manufacturer_detail} />\n        )\n      },\n      {\n        accessor: 'MPN',\n        title: t`MPN`,\n        sortable: true\n      },\n      DescriptionColumn({}),\n      LinkColumn({})\n    ];\n  }, [partId]);\n\n  const manufacturerPartFields = useManufacturerPartFields();\n\n  const [selectedPart, setSelectedPart] = useState<any>(undefined);\n\n  const createManufacturerPart = useCreateApiFormModal({\n    url: ApiEndpoints.manufacturer_part_list,\n    title: t`Add Manufacturer Part`,\n    fields: manufacturerPartFields,\n    table: table,\n    initialData: {\n      manufacturer: manufacturerId,\n      part: partId\n    }\n  });\n\n  const editManufacturerPart = useEditApiFormModal({\n    url: ApiEndpoints.manufacturer_part_list,\n    pk: selectedPart?.pk,\n    title: t`Edit Manufacturer Part`,\n    fields: useMemo(() => manufacturerPartFields, [manufacturerPartFields]),\n    table: table\n  });\n\n  const duplicateManufacturerPart = useCreateApiFormModal({\n    url: ApiEndpoints.manufacturer_part_list,\n    title: t`Add Manufacturer Part`,\n    fields: useMemo(() => manufacturerPartFields, [manufacturerPartFields]),\n    table: table,\n    initialData: {\n      ...selectedPart\n    }\n  });\n\n  const deleteManufacturerPart = useDeleteApiFormModal({\n    url: ApiEndpoints.manufacturer_part_list,\n    pk: selectedPart?.pk,\n    title: t`Delete Manufacturer Part`,\n    table: table\n  });\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'part_active',\n        label: t`Active Part`,\n        description: t`Show manufacturer parts for active internal parts.`,\n        type: 'boolean'\n      },\n      {\n        name: 'manufacturer_active',\n        label: t`Active Manufacturer`,\n        active: !manufacturerId,\n        description: t`Show manufacturer parts for active manufacturers.`,\n        type: 'boolean'\n      }\n    ];\n  }, [manufacturerId]);\n\n  const tableActions = useMemo(() => {\n    const can_add =\n      user.hasAddRole(UserRoles.purchase_order) &&\n      user.hasAddRole(UserRoles.part);\n\n    return [\n      <AddItemButton\n        key='add-manufacturer-part'\n        tooltip={t`Add Manufacturer Part`}\n        onClick={() => createManufacturerPart.open()}\n        hidden={!can_add}\n      />\n    ];\n  }, [user]);\n\n  const rowActions = useCallback(\n    (record: any): RowAction[] => {\n      return [\n        RowEditAction({\n          hidden: !user.hasChangeRole(UserRoles.purchase_order),\n          onClick: () => {\n            setSelectedPart(record);\n            editManufacturerPart.open();\n          }\n        }),\n        RowDuplicateAction({\n          hidden: !user.hasAddRole(UserRoles.purchase_order),\n          onClick: () => {\n            setSelectedPart(record);\n            duplicateManufacturerPart.open();\n          }\n        }),\n        RowDeleteAction({\n          hidden: !user.hasDeleteRole(UserRoles.purchase_order),\n          onClick: () => {\n            setSelectedPart(record);\n            deleteManufacturerPart.open();\n          }\n        })\n      ];\n    },\n    [user]\n  );\n\n  return (\n    <>\n      {createManufacturerPart.modal}\n      {duplicateManufacturerPart.modal}\n      {editManufacturerPart.modal}\n      {deleteManufacturerPart.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.manufacturer_part_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          params: {\n            part: partId,\n            manufacturer: manufacturerId,\n            part_detail: true,\n            manufacturer_detail: true\n          },\n          enableDownload: true,\n          rowActions: rowActions,\n          tableActions: tableActions,\n          tableFilters: tableFilters,\n          modelType: ModelType.manufacturerpart\n        }}\n      />\n    </>\n  );\n}\n"],"names":["ManufacturerPartTable","manufacturerId","partId","tableId","useMemo","tId","table","useTable","user","useUserState","tableColumns","PartColumn","switchable","accessor","title","_i18n","_","id","sortable","render","record","CompanyColumn","manufacturer_detail","DescriptionColumn","LinkColumn","manufacturerPartFields","useManufacturerPartFields","selectedPart","setSelectedPart","useState","undefined","createManufacturerPart","useCreateApiFormModal","url","ApiEndpoints","manufacturer_part_list","fields","initialData","manufacturer","part","editManufacturerPart","useEditApiFormModal","pk","duplicateManufacturerPart","deleteManufacturerPart","useDeleteApiFormModal","tableFilters","name","label","description","type","active","tableActions","can_add","hasAddRole","UserRoles","purchase_order","jsx","AddItemButton","open","rowActions","useCallback","RowEditAction","hidden","hasChangeRole","onClick","RowDuplicateAction","RowDeleteAction","hasDeleteRole","jsxs","Fragment","modal","InvenTreeTable","apiUrl","params","part_detail","enableDownload","modelType","ModelType","manufacturerpart"],"mappings":"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"}