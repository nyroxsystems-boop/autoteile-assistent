import{az as se,ag as re,r as i,bb as a,ab as t,ao as d,j as s,d as H,b1 as _,an as R,b4 as de,by as Q,as as y,S as pe}from"./index-Db7AGPIq.js";import{A as ue}from"./AdminButton-BR7cWvGK.js";import{P as Y}from"./PrimaryActionButton-CsYjCYWq.js";import{u as me,R as _e,d as he,a as be,c as fe,I as ye,B as xe,P as ke,O as ge,E as Ce,b as je,H as Pe,C as Se}from"./InvenTreeTable-DmN557zY.js";import{I as Ae,D as w,a as De}from"./InstanceDetail-CF-uHhEW.js";import{D as Ie,A as Re,N as ve}from"./NotesPanel-BpiQDImp.js";import{a as Ee,aj as Fe,E as Te,r as Le,S as z,Y as Me,G as Oe}from"./ThemeContext-CxdCkKtz.js";import{P as Ne}from"./PageDetail-Bm50kpyR.js";import{P as qe}from"./PanelGroup-Bif3iIGQ.js";import{P as we}from"./ParametersPanel-CrcKbDM0.js";import{a as x,R as We,f as X,T as Ke,b as ae,c as Ue,d as Ve,p as Be}from"./Filter-BgnAqEQC.js";import{b as ie}from"./formatters-B4ehJgEk.js";import{b as Ge,c as Z,a as J}from"./OrderPartsWizard-BcMgRjfh.js";import{u as He}from"./UseInstance-BPJQEWDW.js";import{d as Qe,u as oe,I as Ye}from"./ImporterForms-D2fp0CPO.js";import{I as $,E as ze}from"./ExtraLineItemTable-DMf1CJ9x.js";import{A as ee}from"./ActionButton-Cv5j5I5R.js";import{P as Xe}from"./index-DRtKJP-e.js";import{P as Ze,D as Je,R as $e,b as et,L as te,n as tt,T as st,f as rt,N as at}from"./ColumnRenderers-BUH0stTX.js";import{S as it}from"./StockItemTable-CHHhSxX_.js";import"./DesktopAppView-BuH2j218.js";import"./IconChevronDown-CzbIU38Y.js";import"./QRCode-BaIEIQ2d.js";import"./browser-DSycY7kT.js";import"./IconDotsVertical-D8D3XsjG.js";import"./IconTags-DnGx22aA.js";import"./YesNoButton-BaVgP5u9.js";import"./ModelType-DSs66IM7.js";import"./GenericErrorPage-D-1fKCA7.js";import"./NotFound-CsJ_VLc_.js";import"./PermissionDenied-BDbEipg4.js";import"./use-hover-Cq0v4QX_.js";import"./index-Chjiymov.js";import"./AttachmentLink-D_UWVUZG.js";import"./PageTitle-B4iaHXKM.js";import"./PluginUIFeature-DCu8wTdG.js";import"./RemoteComponent-uZoHDwds.js";import"./ParameterTable-CGnscd1r.js";import"./CommonForms-DKQecQmS.js";import"./IconUsers-Dr_Sln9A.js";import"./CompanyForms-CIJgkbDe.js";import"./IconAt-rYwKGkPn.js";import"./IconAddressBook-CdNRMeyy.js";import"./IconCircleDashedCheck-DnGBn8Eq.js";import"./UseStockAdjustActions-BrgagWbF.js";function ot({order:p,orderDetailRefresh:b,orderId:n,currency:e,supplierId:h,editable:l,params:k}){const m=me("purchase-order-line-item");se();const W=Ee(),u=re(),[c,P]=i.useState(!1),[S,v]=i.useState(void 0),E=i.useMemo(()=>{const r=Qe({modelType:a.purchaseorderlineitem});return r.field_overrides.value={order:n},r.field_defaults.value={purchase_price_currency:p?.order_currency||p?.supplier_detail?.currency||void 0},r.field_filters.value={part:{supplier:h,active:!0}},r},[p,n,h]),F=x({url:d.import_session_list,title:t._({id:"yWWRAr"}),fields:E,onFormSuccess:r=>{v(r.pk),P(!0)}}),[T,A]=i.useState(null),g=Ge({items:T?[T]:m.selectedRecords,orderPk:n,destinationPk:p.destination,formProps:{onClose:()=>{m.clearSelectedRecords(),m.refreshTable(),setTimeout(()=>A(null),500)}}}),L=i.useMemo(()=>[Ze({part:"part_detail",ordering:"part_name"}),{accessor:"part_detail.IPN",sortable:!0,ordering:"IPN"},Je({accessor:"part_detail.description"}),$e({}),et({}),{accessor:"build_order",title:t._({id:"YxwWvi"}),sortable:!0,defaultVisible:!1,render:r=>r.build_order_detail?s.jsx(We,{instance:r.build_order_detail,model:a.build}):"-"},{accessor:"quantity",title:t._({id:"VbWX2u"}),sortable:!0,switchable:!1,render:r=>{const f=r?.supplier_part_detail??{},I=r?.part_detail??f?.part_detail??{},V=[];if(f?.pack_quantity_native!=null&&f.pack_quantity_native!=1){const ce=r.quantity*f.pack_quantity_native;V.push(s.jsxs(H,{size:"sm",children:[t._({id:"J9LTXQ"}),": ",f.pack_quantity]},"pack-quantity")),V.push(s.jsxs(H,{size:"sm",children:[t._({id:"GbI1d2"}),": ",X(ce)," ",I?.units]},"total-quantity"))}return s.jsx(Ke,{value:X(r.quantity),extra:V,title:t._({id:"VbWX2u"})})}},{accessor:"received",title:t._({id:"fZ5Vnu"}),sortable:!1,render:r=>s.jsx(Xe,{progressLabel:!0,value:r.received,maximum:r.quantity})},{accessor:"supplier_part_detail.packaging",sortable:!1,title:t._({id:"pD/Ew0"}),defaultVisible:!1},{accessor:"supplier_part_detail.pack_quantity",sortable:!1,title:t._({id:"J9LTXQ"})},{accessor:"sku",title:t._({id:"PeuqsI"}),switchable:!1,sortable:!0,ordering:"SKU"},te({accessor:"supplier_part_detail.link",title:t._({id:"h3/Rpt"}),sortable:!1,defaultVisible:!1}),{accessor:"mpn",ordering:"MPN",title:t._({id:"u7qly3"}),sortable:!0,defaultVisible:!1},tt({accessor:"purchase_price",title:t._({id:"vWelsN"})}),{accessor:"total_price",title:t._({id:"KyZVKD"}),render:r=>ie(r.purchase_price,{currency:r.purchase_price_currency,multiplier:r.quantity})},st({}),rt({accessor:"destination_detail",sortable:!1,title:t._({id:"Enslfm"})}),at({}),te({})],[n,u]),M=i.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"8Dmqxr"})}],[]),K=Z({create:!0,orderId:n,supplierId:h,currency:e}),[U,O]=i.useState({}),o=x({url:d.purchase_order_line_list,title:t._({id:"pwb7Yo"}),fields:K,initialData:{...U,purchase_price_currency:e},onFormSuccess:b,table:m}),[C,j]=i.useState(0),D=Z({create:!1,orderId:n,supplierId:h,currency:e}),N=ae({url:d.purchase_order_line_list,pk:C,title:t._({id:"vgosWS"}),fields:D,onFormSuccess:b,table:m}),B=Ue({url:d.purchase_order_line_list,pk:C,title:t._({id:"tpKh8C"}),onFormSuccess:b,table:m}),G=oe({modelType:a.purchaseorder}),q=i.useMemo(()=>p.status==G.PLACED,[p,G]),ne=i.useCallback(r=>{const f=(r?.received??0)>=(r?.quantity??0),I=l&&u.hasChangeRole(_.purchase_order);return[{hidden:f||!q,title:t._({id:"ul9IpB"}),icon:s.jsx($,{}),color:"green",onClick:()=>{A(r),g.open()}},_e({hidden:!I,onClick:()=>{j(r.pk),N.open()}}),he({hidden:!I||!u.hasAddRole(_.purchase_order),onClick:()=>{O({...r}),o.open()}}),be({hidden:!I||!u.hasDeleteRole(_.purchase_order),onClick:()=>{j(r.pk),B.open()}}),fe({hidden:!r.build_order,title:t._({id:"bjYQWK"}),modelType:a.build,modelId:r.build_order,navigate:W})]},[n,u,l,q]),le=i.useMemo(()=>[s.jsx(ee,{hidden:!l||!u.hasAddRole(_.purchase_order),tooltip:t._({id:"yWWRAr"}),icon:s.jsx(Fe,{}),onClick:()=>F.open()},"import-line-items"),s.jsx(Ve,{tooltip:t._({id:"pwb7Yo"}),onClick:()=>{O({order:n}),o.open()},hidden:!l||!u?.hasAddRole(_.purchase_order)},"add-line-item"),s.jsx(ee,{text:t._({id:"gyK1dv"}),icon:s.jsx($,{}),onClick:()=>g.open(),disabled:m.selectedRecords.length===0,hidden:!q||!u.hasChangeRole(_.purchase_order)},"receive-items")],[n,u,m,l,q]);return s.jsxs(s.Fragment,{children:[F.modal,g.modal,o.modal,N.modal,B.modal,s.jsx(ye,{url:R(d.purchase_order_line_list),tableState:m,columns:L,props:{enableSelection:!0,enableDownload:!0,params:{...k,order:n,part_detail:!0},rowActions:ne,tableActions:le,tableFilters:M,modelType:a.supplierpart,modelField:"part"}}),s.jsx(Ye,{sessionId:S??-1,opened:S!=null&&c,onClose:()=>{v(void 0),P(!1),m.refreshTable()}})]})}function Jt(){const{id:p}=Te(),b=re(),n=se(),{instance:e,instanceQuery:h,refreshInstance:l}=He({endpoint:d.purchase_order_list,pk:p,params:{supplier_detail:!0},refetchOnMount:!0}),k=i.useMemo(()=>e.order_currency||e.supplier_detail?.currency||n.getSetting("INVENTREE_DEFAULT_CURRENCY"),[e,n]),m=J({}),W=J({duplicateOrderId:e.pk}),u=ae({url:d.purchase_order_list,pk:p,title:t._({id:"lAF9Uk"}),fields:m,onFormSuccess:()=>{l()}}),c=oe({modelType:a.purchaseorder}),P=i.useMemo(()=>e.status==c.PENDING||e.status==c.PLACED||e.status==c.ON_HOLD,[e,c]),S=i.useMemo(()=>P?!0:n.isSet("PURCHASEORDER_EDIT_COMPLETED_ORDERS"),[P,n]),v=i.useMemo(()=>{const o={...e};return delete o.reference,o},[e]),E=x({url:d.purchase_order_list,title:t._({id:"XRoR1U"}),fields:W,initialData:v,follow:!0,modelType:a.purchaseorder}),F=i.useMemo(()=>{if(h.isFetching)return s.jsx(de,{});const o=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"supplier_reference",label:t._({id:"K7PVg3"}),icon:"reference",hidden:!e.supplier_reference,copy:!0},{type:"link",name:"supplier",icon:"suppliers",label:t._({id:"PYTEl0"}),model:a.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:a.purchaseorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:a.purchaseorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],C=[{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"link",model:a.stocklocation,link:!0,name:"destination",label:t._({id:"Enslfm"}),hidden:!e.destination},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>k},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>ie(e?.total_price,{currency:e?.order_currency||e?.supplier_detail?.currency})}],j=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!e.contact_detail?.email},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!e.contact_detail?.phone},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],D=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),copy:!0,icon:"calendar"},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!e.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date}];return s.jsxs(Ae,{children:[s.jsxs(Q,{grow:!0,children:[s.jsx(Ie,{appRole:_.purchase_order,apiPath:d.company_list,src:e.supplier_detail?.image,pk:e.supplier}),s.jsx(Q.Col,{span:{base:12,sm:8},children:s.jsx(w,{fields:o,item:e})})]}),s.jsx(w,{fields:C,item:e}),s.jsx(w,{fields:j,item:e}),s.jsx(w,{fields:D,item:e})]})},[e,k,h]),T=i.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:s.jsx(Le,{}),content:F},{name:"line-items",label:t._({id:"SgduFH"}),icon:s.jsx(Me,{}),content:s.jsxs(y,{multiple:!0,defaultValue:["line-items","extra-items"],children:[s.jsxs(y.Item,{value:"line-items",children:[s.jsx(y.Control,{children:s.jsx(z,{size:"lg",children:t._({id:"SgduFH"})})}),s.jsx(y.Panel,{children:s.jsx(ot,{order:e,orderDetailRefresh:l,currency:k,orderId:Number(p),editable:S,supplierId:Number(e.supplier)})})]},"lineitems"),s.jsxs(y.Item,{value:"extra-items",children:[s.jsx(y.Control,{children:s.jsx(z,{size:"lg",children:t._({id:"l11DG/"})})}),s.jsx(y.Panel,{children:s.jsx(ze,{endpoint:d.purchase_order_extra_line_list,orderId:e.pk,orderDetailRefresh:l,currency:k,editable:S,role:_.purchase_order})})]},"extraitems")]})},{name:"received-stock",label:t._({id:"b447qM"}),icon:s.jsx(Oe,{}),content:s.jsx(it,{tableName:"received-stock",params:{purchase_order:p}})},we({model_type:a.purchaseorder,model_id:e.pk}),Re({model_type:a.purchaseorder,model_id:e.pk}),ve({model_type:a.purchaseorder,model_id:e.pk})],[e,p,b]),A=x({url:R(d.purchase_order_issue,e.pk),title:t._({id:"keApR9"}),onFormSuccess:l,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),g=x({url:R(d.purchase_order_cancel,e.pk),title:t._({id:"98xQHK"}),onFormSuccess:l,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),L=x({url:R(d.purchase_order_hold,e.pk),title:t._({id:"vJaCK0"}),onFormSuccess:l,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),M=x({url:R(d.purchase_order_complete,e.pk),title:t._({id:"CWbcdO"}),successMessage:t._({id:"W7TghJ"}),timeout:1e4,fields:{accept_incomplete:{}},onFormSuccess:l,preFormWarning:t._({id:"DYITap"})}),K=i.useMemo(()=>{const o=b.hasChangeRole(_.purchase_order),C=o&&(e.status==c.PENDING||e.status==c.ON_HOLD),j=o&&(e.status==c.PENDING||e.status==c.PLACED),D=o&&e.status==c.PLACED,N=o&&e.status!=c.CANCELLED&&e.status!=c.COMPLETE;return[s.jsx(Y,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!C,color:"blue",onClick:A.open}),s.jsx(Y,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!D,color:"green",onClick:M.open}),s.jsx(ue,{model:a.purchaseorder,id:e.pk}),s.jsx(xe,{model:a.purchaseorder,pk:e.pk,hash:e?.barcode_hash}),s.jsx(ke,{modelType:a.purchaseorder,items:[e.pk],enableLabels:!0,enableReports:!0}),s.jsx(ge,{tooltip:t._({id:"/IKytX"}),actions:[Ce({hidden:!o,tooltip:t._({id:"mVeaUg"}),onClick:()=>{u.open()}}),je({hidden:!b.hasAddRole(_.purchase_order),onClick:()=>E.open(),tooltip:t._({id:"oi/3Pq"})}),Pe({tooltip:t._({id:"20mLBC"}),hidden:!j,onClick:L.open}),Se({tooltip:t._({id:"tVJk4q"}),hidden:!N,onClick:g.open})]})]},[p,e,b,c]),U=i.useMemo(()=>h.isLoading?[]:[s.jsx(Be,{status:e.status_custom_key,type:a.purchaseorder,options:{size:"lg"}})],[e,h]),O=i.useMemo(()=>{let o=e.supplier_detail?.name||"";return e.supplier_reference&&(o+=` (${e.supplier_reference})`),o},[e]);return s.jsxs(s.Fragment,{children:[A.modal,L.modal,g.modal,M.modal,u.modal,E.modal,s.jsx(De,{query:h,requiredRole:_.purchase_order,children:s.jsxs(pe,{gap:"xs",children:[s.jsx(Ne,{title:`${t._({id:"KxySMG"})}: ${e.reference}`,subtitle:O,imageUrl:e.supplier_detail?.image,breadcrumbs:[{name:t._({id:"UOTpFa"}),url:"/purchasing/"}],lastCrumb:[{name:e.reference,url:`/purchasing/purchase-order/${e.pk}`}],actions:K,badges:U,editAction:u.open,editEnabled:b.hasChangePermission(a.purchaseorder)}),s.jsx(qe,{pageKey:"purchaseorder",panels:T,model:a.purchaseorder,instance:e,reloadInstance:l,id:e.pk})]})})]})}export{Jt as default};
//# sourceMappingURL=PurchaseOrderDetail-iGiFydxK.js.map
