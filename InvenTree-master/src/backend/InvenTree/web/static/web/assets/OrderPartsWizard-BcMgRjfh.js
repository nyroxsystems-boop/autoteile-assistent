import{K as le,az as G,r as s,j as e,bb as V,ab as a,an as I,ao as P,bN as oe,bi as z,U as ce,ax as de,ay as ue,ak as q,bc as Q,N as k,b as pe,S as U,al as _e,aj as $,b9 as fe,aB as xe,aa as B,ac as M,bO as X,a7 as he,aq as ee,a8 as te,av as ge,$ as je,bd as me,bF as W,d as y}from"./index-Db7AGPIq.js";import{A as C}from"./ActionButton-Cv5j5I5R.js";import{ab as be,a as N,k as ke,h as ye,N as T,ac as D,d as Y,f as O}from"./Filter-BgnAqEQC.js";import{P as ve,W as Ce}from"./index-DRtKJP-e.js";import{u as we}from"./CompanyForms-CIJgkbDe.js";import{j as ie,i as Se,h as Ee,I as Fe,R as ae}from"./PluginUIFeature-DCu8wTdG.js";import{am as qe,ab as H,Y as Pe,al as Ie,S as ne,t as v,I as Ae,an as ze,U as De,M as Oe,B as Be,ao as Z,ap as Me,F as Te,r as Le}from"./ThemeContext-CxdCkKtz.js";import{I as Ne}from"./IconUsers-Dr_Sln9A.js";import{I as Ve}from"./IconAddressBook-CdNRMeyy.js";import{u as Re}from"./UseInstance-BPJQEWDW.js";import{b as Qe}from"./IconChevronDown-CzbIU38Y.js";import{g as We}from"./ColumnRenderers-BUH0stTX.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M5 12l14 0",key:"svg-0"}],["path",{d:"M5 12l6 6",key:"svg-1"}],["path",{d:"M5 12l6 -6",key:"svg-2"}]],Ge=le("outline","arrow-left","ArrowLeft",He);function pt({supplierId:t,orderId:i,currency:u,create:c}){const l=G(),[r,f]=s.useState(""),[j,m]=s.useState(u??""),[_,x]=s.useState(!1),[o,d]=s.useState("1"),[h,n]=s.useState({}),[b,g]=s.useState([]),[S,A]=s.useState(void 0);return s.useEffect(()=>{if(!c)return;const E=oe(o,null);if(E==null||E<=0){A(void 0);return}if(!h||!b||b.length===0){A(void 0);return}const F=b.filter(w=>E>=w.quantity).sort((w,L)=>L.quantity-w.quantity);F.length?A(F[0].price):A(void 0)},[c,h,o,b]),s.useEffect(()=>{_&&f("")},[_]),s.useEffect(()=>{x(r==="")},[r]),s.useMemo(()=>{const E={order:{filters:{supplier_detail:!0},disabled:!0},part:{filters:{part_detail:!0,supplier_detail:!0,active:!0,part_active:!0,price_breaks:!0},onValueChange:(F,w)=>{g(w?.price_breaks??[]),n(w?.part_detail??{})},adjustFilters:F=>({...F.filters,supplier:t})},reference:{},quantity:{onValueChange:F=>{d(F)}},purchase_price:{icon:e.jsx(Oe,{}),value:r,placeholder:S,placeholderAutofill:!0,onValueChange:f},purchase_price_currency:{icon:e.jsx(ie,{}),value:j,onValueChange:m},auto_pricing:{value:_,onValueChange:x},project_code:{description:a._({id:"XruckR"})},target_date:{icon:e.jsx(H,{})},destination:{icon:e.jsx(De,{})},build_order:{disabled:!h?.assembly,filters:{external:!0,outstanding:!0,part:h?.pk}},notes:{icon:e.jsx(ze,{})},link:{icon:e.jsx(Ae,{})}};return l.isSet("BUILDORDER_EXTERNAL_BUILDS",!1)||delete E.build_order,c&&(E.merge_items={}),E},[c,i,h,l,t,_,r,S])}function Ue({supplierId:t,duplicateOrderId:i}){const u=G();return s.useMemo(()=>{const c={reference:{icon:e.jsx(Ie,{})},description:{},supplier:{value:t,disabled:!!i||!!t,filters:{is_supplier:!0,active:!0}},supplier_reference:{},project_code:{icon:e.jsx(Pe,{})},order_currency:{icon:e.jsx(ie,{})},start_date:{icon:e.jsx(H,{})},target_date:{icon:e.jsx(H,{})},destination:{filters:{structural:!1}},link:{},contact:{icon:e.jsx(qe,{}),adjustFilters:l=>({...l.filters,company:l.data.supplier})},address:{icon:e.jsx(Ve,{}),adjustFilters:l=>({...l.filters,company:l.data.supplier})},responsible:{filters:{is_active:!0},icon:e.jsx(Ne,{})}};return i&&(c.duplicate={children:{order_id:{hidden:!0,value:i},copy_lines:{},copy_extra_lines:{}}}),u.isSet("PROJECT_CODES_ENABLED",!0)||delete c.project_code,c},[i,t,u])}function Ke({props:t,record:i,statuses:u}){const[c,{open:l,close:r}]=z(!1,{onClose:()=>t.changeFn(t.idx,"barcode",void 0)}),[f,j]=z(!1,{onClose:()=>t.changeFn(t.idx,"location",void 0)}),m=s.useMemo(()=>i.part_detail?.trackable??!1,[i]),_=G();s.useEffect(()=>{i.destination&&(t.changeFn(t.idx,"location",i.destination),j.open())},[i.destination]);const x=Se({isEnabled:()=>g,onGenerate:p=>{p&&t.changeFn(t.idx,"batch_code",p)}}),o=Ee({isEnabled:()=>g&&m,onGenerate:p=>{p&&t.changeFn(t.idx,"serial_numbers",p)}}),[d,h]=z(!1,{onClose:()=>{t.changeFn(t.idx,"packaging",void 0)}}),[n,b]=z(!1,{onClose:()=>{t.changeFn(t.idx,"note",void 0)}}),[g,S]=z(!1,{onClose:()=>{t.changeFn(t.idx,"batch_code",void 0),t.changeFn(t.idx,"serial_numbers",void 0)},onOpen:()=>{x.update({part:i?.supplier_part_detail?.part,order:i?.order}),m?o.update({part:i?.supplier_part_detail?.part,quantity:t.item.quantity}):t.changeFn(t.idx,"serial_numbers",void 0)}}),[A,K]=z(!1,{onOpen:()=>{const p=i.part_detail?.default_expiry;p!==void 0&&p>0&&t.changeFn(t.idx,"expiry_date",ke().add(p,"day").format("YYYY-MM-DD"))},onClose:()=>{t.changeFn(t.idx,"expiry_date",void 0)}}),[E,F]=z(!1,{onClose:()=>t.changeFn(t.idx,"status",void 0)}),[w,L]=s.useState(""),[R,J]=s.useState(void 0);s.useEffect(()=>{t.changeFn(t.idx,"barcode",R)},[R]);const se=s.useMemo(()=>m?a._({id:"W778m0"}):a._({id:"K5pQC8"}),[m]);s.useEffect(()=>{if(!c)return;const p=setTimeout(()=>{J(w.length?w:null),r(),L("")},500);return()=>clearTimeout(p)},[w]);const re=s.useMemo(()=>{const p=a._({id:"RL9/J8"});return location===null?p:location===i.destination?a._({id:"LNKjyK"}):!i.destination&&!i.destination_detail&&i.part_detail&&location===i.part_detail?.category_default_location?a._({id:"q3WAIO"}):!i.destination&&i.destination_detail&&location===i.destination_detail.pk&&i.received>0?a._({id:"K1Mf+T"}):i.part_detail?.default_location&&location===i.part_detail.default_location?a._({id:"ALFlH9"}):p},[location]);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{opened:c,onClose:r,title:e.jsx(ne,{children:a._({id:"fNvDwV"})}),children:e.jsx(de,{children:e.jsx(ue,{label:"Barcode data","data-autofocus":!0,value:w,onChange:p=>L(p.target.value)})})}),e.jsxs(q.Tr,{children:[e.jsx(q.Td,{children:e.jsxs(Q,{gap:"sm",align:"center",children:[e.jsx(ye,{size:40,src:i.part_detail.thumbnail,align:"center"}),e.jsx("div",{children:i.part_detail.name})]})}),e.jsx(q.Td,{children:i.supplier_part_detail.SKU}),e.jsx(q.Td,{children:e.jsx(ve,{value:i.received,maximum:i.quantity,progressLabel:!0})}),e.jsx(q.Td,{style:{whiteSpace:"nowrap"},children:e.jsx(T,{fieldName:"quantity",fieldDefinition:{field_type:"number",value:t.item.quantity,onValueChange:p=>{t.changeFn(t.idx,"quantity",p),o.update({quantity:p})}},error:t.rowErrors?.quantity?.message})}),e.jsx(q.Td,{style:{width:"1%",whiteSpace:"nowrap"},children:e.jsxs(Q,{gap:"1px",children:[e.jsx(C,{size:"sm",onClick:()=>j.toggle(),icon:e.jsx(v,{icon:"location"}),tooltip:a._({id:"TJYLHZ"}),tooltipAlignment:"top",variant:f?"outline":"transparent"}),e.jsx(C,{size:"sm",onClick:()=>S.toggle(),icon:e.jsx(v,{icon:"batch_code"}),tooltip:se,tooltipAlignment:"top",variant:g?"outline":"transparent"}),_.isSet("STOCK_ENABLE_EXPIRY")&&e.jsx(C,{size:"sm",onClick:()=>K.toggle(),icon:e.jsx(Fe,{}),tooltip:a._({id:"okjJiB"}),tooltipAlignment:"top",variant:A?"outline":"transparent"}),e.jsx(C,{size:"sm",icon:e.jsx(v,{icon:"packaging"}),tooltip:a._({id:"O7MZ1G"}),tooltipAlignment:"top",onClick:()=>h.toggle(),variant:d?"outline":"transparent"}),e.jsx(C,{onClick:()=>F.toggle(),icon:e.jsx(v,{icon:"status"}),tooltip:a._({id:"Gt4cm5"}),tooltipAlignment:"top",variant:E?"outline":"transparent"}),e.jsx(C,{icon:e.jsx(v,{icon:"note"}),tooltip:a._({id:"nxv8yE"}),tooltipAlignment:"top",variant:n?"outline":"transparent",onClick:()=>b.toggle()}),R?e.jsx(C,{icon:e.jsx(v,{icon:"unlink"}),tooltip:a._({id:"ut1J8k"}),tooltipAlignment:"top",variant:"filled",color:"red",onClick:()=>J(void 0)}):e.jsx(C,{icon:e.jsx(v,{icon:"barcode"}),tooltip:a._({id:"fNvDwV"}),tooltipAlignment:"top",variant:"transparent",onClick:()=>l()})]})}),e.jsx(q.Td,{children:e.jsx(ae,{onClick:()=>t.removeFn(t.idx)})})]}),f&&e.jsx(q.Tr,{children:e.jsx(q.Td,{colSpan:10,children:e.jsxs(k,{grow:!0,preventGrowOverflow:!1,justify:"flex-apart",p:"xs",children:[e.jsx(pe,{flex:0,p:"xs",children:e.jsx(v,{icon:"downright"})}),e.jsx(T,{fieldDefinition:{field_type:"related field",model:V.stocklocation,api_url:I(P.stock_location_list),filters:{structural:!1},onValueChange:p=>{t.changeFn(t.idx,"location",p)},description:re,value:t.item.location,label:a._({id:"wJijgU"}),icon:e.jsx(v,{icon:"location"})},defaultValue:i.destination??(i.destination_detail?i.destination_detail.pk:null)}),e.jsxs(Q,{style:{marginBottom:"7px"},children:[(i.part_detail?.default_location||i.part_detail?.category_default_location)&&e.jsx(C,{icon:e.jsx(v,{icon:"default_location"}),tooltip:a._({id:"j9qXAA"}),onClick:()=>t.changeFn(t.idx,"location",i.part_detail?.default_location??i.part_detail?.category_default_location),tooltipAlignment:"top"}),i.destination&&e.jsx(C,{icon:e.jsx(v,{icon:"destination"}),tooltip:a._({id:"Co8OYS"}),onClick:()=>t.changeFn(t.idx,"location",i.destination),tooltipAlignment:"top"}),!i.destination&&i.destination_detail&&i.received>0&&e.jsx(C,{icon:e.jsx(v,{icon:"repeat_destination"}),tooltip:a._({id:"CKgjtC"}),onClick:()=>t.changeFn(t.idx,"location",i.destination_detail.pk),tooltipAlignment:"top"})]})]})})}),e.jsx(D,{visible:g,onValueChange:p=>{t.changeFn(t.idx,"batch_code",p)},fieldName:"batch_code",fieldDefinition:{field_type:"string",label:a._({id:"Vea6Aj"}),description:a._({id:"s848yO"}),value:t.item.batch_code},error:t.rowErrors?.batch_code?.message}),e.jsx(D,{visible:g&&m,onValueChange:p=>t.changeFn(t.idx,"serial_numbers",p),fieldName:"serial_numbers",fieldDefinition:{field_type:"string",label:a._({id:"VzQT2x"}),description:a._({id:"ig+UDq"}),value:t.item.serial_numbers},error:t.rowErrors?.serial_numbers?.message}),_.isSet("STOCK_ENABLE_EXPIRY")&&e.jsx(D,{visible:A,onValueChange:p=>t.changeFn(t.idx,"expiry_date",p),fieldName:"expiry_date",fieldDefinition:{field_type:"date",label:a._({id:"uaSvqt"}),description:a._({id:"ICgiSv"}),value:t.item.expiry_date},error:t.rowErrors?.expiry_date?.message}),e.jsx(D,{visible:d,onValueChange:p=>t.changeFn(t.idx,"packaging",p),fieldName:"packaging",fieldDefinition:{field_type:"string",label:a._({id:"pD/Ew0"})},defaultValue:i?.supplier_part_detail?.packaging,error:t.rowErrors?.packaging?.message}),e.jsx(D,{visible:E,defaultValue:10,fieldName:"status",onValueChange:p=>t.changeFn(t.idx,"status",p),fieldDefinition:{field_type:"choice",api_url:I(P.stock_status),choices:u,label:a._({id:"uAQUqI"})},error:t.rowErrors?.status?.message}),e.jsx(D,{visible:n,fieldName:"note",onValueChange:p=>t.changeFn(t.idx,"note",p),fieldDefinition:{field_type:"string",label:a._({id:"KiJn9B"})},error:t.rowErrors?.note?.message})]})}function _t(t){const i=s.useMemo(()=>be(V.stockitem),[]),u=Object.fromEntries(t.items.map(r=>[r.pk,r])),c=t.items.filter(r=>r.quantity!==r.received),l=s.useMemo(()=>({id:{value:t.orderPk,hidden:!0},items:{field_type:"table",value:c.map((r,f)=>({line_item:r.pk,location:r.destination??r.destination_detail?.pk??null,quantity:r.quantity-r.received,expiry_date:null,batch_code:"",serial_numbers:"",status:10,barcode:null})),modelRenderer:r=>{const f=u[r.item.line_item];return f?e.jsx(Ke,{props:r,record:f,statuses:i},f.pk):null},headers:[{title:a._({id:"vgP+9p"}),style:{minWidth:"200px"}},{title:a._({id:"y90mqQ"}),style:{minWidth:"200px"}},{title:a._({id:"fZ5Vnu"}),style:{minWidth:"200px"}},{title:a._({id:"VbWX2u"}),style:{width:"200px"}},{title:a._({id:"7L01XJ"})},{title:"",style:{width:"50px"}}]},location:{filters:{structural:!1}}}),[c,t,i]);return N({...t.formProps,url:I(P.purchase_order_receive,t.orderPk),title:a._({id:"MXlhj9"}),fields:l,initialData:{location:t.destinationPk},size:"80%",successMessage:a._({id:"zFmwOr"})})}function Je({currentStep:t,steps:i,onSelectStep:u,disableManualStepChange:c=!1}){if(!i||i.length==0)return null;const l=s.useCallback(j=>!i||i.length<=1?!1:Math.abs(j-t)==1,[t,i]),r=t>0,f=t<i.length-1;return e.jsx(xe,{p:"xs",withBorder:!0,children:e.jsxs(k,{justify:c?"center":"space-between",gap:"xs",wrap:"nowrap",children:[!c&&e.jsx(B,{label:i[t-1],position:"top",disabled:!r,children:e.jsx(M,{variant:"transparent",onClick:()=>u(t-1),disabled:!r,children:e.jsx(Ge,{})})}),e.jsx(X,{active:t,onStepClick:j=>{c||u(j)},iconSize:20,size:"xs",children:i.map((j,m)=>e.jsx(X.Step,{label:j,"aria-label":`wizard-step-${m}`,allowStepSelect:l(m)},j))}),f?!c&&e.jsx(B,{label:i[t+1],position:"top",disabled:!f,children:e.jsx(M,{variant:"transparent",onClick:()=>u(t+1),disabled:!f||c,children:e.jsx(Qe,{})})}):e.jsx(B,{label:a._({id:"bD8I7O"}),position:"top",children:e.jsx(M,{color:"green",variant:"transparent",children:e.jsx(he,{})})})]})})}function Xe({title:t,currentStep:i,steps:u,children:c,opened:l,onClose:r,onNextStep:f,onPreviousStep:j,disableManualStepChange:m}){const _=s.useMemo(()=>e.jsxs(U,{gap:"xs",style:{width:"100%"},children:[e.jsxs(k,{gap:"xs",wrap:"nowrap",justify:"space-between",grow:!0,preventGrowOverflow:!1,children:[e.jsx(ne,{size:"xl",children:t}),e.jsx(Je,{currentStep:i,steps:u,disableManualStepChange:m,onSelectStep:x=>{m||(x<i?j?.():f?.())}}),e.jsx(_e,{})]}),e.jsx($,{})]}),[t,i,u]);return e.jsx(fe,{position:"bottom",size:"75%",title:_,withCloseButton:!0,closeOnEscape:!1,closeOnClickOutside:!1,styles:{header:{width:"100%"},title:{width:"100%"}},opened:l,onClose:r,children:e.jsx(Be,{label:"wizard-drawer",children:c})})}function Ye(t){const[i,u]=s.useState(0),[c,l]=s.useState(!1),[r,f]=s.useState(null),[j,m]=s.useState(null),_=s.useCallback(()=>{f(null),m(null)},[]);s.useEffect(()=>{c&&(u(0),_())},[c]);const x=s.useCallback(()=>{l(!0)},[]),o=s.useCallback(()=>{t.onClose?.(),l(!1)},[]),d=s.useCallback(()=>{u(g=>{if(t.canStepForward&&!t.canStepForward(g))return g;const S=Math.min(g+1,t.steps.length-1);return S!==g&&_(),S})},[t.canStepForward]),h=s.useCallback(()=>{u(g=>{if(t.canStepBackward&&!t.canStepBackward(g))return g;const S=Math.max(g-1,0);return S!==g&&_(),S})},[t.canStepBackward]),n=s.useCallback(g=>{g<0||g>=t.steps.length||(u(g),_())},[t.steps.length]),b=s.useMemo(()=>t.renderStep(i),[c,i,t.renderStep]);return{currentStep:i,opened:c,clearError:_,error:r,setError:f,errorDetail:j,setErrorDetail:m,openWizard:x,closeWizard:o,nextStep:d,previousStep:h,setStep:n,wizard:e.jsx(Xe,{disableManualStepChange:t.disableManualStepChange,title:t.title,currentStep:i,steps:t.steps,opened:c,onClose:o,onNextStep:d,onPreviousStep:h,children:e.jsxs(U,{gap:"xs",children:[r&&e.jsx(ee,{color:"red",title:r,icon:e.jsx(te,{}),children:j}),b]})})}}function Ze({partId:t,onQuantityChange:i}){const[u,c]=s.useState(0);s.useEffect(()=>{i?.(u)},[u]);const l=Re({endpoint:P.part_requirements,pk:t,hasPrimaryKey:!0,defaultValue:{}});return s.useMemo(()=>{if(l.instanceQuery.isFetching||l.instanceQuery.isLoading)return e.jsx(me,{size:"sm"});if(l.instanceQuery.isError)return e.jsx(B,{label:a._({id:"WMVuBL"}),children:e.jsx(M,{variant:"transparent",color:"red",children:e.jsx(te,{})})});const f=l.instance?.required_for_build_orders||0,j=l.instance?.required_for_sales_orders||0,m=f+j,_=l.instance?.building||0,x=l.instance?.ordering||0,o=_+x,d=l.instance?.total_stock||0,h=Math.max(0,m-d-o);return c(h),e.jsxs(W,{position:"bottom-end",children:[e.jsx(W.Target,{children:e.jsx(M,{variant:"transparent",color:h>0?"blue":"green",size:"sm",children:e.jsx(Le,{})})}),e.jsx(W.Dropdown,{children:e.jsxs(U,{gap:"xs",children:[e.jsx(y,{children:a._({id:"QuBpLd"})}),e.jsx($,{}),f>0&&e.jsxs(k,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"OQGQ1P"})}),e.jsx(y,{size:"xs",children:O(f)})]}),j>0&&e.jsxs(k,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"4PPMB0"})}),e.jsx(y,{size:"xs",children:O(j)})]}),d>0&&e.jsxs(k,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"zn38D/"})}),e.jsx(y,{size:"xs",children:O(d)})]}),x>0&&e.jsxs(k,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"0lg3zX"})}),e.jsx(y,{size:"xs",children:O(x)})]}),_>0&&e.jsxs(k,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"BE5Q6v"})}),e.jsx(y,{size:"xs",children:O(_)})]}),e.jsxs(k,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"D91mkk"})}),e.jsx(y,{size:"xs",children:O(h)})]})]})})]})},[l.instanceQuery.isFetching,l.instanceQuery.isLoading,l.instanceQuery.isError,l.instance,c])}function $e({records:t,onRemovePart:i,onSelectQuantity:u,onSelectSupplierPart:c,onSelectPurchaseOrder:l}){const[r,f]=s.useState(null),j=Ue({supplierId:r?.supplier_part?.supplier}),m=N({url:I(P.purchase_order_list),title:a._({id:"00xEJ9"}),fields:j,successMessage:a._({id:"x3sha9"}),onFormSuccess:n=>{l(r?.part.pk,n)}}),_=we({partId:r?.part.pk}),x=N({url:I(P.supplier_part_list),title:a._({id:"wvbkAd"}),fields:_,successMessage:a._({id:"LjPQ/X"}),onFormSuccess:n=>{c(r?.part.pk,n)}}),o=s.useMemo(()=>({order:{value:r?.purchase_order?.pk,disabled:!0},part:{value:r?.supplier_part?.pk,disabled:!0},reference:{},quantity:{},purchase_price:{},purchase_price_currency:{},merge_items:{}}),[r]),d=N({url:I(P.purchase_order_line_list),title:a._({id:"84UAd6"}),fields:o,focus:"quantity",initialData:{order:r?.purchase_order?.pk,part:r?.supplier_part?.pk,quantity:r?.quantity},onFormSuccess:n=>{i(r?.part)},successMessage:a._({id:"WdLHOQ"})}),h=s.useMemo(()=>[{accessor:"left_actions",title:" ",width:"1%",render:n=>e.jsx(k,{gap:"xs",wrap:"nowrap",justify:"left",children:e.jsx(ae,{tooltipAlignment:"top-start",onClick:()=>i(n.part)})})},{accessor:"part",title:a._({id:"vgP+9p"}),render:n=>e.jsx(B,{label:n.part?.description,children:e.jsx(je,{p:"xs",children:e.jsx(We,{part:n.part})})})},{accessor:"supplier_part",title:a._({id:"nne72x"}),width:"40%",render:n=>e.jsxs(k,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(Z,{children:e.jsx(T,{fieldName:"supplier_part",hideLabels:!0,error:n.errors?.supplier_part,fieldDefinition:{field_type:"related field",api_url:I(P.supplier_part_list),model:V.supplierpart,placeholder:a._({id:"5L5j54"}),required:!0,autoFill:!0,value:n.supplier_part?.pk,onValueChange:(b,g)=>{c(n.part.pk,g)},filters:{part:n.part.pk,active:!0,part_detail:!0,supplier_detail:!0}}})}),e.jsx(Me,{disabled:!n.supplier_part?.pk,value:n.supplier_part?.SKU,tooltipPosition:"top-end",tooltip:a._({id:"kM7due"})}),e.jsx(Y,{tooltip:a._({id:"vCJjUj"}),tooltipAlignment:"top-end",onClick:()=>{f(n),x.open()}})]})},{accessor:"purchase_order",title:a._({id:"KxySMG"}),width:"40%",render:n=>e.jsxs(k,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(Z,{children:e.jsx(T,{fieldName:"purchase_order",hideLabels:!0,fieldDefinition:{field_type:"related field",api_url:I(P.purchase_order_list),model:V.purchaseorder,placeholder:a._({id:"pfANUH"}),disabled:!n.supplier_part?.supplier,value:n.purchase_order?.pk,filters:{supplier:n.supplier_part?.supplier,outstanding:!0},onValueChange:(b,g)=>{l(n.part.pk,g)}}})}),e.jsx(Y,{tooltip:a._({id:"ilPjST"}),tooltipAlignment:"top-end",disabled:!n.supplier_part?.pk,onClick:()=>{f(n),m.open()}})]})},{accessor:"quantity",title:a._({id:"VbWX2u"}),width:150,render:n=>e.jsxs(k,{gap:"xs",wrap:"nowrap",children:[e.jsx(T,{fieldName:"quantity",hideLabels:!0,error:n.errors?.quantity,fieldDefinition:{field_type:"number",required:!0,value:n.quantity,onValueChange:b=>{u(n.part.pk,b)}}}),e.jsx(Ze,{partId:n.part.pk,onQuantityChange:b=>u(n.part.pk,b)})]})},{accessor:"right_actions",title:" ",width:"1%",render:n=>e.jsx(k,{grow:!0,gap:"xs",wrap:"nowrap",justify:"right",children:e.jsx(C,{onClick:()=>{f(n),d.open()},disabled:!n.supplier_part?.pk||!n.quantity||!n.purchase_order?.pk,icon:e.jsx(Te,{}),tooltip:a._({id:"T0PG4M"}),tooltipAlignment:"top-end",color:"blue"})})}],[i]);return t.length===0?e.jsx(ee,{color:"red",title:a._({id:"RHAB56"}),children:a._({id:"J6mnho"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{idAccessor:"part.pk",columns:h,records:t}),m.modal,x.modal,d.modal]})}function ft({parts:t}){const[i,u]=s.useState([]),c=s.useCallback(x=>{const o=i.filter(d=>d.part?.pk!==x.pk);u(o),o.length===0&&(_.closeWizard(),ge({title:a._({id:"sUQHeO"}),message:a._({id:"s2oix5"}),color:"green"}))},[i]),l=s.useCallback((x,o)=>{const d=[...i];d.forEach((h,n)=>{h.part.pk===x&&(d[n].quantity=o)}),u(d)},[i]),r=s.useCallback((x,o)=>{const d=[...i];d.forEach((h,n)=>{h.part.pk===x&&(d[n].supplier_part=o)}),u(d)},[i]),f=s.useCallback((x,o)=>{const d=[...i];d.forEach((h,n)=>{h.part.pk===x&&(d[n].purchase_order=o)}),u(d)},[i]),j=s.useCallback(x=>e.jsx($e,{records:i,onRemovePart:c,onSelectQuantity:l,onSelectSupplierPart:r,onSelectPurchaseOrder:f}),[i]),m=s.useCallback(x=>{if(!i?.length)return _.setError(a._({id:"RHAB56"})),_.setErrorDetail(a._({id:"hqPdIW"})),!1;let o=!0;const d=[...i];return i.forEach((h,n)=>{d[n].errors={supplier_part:h.supplier_part?null:a._({id:"f4INHl"}),quantity:!h.quantity||h.quantity<=0?a._({id:"siOHHM"}):null},Object.values(d[n].errors).some(b=>b)&&(o=!1)}),u(d),o||(_.setError(a._({id:"EG74zf"})),_.setErrorDetail(a._({id:"6FCFII"}))),o},[i]),_=Ye({title:a._({id:"3u5ICq"}),steps:[],renderStep:j,canStepForward:m});return s.useEffect(()=>{const x=[];_.opened?(t.filter(o=>o.purchaseable&&o.active).forEach(o=>{if(!x.find(d=>d.part?.pk===o.pk)){const d=(o.minimum_stock??0)+(o.required_for_build_orders??0)+(o.required_for_sales_orders??0),h=o.total_in_stock??0,n=o.ordering??0,b=o.building??0,g=d-h-n-b;x.push({part:o,supplier_part:void 0,purchase_order:void 0,quantity:Math.max(g,0),errors:{}})}}),u(x)):u([])},[_.opened]),_}export{Ge as I,ft as O,Ue as a,_t as b,pt as c,Ye as u};
//# sourceMappingURL=OrderPartsWizard-BcMgRjfh.js.map
