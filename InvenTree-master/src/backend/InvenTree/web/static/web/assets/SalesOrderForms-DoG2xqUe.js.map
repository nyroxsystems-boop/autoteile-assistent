{"version":3,"file":"SalesOrderForms-DoG2xqUe.js","sources":["../../../../../../frontend/src/forms/SalesOrderForms.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { Alert, Table, Text } from '@mantine/core';\nimport {\n  IconAddressBook,\n  IconCalendar,\n  IconCircleCheck,\n  IconCircleX,\n  IconCoins,\n  IconUser,\n  IconUsers\n} from '@tabler/icons-react';\nimport { useEffect, useMemo, useState } from 'react';\n\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport RemoveRowButton from '../components/buttons/RemoveRowButton';\nimport { StandaloneField } from '../components/forms/StandaloneField';\n\nimport { ProgressBar } from '@lib/components/ProgressBar';\nimport { apiUrl } from '@lib/functions/Api';\nimport { toNumber } from '@lib/functions/Conversion';\nimport type {\n  ApiFormAdjustFilterType,\n  ApiFormFieldSet,\n  ApiFormFieldType\n} from '@lib/types/Forms';\nimport type { TableFieldRowProps } from '../components/forms/fields/TableField';\nimport { useCreateApiFormModal, useEditApiFormModal } from '../hooks/UseForm';\nimport { useGlobalSettingsState } from '../states/SettingsStates';\nimport { useUserState } from '../states/UserState';\nimport { RenderPartColumn } from '../tables/ColumnRenderers';\n\nexport function useSalesOrderFields({\n  duplicateOrderId\n}: {\n  duplicateOrderId?: number;\n}): ApiFormFieldSet {\n  const globalSettings = useGlobalSettingsState();\n\n  return useMemo(() => {\n    const fields: ApiFormFieldSet = {\n      reference: {},\n      description: {},\n      customer: {\n        disabled: duplicateOrderId != undefined,\n        filters: {\n          is_customer: true,\n          active: true\n        }\n      },\n      customer_reference: {},\n      project_code: {},\n      order_currency: {},\n      start_date: {\n        icon: <IconCalendar />\n      },\n      target_date: {\n        icon: <IconCalendar />\n      },\n      link: {},\n      contact: {\n        icon: <IconUser />,\n        adjustFilters: (value: ApiFormAdjustFilterType) => {\n          return {\n            ...value.filters,\n            company: value.data.customer\n          };\n        }\n      },\n      address: {\n        icon: <IconAddressBook />,\n        adjustFilters: (value: ApiFormAdjustFilterType) => {\n          return {\n            ...value.filters,\n            company: value.data.customer\n          };\n        }\n      },\n      responsible: {\n        icon: <IconUsers />\n      }\n    };\n\n    // Order duplication fields\n    if (!!duplicateOrderId) {\n      fields.duplicate = {\n        children: {\n          order_id: {\n            hidden: true,\n            value: duplicateOrderId\n          },\n          copy_lines: {},\n          copy_extra_lines: {}\n        }\n      };\n    }\n\n    if (!globalSettings.isSet('PROJECT_CODES_ENABLED', true)) {\n      delete fields.project_code;\n    }\n\n    return fields;\n  }, [duplicateOrderId, globalSettings]);\n}\n\nexport function useSalesOrderLineItemFields({\n  customerId,\n  orderId,\n  create,\n  currency\n}: {\n  customerId?: number;\n  orderId?: number;\n  create?: boolean;\n  currency?: string;\n}): ApiFormFieldSet {\n  const [salePrice, setSalePrice] = useState<string | undefined>(undefined);\n  const [partCurrency, setPartCurrency] = useState<string>(currency ?? '');\n  const [part, setPart] = useState<any>({});\n  const [quantity, setQuantity] = useState<string>('1');\n\n  // Update suggested sale price when part, quantity, or part currency changes\n  useEffect(() => {\n    // Only attempt to set sale price for new line items\n    if (!create) return;\n\n    const qty = toNumber(quantity, null);\n\n    if (qty == null || qty <= 0) {\n      setSalePrice(undefined);\n      return;\n    }\n\n    if (!part || !part.price_breaks || part.price_breaks.length === 0) {\n      setSalePrice(undefined);\n      return;\n    }\n\n    const applicablePriceBreaks = part?.price_breaks\n      ?.filter(\n        (pb: any) => pb.price_currency == partCurrency && qty >= pb.quantity\n      )\n      .sort((a: any, b: any) => b.quantity - a.quantity);\n\n    if (applicablePriceBreaks.length) {\n      setSalePrice(applicablePriceBreaks[0].price);\n    } else {\n      setSalePrice(undefined);\n    }\n  }, [part, quantity, partCurrency, create]);\n\n  return useMemo(() => {\n    const fields: ApiFormFieldSet = {\n      order: {\n        filters: {\n          customer_detail: true\n        },\n        disabled: true,\n        value: create ? orderId : undefined\n      },\n      part: {\n        filters: {\n          active: true,\n          salable: true,\n          price_breaks: true\n        },\n        onValueChange: (_: any, record?: any) => setPart(record)\n      },\n      reference: {},\n      quantity: {\n        onValueChange: (value) => {\n          setQuantity(value);\n        }\n      },\n      sale_price: {\n        placeholder: salePrice,\n        placeholderAutofill: true\n      },\n      sale_price_currency: {\n        icon: <IconCoins />,\n        value: partCurrency,\n        onValueChange: setPartCurrency\n      },\n      project_code: {\n        description: t`Select project code for this line item`\n      },\n      target_date: {},\n      notes: {},\n      link: {}\n    };\n\n    return fields;\n  }, [salePrice, partCurrency, orderId, create]);\n}\n\nexport function useCheckShipmentForm({\n  shipmentId,\n  onSuccess\n}: {\n  shipmentId: number;\n  onSuccess: (response: any) => void;\n}) {\n  const user = useUserState();\n\n  return useEditApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    pk: shipmentId,\n    title: t`Check Shipment`,\n    preFormContent: (\n      <Alert color='green' icon={<IconCircleCheck />} title={t`Check Shipment`}>\n        <Text>{t`Marking the shipment as checked indicates that you have verified that all items included in this shipment are correct`}</Text>\n      </Alert>\n    ),\n    fetchInitialData: false,\n    fields: {\n      checked_by: {\n        hidden: true,\n        value: user.getUser()?.pk\n      }\n    },\n    successMessage: t`Shipment marked as checked`,\n    onFormSuccess: onSuccess\n  });\n}\n\nexport function useUncheckShipmentForm({\n  shipmentId,\n  onSuccess\n}: {\n  shipmentId: number;\n  onSuccess: (response: any) => void;\n}) {\n  return useEditApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    pk: shipmentId,\n    title: t`Uncheck Shipment`,\n    preFormContent: (\n      <Alert color='red' icon={<IconCircleX />} title={t`Uncheck Shipment`}>\n        <Text>{t`Marking the shipment as unchecked indicates that the shipment requires further verification`}</Text>\n      </Alert>\n    ),\n    fetchInitialData: false,\n    fields: {\n      checked_by: {\n        hidden: true,\n        value: null\n      }\n    },\n    successMessage: t`Shipment marked as unchecked`,\n    onFormSuccess: onSuccess\n  });\n}\n\nfunction SalesOrderAllocateLineRow({\n  props,\n  record,\n  sourceLocation\n}: Readonly<{\n  props: TableFieldRowProps;\n  record: any;\n  sourceLocation?: number | null;\n}>) {\n  // Statically defined field for selecting the stock item\n  const stockItemField: ApiFormFieldType = useMemo(() => {\n    return {\n      field_type: 'related field',\n      api_url: apiUrl(ApiEndpoints.stock_item_list),\n      model: ModelType.stockitem,\n      autoFill: true,\n      filters: {\n        available: true,\n        part_detail: true,\n        location_detail: true,\n        location: sourceLocation,\n        cascade: sourceLocation ? true : undefined,\n        part: record.part\n      },\n      value: props.item.stock_item,\n      name: 'stock_item',\n      onValueChange: (value: any, instance: any) => {\n        props.changeFn(props.idx, 'stock_item', value);\n\n        // Update the allocated quantity based on the selected stock item\n        if (instance) {\n          const available = instance.quantity - instance.allocated;\n          const required = record.quantity - record.allocated;\n\n          let quantity = props.item?.quantity ?? 0;\n\n          quantity = Math.max(quantity, required);\n          quantity = Math.min(quantity, available);\n\n          if (quantity != props.item.quantity) {\n            props.changeFn(props.idx, 'quantity', quantity);\n          }\n        }\n      }\n    };\n  }, [sourceLocation, record, props]);\n\n  // Statically defined field for selecting the allocation quantity\n  const quantityField: ApiFormFieldType = useMemo(() => {\n    return {\n      field_type: 'number',\n      name: 'quantity',\n      required: true,\n      value: props.item.quantity,\n      onValueChange: (value: any) => {\n        props.changeFn(props.idx, 'quantity', value);\n      }\n    };\n  }, [props]);\n\n  return (\n    <Table.Tr key={`table-row-${props.idx}-${record.pk}`}>\n      <Table.Td>\n        <RenderPartColumn part={record.part_detail} />\n      </Table.Td>\n      <Table.Td>\n        <ProgressBar\n          value={record.allocated}\n          maximum={record.quantity}\n          progressLabel\n        />\n      </Table.Td>\n      <Table.Td>\n        <StandaloneField\n          fieldName='stock_item'\n          fieldDefinition={stockItemField}\n          error={props.rowErrors?.stock_item?.message}\n        />\n      </Table.Td>\n      <Table.Td>\n        <StandaloneField\n          fieldName='quantity'\n          fieldDefinition={quantityField}\n          error={props.rowErrors?.quantity?.message}\n        />\n      </Table.Td>\n      <Table.Td>\n        <RemoveRowButton onClick={() => props.removeFn(props.idx)} />\n      </Table.Td>\n    </Table.Tr>\n  );\n}\n\nexport function useAllocateToSalesOrderForm({\n  orderId,\n  shipmentId,\n  lineItems,\n  onFormSuccess\n}: {\n  orderId: number;\n  shipmentId?: number;\n  lineItems: any[];\n  onFormSuccess: (response: any) => void;\n}) {\n  const [sourceLocation, setSourceLocation] = useState<number | null>(null);\n\n  // Reset source location to known state\n  useEffect(() => {\n    setSourceLocation(null);\n  }, [orderId, shipmentId, lineItems]);\n\n  const fields: ApiFormFieldSet = useMemo(() => {\n    return {\n      // Non-submitted field to select the source location\n      source_location: {\n        exclude: true,\n        required: false,\n        field_type: 'related field',\n        api_url: apiUrl(ApiEndpoints.stock_location_list),\n        model: ModelType.stocklocation,\n        label: t`Source Location`,\n        description: t`Select the source location for the stock allocation`,\n        onValueChange: (value: any) => {\n          setSourceLocation(value);\n        }\n      },\n      items: {\n        field_type: 'table',\n        value: [],\n        headers: [\n          { title: t`Part`, style: { minWidth: '200px' } },\n          { title: t`Allocated`, style: { minWidth: '200px' } },\n          { title: t`Stock Item`, style: { width: '100%' } },\n          { title: t`Quantity`, style: { minWidth: '200px' } },\n          { title: '', style: { width: '50px' } }\n        ],\n        modelRenderer: (row: TableFieldRowProps) => {\n          const record =\n            lineItems.find((item) => item.pk == row.item.line_item) ?? {};\n\n          return (\n            <SalesOrderAllocateLineRow\n              key={`table-row-${row.idx}-${record.pk}`}\n              props={row}\n              record={record}\n              sourceLocation={sourceLocation}\n            />\n          );\n        }\n      },\n      shipment: {\n        filters: {\n          shipped: false,\n          order_detail: true,\n          order: orderId\n        }\n      }\n    };\n  }, [orderId, shipmentId, lineItems, sourceLocation]);\n\n  return useCreateApiFormModal({\n    title: t`Allocate Stock`,\n    url: ApiEndpoints.sales_order_allocate,\n    pk: orderId,\n    fields: fields,\n    onFormSuccess: onFormSuccess,\n    successMessage: t`Stock items allocated`,\n    size: '80%',\n    initialData: {\n      items: lineItems.map((item) => {\n        return {\n          line_item: item.pk,\n          quantity: 0,\n          stock_item: null\n        };\n      })\n    }\n  });\n}\n\nexport function useSalesOrderAllocateSerialsFields({\n  itemId,\n  orderId\n}: {\n  itemId: number;\n  orderId: number;\n}): ApiFormFieldSet {\n  return useMemo(() => {\n    return {\n      line_item: {\n        value: itemId,\n        hidden: true\n      },\n      quantity: {},\n      serial_numbers: {},\n      shipment: {\n        filters: {\n          order_detail: true,\n          order: orderId,\n          shipped: false\n        }\n      }\n    };\n  }, [itemId, orderId]);\n}\n\nexport function useSalesOrderShipmentFields({\n  customerId,\n  pending\n}: {\n  customerId?: number;\n  pending?: boolean;\n}): ApiFormFieldSet {\n  return useMemo(() => {\n    return {\n      order: {\n        disabled: true\n      },\n      reference: {},\n      shipment_date: {\n        hidden: pending ?? true\n      },\n      delivery_date: {\n        hidden: pending ?? true\n      },\n      shipment_address: {\n        placeholder: t`Leave blank to use the order address`,\n        filters: {\n          company: customerId,\n          ordering: '-primary'\n        }\n      },\n      tracking_number: {},\n      invoice_number: {},\n      link: {}\n    };\n  }, [customerId, pending]);\n}\n\nexport function useSalesOrderShipmentCompleteFields({\n  shipmentId\n}: {\n  shipmentId?: number;\n}): ApiFormFieldSet {\n  return useMemo(() => {\n    return {\n      shipment_date: {},\n      tracking_number: {},\n      invoice_number: {},\n      link: {}\n    };\n  }, [shipmentId]);\n}\n\nexport function useSalesOrderAllocationFields({\n  orderId,\n  shipment\n}: {\n  orderId?: number;\n  shipment: any;\n}): ApiFormFieldSet {\n  return useMemo(() => {\n    return {\n      item: {\n        // Cannot change item, but display for reference\n        disabled: true\n      },\n      quantity: {},\n      shipment: {\n        // Cannot change shipment once it has been shipped\n        disabled: !!shipment?.shipment_date,\n        // Order ID is required for this field to be accessed\n        hidden: !orderId,\n        filters: {\n          order: orderId,\n          shipped: false\n        }\n      }\n    };\n  }, [orderId, shipment]);\n}\n"],"names":["useSalesOrderFields","duplicateOrderId","globalSettings","useGlobalSettingsState","useMemo","fields","reference","description","customer","disabled","undefined","filters","is_customer","active","customer_reference","project_code","order_currency","start_date","icon","IconCalendar","target_date","link","contact","IconUser","adjustFilters","value","company","data","address","IconAddressBook","responsible","IconUsers","duplicate","children","order_id","hidden","copy_lines","copy_extra_lines","isSet","useSalesOrderLineItemFields","customerId","orderId","create","currency","salePrice","setSalePrice","useState","partCurrency","setPartCurrency","part","setPart","quantity","setQuantity","useEffect","qty","toNumber","price_breaks","length","applicablePriceBreaks","filter","pb","price_currency","sort","a","b","price","order","customer_detail","salable","onValueChange","_","record","sale_price","placeholder","placeholderAutofill","sale_price_currency","IconCoins","_i18n","id","notes","useCheckShipmentForm","shipmentId","onSuccess","user","useUserState","useEditApiFormModal","url","ApiEndpoints","sales_order_shipment_list","pk","title","preFormContent","jsx","Alert","IconCircleCheck","Text","fetchInitialData","checked_by","getUser","successMessage","onFormSuccess","useUncheckShipmentForm","IconCircleX","SalesOrderAllocateLineRow","props","sourceLocation","stockItemField","field_type","api_url","apiUrl","stock_item_list","model","ModelType","stockitem","autoFill","available","part_detail","location_detail","location","cascade","item","stock_item","name","instance","changeFn","idx","allocated","required","Math","max","min","quantityField","jsxs","Table","RenderPartColumn","ProgressBar","StandaloneField","rowErrors","message","RemoveRowButton","removeFn","useAllocateToSalesOrderForm","lineItems","setSourceLocation","source_location","exclude","stock_location_list","stocklocation","label","items","headers","style","minWidth","width","modelRenderer","row","find","line_item","shipment","shipped","order_detail","useCreateApiFormModal","sales_order_allocate","size","initialData","map","useSalesOrderAllocateSerialsFields","itemId","serial_numbers","useSalesOrderShipmentFields","pending","shipment_date","delivery_date","shipment_address","ordering","tracking_number","invoice_number","useSalesOrderShipmentCompleteFields","useSalesOrderAllocationFields"],"mappings":"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"}