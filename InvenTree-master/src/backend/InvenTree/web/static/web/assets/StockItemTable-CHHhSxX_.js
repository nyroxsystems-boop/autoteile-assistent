import{ag as A,az as T,r as p,bb as b,ab as e,ao as S,aD as w,j as s,b1 as j,an as C,d as a,N as L}from"./index-Db7AGPIq.js";import{A as V}from"./ActionButton-Cv5j5I5R.js";import{a as M,d as D,f as y,T as N,i as U,F as B,j as H,a4 as O,a5 as q,H as G,B as X,z as J,C as K,D as Q,E as W}from"./Filter-BgnAqEQC.js";import{O as Y}from"./OrderPartsWizard-BcMgRjfh.js";import{b as Z,a as $}from"./formatters-B4ehJgEk.js";import{f as ee}from"./PluginUIFeature-DCu8wTdG.js";import{a as te,t as se}from"./ThemeContext-CxdCkKtz.js";import{u as ie}from"./UseStockAdjustActions-BrgagWbF.js";import{u as ae,I as re}from"./InvenTreeTable-DmN557zY.js";import{P as le,D as oe,S as de,f as ce,a as h}from"./ColumnRenderers-BUH0stTX.js";function ne({showLocation:r,showPricing:_}){return[le({accessor:"part",part:"part_detail"}),{accessor:"part_detail.IPN",title:e._({id:"3wXEsN"}),sortable:!0},{accessor:"part_detail.revision",title:e._({id:"6LTyxl"}),sortable:!0,defaultVisible:!1},oe({accessor:"part_detail.description"}),{accessor:"quantity",ordering:"stock",sortable:!0,title:e._({id:"blbbPS"}),render:t=>{const o=t?.quantity??0,c=t?.allocated??0,n=o-c;let l=y(o);const u=t?.part_detail??{},i=[];let d;return t.serial&&o==1&&(l=`# ${t.serial}`),t.is_building?(d="blue",i.push(s.jsx(a,{size:"sm",children:e._({id:"fh2Vf5"})},"production"))):t.sales_order?i.push(s.jsx(a,{size:"sm",children:e._({id:"X1BIR/"})},"sales-order")):t.customer?i.push(s.jsx(a,{size:"sm",children:e._({id:"fHlvYo"})},"customer")):t.belongs_to?i.push(s.jsx(a,{size:"sm",children:e._({id:"bGwMIh"})},"belongs-to")):t.consumed_by?i.push(s.jsx(a,{size:"sm",children:e._({id:"Xig/cj"})},"consumed-by")):t.in_stock||i.push(s.jsx(a,{size:"sm",children:e._({id:"szsXHP"})},"unavailable")),t.expired?i.push(s.jsx(a,{size:"sm",children:e._({id:"x/QIhZ"})},"expired")):t.stale&&i.push(s.jsx(a,{size:"sm",children:e._({id:"UtuqjX"})},"stale")),t.in_stock&&(c>0&&(c>=o?(d="orange",i.push(s.jsx(a,{size:"sm",children:e._({id:"L1D5PL"})},"fully-allocated"))):i.push(s.jsx(a,{size:"sm",children:e._({id:"PjVOCj"})},"partially-allocated"))),n!=o&&(n>0?i.push(s.jsx(a,{size:"sm",c:"orange",children:`${e._({id:"csDS2L"})}: ${y(n)}`},"available")):i.push(s.jsx(a,{size:"sm",c:"red",children:e._({id:"a5n/wL"})},"no-stock"))),o<=0&&i.push(s.jsx(a,{size:"sm",children:e._({id:"ddPzUj"})},"depleted"))),t.in_stock||(d="red"),s.jsx(N,{value:s.jsxs(L,{gap:"xs",justify:"left",wrap:"nowrap",children:[s.jsx(a,{c:d,children:l}),u.units&&s.jsxs(a,{size:"xs",c:d,children:["[",u.units,"]"]})]}),title:e._({id:"odasNw"}),extra:i})}},de({model:b.stockitem}),{accessor:"batch",sortable:!0},ce({hidden:!r,accessor:"location_detail"}),{accessor:"purchase_order",title:e._({id:"KxySMG"}),defaultVisible:!1,render:t=>t.purchase_order_reference},{accessor:"SKU",title:e._({id:"nne72x"}),sortable:!0,defaultVisible:!1},{accessor:"MPN",title:e._({id:"bisS0I"}),sortable:!0,defaultVisible:!1},{accessor:"purchase_price",title:e._({id:"vWelsN"}),sortable:!0,switchable:!0,hidden:!_,defaultVisible:!1,render:t=>Z(t.purchase_price,{currency:t.purchase_price_currency})},{accessor:"stock_value",title:e._({id:"g9RfVq"}),sortable:!1,hidden:!_,render:t=>{const o=t.purchase_price||t.part_detail?.pricing_min,c=t.purchase_price||t.part_detail?.pricing_max,n=t.purchase_price_currency||void 0;return $(o,c,{currency:n,multiplier:t.quantity})}},{accessor:"packaging",sortable:!0,defaultVisible:!1},h({title:e._({id:"uaSvqt"}),accessor:"expiry_date",hidden:!T.getState().isSet("STOCK_ENABLE_EXPIRY"),defaultVisible:!1}),h({title:e._({id:"K7P0jz"}),accessor:"updated"}),h({accessor:"stocktake_date",title:e._({id:"6OScNP"}),sortable:!0})]}function ue({enableExpiry:r}){return[{name:"active",label:e._({id:"F6pfE9"}),description:e._({id:"UjHL/d"})},{name:"status",label:e._({id:"uAQUqI"}),description:e._({id:"+Jr1e4"}),choiceFunction:U(b.stockitem)},{name:"assembly",label:e._({id:"WL36Yh"}),description:e._({id:"3Ah+L7"})},{name:"allocated",label:e._({id:"A/ybx7"}),description:e._({id:"pxiNcZ"})},{name:"available",label:e._({id:"csDS2L"}),description:e._({id:"kbUAFH"})},{name:"cascade",label:e._({id:"VY386J"}),description:e._({id:"fMbOmV"})},{name:"depleted",label:e._({id:"9/P0N3"}),description:e._({id:"0n9TfP"})},B(),{name:"is_building",label:e._({id:"BE5Q6v"}),description:e._({id:"c64azd"})},H(),O(),q(),{name:"consumed",label:e._({id:"XNITBt"}),description:e._({id:"1yWWZV"})},{name:"installed",label:e._({id:"eQkgKV"}),description:e._({id:"GQ73kf"})},{name:"sent_to_customer",label:e._({id:"XwjZor"}),description:e._({id:"LPuYfz"})},G(),X(),J(),K(),Q(),W(),{name:"tracked",label:e._({id:"EaG6cP"}),description:e._({id:"TRFyJq"})},{name:"has_purchase_price",label:e._({id:"+MprDT"}),description:e._({id:"tAFrkr"})},{name:"expired",label:e._({id:"M1RnFv"}),description:e._({id:"JiHUig"}),active:r},{name:"stale",label:e._({id:"1ba70W"}),description:e._({id:"SQjqoc"}),active:r},{name:"expiry_before",label:e._({id:"mHDi5V"}),description:e._({id:"j2+SIa"}),type:"date",active:r},{name:"expiry_after",label:e._({id:"snknx0"}),description:e._({id:"UyBcoZ"}),type:"date",active:r},{name:"updated_before",label:e._({id:"h8xl5M"}),description:e._({id:"5zwJta"}),type:"date"},{name:"updated_after",label:e._({id:"nl9mSR"}),description:e._({id:"P5Y0sz"}),type:"date"},{name:"stocktake_before",label:e._({id:"Hj/Grl"}),description:e._({id:"iTehcJ"}),type:"date"},{name:"stocktake_after",label:e._({id:"+GUu77"}),description:e._({id:"w30K80"}),type:"date"},{name:"external",label:e._({id:"k7rbV9"}),description:e._({id:"ETtRZU"})}]}function ye({params:r={},allowAdd:_=!1,showLocation:t=!0,showPricing:o=!0,allowReturn:c=!1,tableName:n="stockitems"}){const l=ae(n),u=A(),i=T(),d=p.useMemo(()=>i.isSet("STOCK_ENABLE_EXPIRY"),[i]),z=te(),I=p.useMemo(()=>ne({showLocation:t??!0,showPricing:o??!0}),[t,o]),g=p.useMemo(()=>ue({enableExpiry:d}),[d]),F=p.useMemo(()=>({items:l.selectedRecords,model:b.stockitem,refresh:()=>{l.clearSelectedRecords(),l.refreshTable()},filters:{in_stock:!0}}),[l.selectedRecords,l.refreshTable]),v=ee({create:!0,partId:r.part,supplierPartId:r.supplier_part,pricing:r.pricing,modalId:"add-stock-item"}),k=M({url:S.stock_item_list,title:e._({id:"bJLEQT"}),modalId:"add-stock-item",fields:v,initialData:{part:r.part,location:r.location},follow:r.openNewStockItem??!0,table:l,onFormSuccess:m=>{z(w(b.stockitem,m[0].pk))},successMessage:e._({id:"Hkw/xj"})}),[P,R]=p.useState([]),x=Y({parts:P}),f=ie({formProps:F,return:c}),E=p.useMemo(()=>[f.dropdown,s.jsx(V,{hidden:!u.hasAddRole(j.purchase_order),tooltip:e._({id:"0TfxKY"}),icon:s.jsx(se,{icon:"buy"}),disabled:!l.hasSelectedRecords,onClick:()=>{R(l.selectedRecords.map(m=>m.part_detail)),x.openWizard()}},"stock-order"),s.jsx(D,{hidden:!_||!u.hasAddRole(j.stock),tooltip:e._({id:"bJLEQT"}),onClick:()=>k.open()},"add-stock-item")],[u,_,l.hasSelectedRecords,l.selectedRecords,f.dropdown]);return s.jsxs(s.Fragment,{children:[k.modal,x.wizard,f.modals.map(m=>m.modal),s.jsx(re,{url:C(S.stock_item_list),tableState:l,columns:I,props:{enableDownload:!0,enableSelection:!0,enableLabels:!0,enableReports:!0,tableFilters:g,tableActions:E,modelType:b.stockitem,params:{...r,part_detail:!0,location_detail:!0,supplier_part_detail:!0}}})]})}export{ye as S};
//# sourceMappingURL=StockItemTable-CHHhSxX_.js.map
