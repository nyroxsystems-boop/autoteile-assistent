import{ag as U,j as s,N as m,S as v,d as f,aA as z,ab as d,b2 as P,b5 as C,$ as A,r as i,bb as q,aC as B,e as R,an as $,O as _,al as F,c9 as G,az as N,be as V,bE as j,aq as M,a8 as D,b4 as W,bK as H,c as O,ca as w,ao as L,cb as k,cc as Q}from"./index-Db7AGPIq.js";import{a as X,S as J,B as K,aB as E,r as Y}from"./ThemeContext-CxdCkKtz.js";import{u as Z}from"./DesktopAppView-BuH2j218.js";import{R as ee,b as se}from"./Filter-BgnAqEQC.js";function oe({label:e,title:a,shorthand:l,subtitle:n}){const c=U(),r=X();return s.jsxs(m,{justify:"space-between",children:[s.jsxs(v,{gap:"0",ml:"sm",children:[s.jsxs(m,{children:[s.jsx(J,{size:"xl",children:a}),l&&s.jsxs(f,{c:"dimmed",children:["(",l,")"]})]}),s.jsx(m,{children:n?s.jsx(f,{c:"dimmed",children:n}):null})]}),c.isStaff()&&s.jsx(z,{data:[{value:"user",label:d._({id:"ekfzWq"})},{value:"system",label:d._({id:"zNkWa6"})},{value:"admin",label:d._({id:"uTLn08"})}],onChange:t=>r(`/settings/${t}`),value:e})]})}function ae({setting:e,onEdit:a,onToggle:l}){const n=i.useMemo(()=>{let o=e.value;return e?.choices&&e?.choices?.length>0&&(o=e.choices.find(b=>b.value==e.value)?.display_name||e.value),e?.units&&(o=`${o} ${e.units}`),o},[e]),[c,r]=i.useState(null),t=i.useCallback(()=>{e.read_only||a(e)},[e,a]),S=i.useCallback(o=>{e.read_only||l(e,o.currentTarget.checked)},[e,l]),p=i.useMemo(()=>{if(e.model_name){const o=e.model_name.split(".")[1];return q[o]||null}return null},[e]);if(i.useEffect(()=>{if(r(null),p&&e.value){const o=B[p].api_endpoint;R.get($(o,e.value)).then(h=>{h.data?r(h.data):r(null)}).catch(h=>{r(null)})}},[e,p]),c&&p&&e.value)return s.jsxs(m,{justify:"right",gap:"xs",children:[s.jsx(ee,{instance:c,model:p}),s.jsx(_,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:t,children:s.jsx(E,{})})]});switch(e?.type||"string"){case"boolean":return s.jsx(G,{size:"sm",radius:"lg","aria-label":`toggle-setting-${e.key}`,disabled:e.read_only,checked:e.value.toString().toLowerCase()=="true",onChange:S,wrapperProps:{"aria-label":`setting-${e.key}-wrapper`},style:{paddingRight:"20px"}});default:return n?s.jsxs(m,{gap:"xs",justify:"right",children:[s.jsx(F,{}),s.jsx(_,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:t,children:n})]}):s.jsx(_,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:t,children:s.jsx(E,{})})}}function ne({setting:e,shaded:a,onEdit:l,onToggle:n}){const{colorScheme:c}=P(),r={paddingLeft:"8px"};return a&&(r.backgroundColor=c==="light"?C.colors.gray[1]:C.colors.gray[9]),s.jsx(A,{style:r,children:s.jsxs(m,{justify:"space-between",p:"3",children:[s.jsxs(v,{gap:"2",p:"4px",children:[s.jsxs(f,{children:[e.name,e.required?" *":""]}),s.jsx(f,{size:"xs",children:e.description})]}),s.jsx(K,{label:`setting-value-${e.key}`,children:s.jsx(ae,{setting:e,onEdit:l,onToggle:n})})]})})}function g({settingsState:e,keys:a,onChange:l,onLoaded:n}){i.useEffect(()=>{e.loaded&&n?.(e)},[e.loaded,e.settings]);const c=Z(),r=i.useMemo(()=>e?.settings?.map(u=>u.key)??[],[e?.settings]),[t,S]=i.useState(void 0),p=i.useMemo(()=>t?.choices?.length?"choice":t?.type!=null?t.type:"string",[t]),o=i.useMemo(()=>t?.key??"",[t]),h=se({url:e.endpoint,pk:o,pathParams:e.pathParams,title:d._({id:"mjN1LS"}),fields:{value:{field_type:p,required:t?.required??!1,label:t?.name,description:t?.description,api_url:t?.api_url??"",model:t?.model_name?.split(".")[1]??null,filters:t?.model_filters||void 0,choices:t?.choices??void 0}},successMessage:d._({id:"1onc6y",values:{key:o}}),onFormSuccess:()=>{e.fetchSettings(),l?.()}}),b=i.useCallback(u=>{S(u),h.open()},[h]),T=i.useCallback((u,y)=>{c.patch($(e.endpoint,u.key,e.pathParams),{value:y}).then(()=>{j.hide("setting"),j.show({title:d._({id:"C3htzi"}),message:d._({id:"n/n6vh",values:{0:u.key}}),color:"green",id:"setting"}),l?.()}).catch(x=>{j.hide("setting"),j.show({title:d._({id:"CsUgn+"}),message:x.message,color:"red",id:"setting"})}).finally(()=>{e.fetchSettings()})},[e]);return e.isError?s.jsx(M,{color:"red",icon:s.jsx(D,{}),title:d._({id:"SlfejT"}),children:s.jsx(f,{children:d._({id:"wXadfA"})})}):e?.loaded?(a||r).length===0?s.jsx(M,{color:"blue",icon:s.jsx(Y,{}),title:d._({id:"j+o7ms"}),children:s.jsx(f,{children:d._({id:"9922QB"})})}):s.jsxs(s.Fragment,{children:[h.modal,s.jsxs(v,{gap:"xs",children:[(a||r)?.map((u,y)=>{const x=e?.settings?.find(I=>I.key===u);return e?.settings&&!x&&console.error(`Setting ${u} not found`),s.jsx(H.Fragment,{children:x?s.jsx(ne,{setting:x,shaded:y%2===0,onEdit:b,onToggle:T}):s.jsxs(f,{size:"sm",style:{fontStyle:"italic"},c:"red",children:["Setting ",u," not found"]})},u)}),(a||r)?.length===0&&s.jsx(f,{style:{fontStyle:"italic"},children:s.jsx(O,{id:"3CUVvD"})})]})]}):s.jsx(W,{animate:!0})}function ce({keys:e}){const a=V();return s.jsx(g,{settingsState:a,keys:e})}function de({keys:e}){const a=N();return s.jsx(g,{settingsState:a,keys:e})}function ue({pluginKey:e,onLoaded:a}){const l=i.useMemo(()=>w({plugin:e,endpoint:L.plugin_setting_list}),[e]),n=k(l);return i.useEffect(()=>{n.fetchSettings()},[n.fetchSettings]),s.jsx(g,{settingsState:n,onLoaded:a})}function he({pluginKey:e,onLoaded:a}){const l=i.useMemo(()=>w({plugin:e,endpoint:L.plugin_user_setting_list}),[e]),n=k(l);return i.useEffect(()=>{n.fetchSettings()},[n.fetchSettings]),s.jsx(g,{settingsState:n,onLoaded:a})}function fe({machinePk:e,configType:a,onChange:l}){const n=i.useMemo(()=>Q({machine:e,configType:a}),[e,a]),c=k(n);return i.useEffect(()=>{c.fetchSettings()},[c.fetchSettings]),s.jsx(g,{settingsState:c,onChange:l})}export{de as G,fe as M,ue as P,oe as S,ce as U,he as a};
//# sourceMappingURL=SettingList-Bc72M5k9.js.map
