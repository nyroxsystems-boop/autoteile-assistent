{"version":3,"file":"SalesOrderShipmentTable-B57Wq2FS.js","sources":["../../../../../../frontend/src/tables/sales/SalesOrderShipmentTable.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport {\n  IconCircleCheck,\n  IconCircleX,\n  IconTruckDelivery\n} from '@tabler/icons-react';\nimport { useCallback, useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport {\n  type RowAction,\n  RowCancelAction,\n  RowEditAction,\n  RowViewAction\n} from '@lib/components/RowActions';\nimport { YesNoButton } from '@lib/components/YesNoButton';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport dayjs from 'dayjs';\nimport {\n  useCheckShipmentForm,\n  useSalesOrderShipmentCompleteFields,\n  useSalesOrderShipmentFields,\n  useUncheckShipmentForm\n} from '../../forms/SalesOrderForms';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport {\n  CompanyColumn,\n  DateColumn,\n  LinkColumn,\n  StatusColumn\n} from '../ColumnRenderers';\nimport { InvenTreeTable } from '../InvenTreeTable';\n\nexport default function SalesOrderShipmentTable({\n  showOrderInfo = false,\n  tableName,\n  customerId,\n  orderId,\n  filters\n}: Readonly<{\n  showOrderInfo?: boolean;\n  tableName?: string;\n  customerId?: number;\n  orderId?: number;\n  filters?: any;\n}>) {\n  const user = useUserState();\n  const navigate = useNavigate();\n  const table = useTable(tableName ?? 'sales-order-shipment');\n\n  const [selectedShipment, setSelectedShipment] = useState<any>({});\n\n  const newShipmentFields = useSalesOrderShipmentFields({\n    customerId: customerId\n  });\n\n  const editShipmentFields = useSalesOrderShipmentFields({\n    customerId: customerId,\n    pending: !selectedShipment.shipment_date\n  });\n\n  const completeShipmentFields = useSalesOrderShipmentCompleteFields({});\n\n  const newShipment = useCreateApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    fields: newShipmentFields,\n    title: t`Create Shipment`,\n    table: table,\n    initialData: {\n      order: orderId\n    }\n  });\n\n  const deleteShipment = useDeleteApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    pk: selectedShipment.pk,\n    title: t`Cancel Shipment`,\n    table: table\n  });\n\n  const editShipment = useEditApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    pk: selectedShipment.pk,\n    fields: editShipmentFields,\n    title: t`Edit Shipment`,\n    table: table\n  });\n\n  const checkShipment = useCheckShipmentForm({\n    shipmentId: selectedShipment.pk,\n    onSuccess: () => {\n      table.refreshTable();\n    }\n  });\n\n  const uncheckShipment = useUncheckShipmentForm({\n    shipmentId: selectedShipment.pk,\n    onSuccess: () => {\n      table.refreshTable();\n    }\n  });\n\n  const completeShipment = useCreateApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_complete,\n    pk: selectedShipment.pk,\n    fields: completeShipmentFields,\n    title: t`Complete Shipment`,\n    table: table,\n    focus: 'tracking_number',\n    initialData: {\n      ...selectedShipment,\n      shipment_date: dayjs().format('YYYY-MM-DD')\n    }\n  });\n\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'customer',\n        title: t`Customer`,\n        switchable: true,\n        sortable: true,\n        hidden: !showOrderInfo,\n        render: (record: any) => (\n          <CompanyColumn company={record.customer_detail} />\n        )\n      },\n      {\n        switchable: false,\n        accessor: 'order_detail.reference',\n        title: t`Sales Order`,\n        hidden: !showOrderInfo,\n        sortable: false\n      },\n      StatusColumn({\n        switchable: true,\n        model: ModelType.salesorder,\n        accessor: 'order_detail.status',\n        title: t`Order Status`,\n        hidden: !showOrderInfo\n      }),\n      {\n        accessor: 'reference',\n        title: t`Shipment Reference`,\n        switchable: false,\n        sortable: true\n      },\n      {\n        accessor: 'allocated_items',\n        sortable: true,\n        switchable: false,\n        title: t`Items`\n      },\n      {\n        accessor: 'checked',\n        title: t`Checked`,\n        switchable: true,\n        sortable: false,\n        render: (record: any) => <YesNoButton value={!!record.checked_by} />\n      },\n      {\n        accessor: 'shipped',\n        title: t`Shipped`,\n        switchable: true,\n        sortable: false,\n        render: (record: any) => <YesNoButton value={!!record.shipment_date} />\n      },\n      {\n        accessor: 'delivered',\n        title: t`Delivered`,\n        switchable: true,\n        sortable: false,\n        render: (record: any) => <YesNoButton value={!!record.delivery_date} />\n      },\n      DateColumn({\n        accessor: 'shipment_date',\n        title: t`Shipment Date`\n      }),\n      DateColumn({\n        accessor: 'delivery_date',\n        title: t`Delivery Date`\n      }),\n      {\n        accessor: 'tracking_number'\n      },\n      {\n        accessor: 'invoice_number'\n      },\n      LinkColumn({\n        accessor: 'link'\n      })\n    ];\n  }, [showOrderInfo]);\n\n  const rowActions = useCallback(\n    (record: any): RowAction[] => {\n      const shipped: boolean = !!record.shipment_date;\n\n      return [\n        {\n          hidden:\n            !!record.checked_by || !user.hasChangeRole(UserRoles.sales_order),\n          title: t`Check Shipment`,\n          color: 'blue',\n          icon: <IconCircleCheck />,\n          onClick: () => {\n            setSelectedShipment(record);\n            checkShipment.open();\n          }\n        },\n        {\n          hidden:\n            shipped ||\n            !record.checked_by ||\n            !user.hasChangeRole(UserRoles.sales_order),\n          title: t`Uncheck Shipment`,\n          color: 'red',\n          icon: <IconCircleX />,\n          onClick: () => {\n            setSelectedShipment(record);\n            uncheckShipment.open();\n          }\n        },\n        {\n          hidden: shipped || !user.hasChangeRole(UserRoles.sales_order),\n          title: t`Complete Shipment`,\n          color: 'green',\n          icon: <IconTruckDelivery />,\n          onClick: () => {\n            setSelectedShipment(record);\n            completeShipment.open();\n          }\n        },\n        RowEditAction({\n          hidden: !user.hasChangeRole(UserRoles.sales_order),\n          tooltip: t`Edit shipment`,\n          onClick: () => {\n            setSelectedShipment(record);\n            editShipment.open();\n          }\n        }),\n        RowCancelAction({\n          hidden: shipped || !user.hasDeleteRole(UserRoles.sales_order),\n          tooltip: t`Cancel shipment`,\n          onClick: () => {\n            setSelectedShipment(record);\n            deleteShipment.open();\n          }\n        }),\n        RowViewAction({\n          title: t`View Sales Order`,\n          modelType: ModelType.salesorder,\n          modelId: record.order,\n          hidden:\n            !record.order ||\n            !showOrderInfo ||\n            !user.hasViewRole(UserRoles.sales_order),\n          navigate: navigate\n        })\n      ];\n    },\n    [showOrderInfo, user]\n  );\n\n  const tableActions = useMemo(() => {\n    // No actions possible if no order is specified\n    if (!orderId) {\n      return [];\n    }\n\n    return [\n      <AddItemButton\n        key='add-shipment'\n        tooltip={t`Add shipment`}\n        hidden={!user.hasAddRole(UserRoles.sales_order)}\n        onClick={() => {\n          newShipment.open();\n        }}\n      />\n    ];\n  }, [orderId, user]);\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'checked',\n        label: t`Checked`,\n        description: t`Show shipments which have been checked`\n      },\n      {\n        name: 'shipped',\n        label: t`Shipped`,\n        description: t`Show shipments which have been shipped`\n      },\n      {\n        name: 'delivered',\n        label: t`Delivered`,\n        description: t`Show shipments which have been delivered`\n      }\n    ];\n  }, []);\n\n  return (\n    <>\n      {newShipment.modal}\n      {editShipment.modal}\n      {checkShipment.modal}\n      {deleteShipment.modal}\n      {uncheckShipment.modal}\n      {completeShipment.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.sales_order_shipment_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          tableActions: tableActions,\n          tableFilters: tableFilters,\n          modelType: ModelType.salesordershipment,\n          enableSelection: true,\n          enableReports: true,\n          rowActions: rowActions,\n          params: {\n            order: orderId,\n            order_detail: true,\n            customer_detail: showOrderInfo,\n            ...filters\n          }\n        }}\n      />\n    </>\n  );\n}\n"],"names":["SalesOrderShipmentTable","showOrderInfo","tableName","customerId","orderId","filters","user","useUserState","navigate","useNavigate","table","useTable","selectedShipment","setSelectedShipment","useState","newShipmentFields","useSalesOrderShipmentFields","editShipmentFields","pending","shipment_date","completeShipmentFields","useSalesOrderShipmentCompleteFields","newShipment","useCreateApiFormModal","url","ApiEndpoints","sales_order_shipment_list","fields","title","_i18n","_","id","initialData","order","deleteShipment","useDeleteApiFormModal","pk","editShipment","useEditApiFormModal","checkShipment","useCheckShipmentForm","shipmentId","onSuccess","refreshTable","uncheckShipment","useUncheckShipmentForm","completeShipment","sales_order_shipment_complete","focus","dayjs","format","tableColumns","useMemo","accessor","switchable","sortable","hidden","render","record","CompanyColumn","customer_detail","StatusColumn","model","ModelType","salesorder","jsx","YesNoButton","checked_by","delivery_date","DateColumn","LinkColumn","rowActions","useCallback","shipped","hasChangeRole","UserRoles","sales_order","color","icon","IconCircleCheck","onClick","open","IconCircleX","IconTruckDelivery","RowEditAction","tooltip","RowCancelAction","hasDeleteRole","RowViewAction","modelType","modelId","hasViewRole","tableActions","AddItemButton","hasAddRole","tableFilters","name","label","description","jsxs","Fragment","modal","InvenTreeTable","apiUrl","salesordershipment","enableSelection","enableReports","params","order_detail"],"mappings":"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"}