import{K as q,j as a,aA as H,aa as L,ac as Q,r as i,aw as S,ab as k,S as J,aj as X,N as P,ay as Z,a$ as ee,ag as te,ao as C,b1 as ae,an as O,bg as re,aD as le,b8 as ne}from"./index-Db7AGPIq.js";import{a as se,b as ie,f as ce,T as oe}from"./Filter-BgnAqEQC.js";import{Y as ue}from"./YesNoButton-BaVgP5u9.js";import{a as me,v as de,a9 as fe}from"./ThemeContext-CxdCkKtz.js";import{u as be}from"./DesktopAppView-BuH2j218.js";import{u as he}from"./CommonForms-DKQecQmS.js";import{u as xe,I as ke}from"./InvenTreeTable-DmN557zY.js";import{u as je}from"./use-hover-Cq0v4QX_.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M10 3v18",key:"svg-2"}]],Ae=q("outline","table","Table",ve);function ge({data:e,value:r,size:n="sm",color:b,onChange:h}){return a.jsx(H,{value:r,onChange:h,data:e.map(o=>({value:o.value,label:a.jsx(L,{label:o.label,position:"top-end",children:a.jsx(Q,{variant:"transparent",color:b,size:n,"aria-label":`segmented-icon-control-${o.value}`,onClick:()=>h(o.value),children:o.icon})})}))})}function Oe(e){let r=null;for(const n of e.options)if(n.value===e.selection){r=n.content;break}return r===null&&e.options.length>0&&(r=e.options[0].content),{...e,content:r,controls:a.jsx(ge,{value:e.selection,onChange:e.onChange,data:e.options.map(n=>({value:n.value,label:n.label,icon:n.icon}))})}}const D={"=":"",">":"_gt",">=":"_gte","<":"_lt","<=":"_lte","!=":"_ne","~":"_icontains"};function pe(e){const r=i.useMemo(()=>e.filters["="]??"",[e.filters]);return a.jsx(S,{"aria-label":`filter-${e.template.name}`,data:[{value:"true",label:k._({id:"c+xCSz"})},{value:"false",label:k._({id:"ocUvR+"})}],value:r,clearable:!0,defaultValue:r,onClear:()=>{e.clearFilter(e.template.pk,""),e.closeFilter()},onChange:n=>e.setFilter(e.template.pk,n??"","="),placeholder:k._({id:"jf/x3i"}),clearButtonProps:{"aria-label":`clear-filter-${e.template.name}`}})}function Fe(e){const r=i.useMemo(()=>e.filters["="]??"",[e.filters]);return a.jsx(S,{"aria-label":`filter-${e.template.name}`,data:e.template.choices.split(",").map(n=>n.trim()),value:r,defaultValue:r,onChange:n=>e.setFilter(e.template.pk,n??"","="),onClear:()=>{e.clearFilter(e.template.pk,""),e.closeFilter()},clearButtonProps:{"aria-label":`clear-filter-${e.template.name}`},placeholder:k._({id:"jf/x3i"}),searchable:!0,clearable:!0})}function y({props:e,value:r,operator:n,readonly:b}){const h=i.useMemo(()=>{let u=k._({id:"0AYT5C"});return e.template.units&&(u+=` [${e.template.units}]`),u},[e.template.units]),[o,d]=i.useState(n);return i.useEffect(()=>{d(n)},[n]),a.jsxs(P,{gap:"xs",wrap:"nowrap",children:[a.jsx("div",{onMouseDown:u=>u.stopPropagation(),style:{width:75},children:a.jsx(S,{onClick:u=>{u?.stopPropagation()},"aria-label":`filter-${e.template.name}-operator`,data:Object.keys(D),value:o,searchable:!1,clearable:!1,defaultValue:"=",onChange:u=>{d(u??"=")},size:"sm",disabled:b,width:75})}),a.jsx(Z,{"aria-label":`filter-${e.template.name}`,placeholder:h,defaultValue:r,onKeyDown:u=>{u.key==="Enter"&&(e.setFilter(e.template.pk,u.currentTarget.value||"",o),e.closeFilter())},rightSection:b&&a.jsx(ee.ClearButton,{onClick:u=>{u.stopPropagation(),e.clearFilter(e.template.pk,o),e.closeFilter()},"aria-label":`clear-filter-${e.template.name}`})})]})}function _e(e){return a.jsxs(J,{gap:"xs",children:[Object.keys(e.filters).map(r=>a.jsx(y,{props:e,value:e.filters[r]??"",operator:r,readonly:!0})),a.jsx(X,{}),a.jsx(y,{props:e,value:"",operator:"="})]})}function Ce(e){return i.useMemo(()=>e.template.checkbox?a.jsx(pe,{...e}):e.template.choices?a.jsx(Fe,{...e}):a.jsx(_e,{...e}),[e])}function Pe({record:e,template:r,canEdit:n}){const{hovered:b,ref:h}=je(),o=i.useMemo(()=>e.parameters?.find(x=>x.template==r.pk),[e,r]),d=[],u=i.useMemo(()=>{let x=o?.data;return r?.checkbox&&x!=null&&(x=a.jsx(ue,{value:o.data})),x},[o,r]);if(r.units&&o&&o.data_numeric&&o.data_numeric!=o.data){const x=ce(o.data_numeric,{digits:15});d.push(`${x} [${r.units}]`)}return b&&n&&d.push(k._({id:"cwMTjO"})),a.jsx("div",{children:a.jsx(P,{grow:!0,ref:h,justify:"space-between",children:a.jsx(P,{grow:!0,children:a.jsx(oe,{value:u??"-",extra:d,icon:b&&n?"edit":"info",title:r.name})})})})}function ye({modelType:e,endpoint:r,queryParams:n,customFilters:b,customColumns:h}){const o=be(),d=xe(`parametric-data-${e}`),u=te(),x=me(),g=de({queryKey:["parameter-templates",e],queryFn:async()=>o.get(O(C.parameter_template_list),{params:{active:!0,for_model:e,exists_for_model:e}}).then(l=>l.data),refetchOnMount:!0}),[j,v]=i.useState({}),M=i.useCallback((l,t)=>{const s=`parameter_${l}`;if(!t){v(c=>{const m={...c};return Object.keys(m).forEach(f=>{f==s&&delete m[f]}),m});return}v(c=>{const m={...c},f=m[s]||{};return f[t]!==void 0&&delete f[t],{...m,[s]:f}}),d.refreshTable()},[v,d.refreshTable]),N=i.useCallback((l,t,s)=>{const c=`parameter_${l}`,m=t?.toString().trim()??"";m.length>0&&(v(f=>{const R={...f},A=R[c]||{};return A[s]=m,{...R,[c]:A}}),d.refreshTable())},[v,M,d.refreshTable]),V=i.useMemo(()=>{const l={};return Object.keys(j).forEach(t=>{const s=j[t];Object.keys(s).forEach(c=>{const m=`${t}${D[c]||""}`,f=s[c];l[m]=f})}),l},[j]),[p,$]=i.useState(-1),[B,I]=i.useState(null),[K,U]=i.useState(-1),F=he({modelType:e,modelId:p}),_=se({url:C.parameter_list,title:k._({id:"WrK5aa"}),fields:i.useMemo(()=>({...F}),[F]),focus:"data",onFormSuccess:l=>{w(p,l),g.data.find(s=>s.pk==l.template)||g.refetch()},initialData:{part:p,template:B}}),T=ie({url:C.parameter_list,title:k._({id:"FDjidN"}),pk:K,fields:i.useMemo(()=>({...F}),[F]),focus:"data",onFormSuccess:l=>{w(p,l)}}),w=i.useCallback((l,t)=>{const s=d.records,c=s.findIndex(f=>f.pk==l);if(c<0){d.refreshTable();return}const m=s[c].parameters.findIndex(f=>f.pk==t.pk);m<0?s[c].parameters.push(t):s[c].parameters[m]=t,d.updateRecord(s[c])},[d.records,d.updateRecord]),E=i.useMemo(()=>(g?.data||[]).map(t=>{let s=t.name;t.units&&(s+=` [${t.units}]`);const c=j[`parameter_${t.pk}`]||{};return{accessor:`parameter_${t.pk}`,title:s,sortable:!0,extra:{template:t.pk},render:m=>a.jsx(Pe,{record:m,template:t,canEdit:u.hasChangeRole(ae.part)}),filtering:Object.keys(c).length>0,filter:({close:m})=>a.jsx(Ce,{template:t,filters:j[`parameter_${t.pk}`]||{},setFilter:N,clearFilter:M,closeFilter:m})}}),[u,g.data,j]),z=i.useCallback((l,t)=>{I(l),$(t.pk);const s=t.parameters?.find(c=>c.template==l);s?(U(s.pk),T.open()):_.open()},[]),G=i.useMemo(()=>[...b||[]],[b]),W=i.useMemo(()=>[...h||[],...E],[h,E]),Y=i.useCallback(l=>[{title:k._({id:"WrK5aa"}),icon:a.jsx(fe,{}),color:"green",hidden:!u.hasAddPermission(e),onClick:()=>{$(l.pk),I(null),_.open()}}],[e,u]);return a.jsxs(a.Fragment,{children:[_.modal,T.modal,a.jsx(ke,{url:O(r),tableState:d,columns:W,props:{enableDownload:!0,rowActions:Y,tableFilters:G,params:{...n,parameters:!0,...V},modelType:e,onCellClick:({event:l,record:t,index:s,column:c,columnIndex:m})=>{if(re(l),c?.accessor?.toString()?.startsWith("parameter_"))z(c.extra.template,t);else if(t?.pk){const f=le(e,t.pk);ne(f,x,l)}}}})]})}export{Ae as I,ye as P,Oe as S};
//# sourceMappingURL=ParametricDataTable-DArALdrx.js.map
