import{r as c,j as e,$ as B,S as D,ak as f,N as m,d as l,aD as _,b8 as E,g as I,b4 as v,A as b,ab as u,az as N,am as y,bF as w,cF as P,bb as F,ao as g,an as V,b7 as $,ag as M,C as U,b as Y,bd as G}from"./index-Db7AGPIq.js";import{S as W,t as k,ap as H,a as K,v as A}from"./ThemeContext-CxdCkKtz.js";import{t as R,P as O}from"./index-DRtKJP-e.js";import{Y as X}from"./YesNoButton-BaVgP5u9.js";import{u as C}from"./DesktopAppView-BuH2j218.js";import{f as Q}from"./formatters-B4ehJgEk.js";import{g as q}from"./ModelType-DSs66IM7.js";import{f as J,p as Z}from"./Filter-BgnAqEQC.js";import{E as S}from"./GenericErrorPage-D-1fKCA7.js";import ee from"./NotFound-CsJ_VLc_.js";import{P as p}from"./PermissionDenied-BDbEipg4.js";function se(s,a){function i(r){switch(a){case"owner":return[`${r.label}: ${r.name}`,r.name,_(r.owner_model,r.pk,!0),void 0,void 0];case"user":return[`${r.first_name} ${r.last_name}`,r.username,_(F.user,r.pk,!0),r?.image,e.jsxs(e.Fragment,{children:[r.is_superuser&&e.jsx(y,{color:"red",children:u._({id:"agYOFs"})}),r.is_staff&&e.jsx(y,{color:"blue",children:u._({id:"uXsB4R"})}),r.email&&u._({id:"3WlEIN"})+r.email]})];case"group":return[r.name,r.name,_(F.group,r.pk,!0),r?.image,void 0];default:return"dd"}}const t=i(s);return e.jsxs(w.Dropdown,{children:[e.jsxs(m,{children:[e.jsx(P,{src:t[3],radius:"xl"}),e.jsxs(D,{gap:5,children:[e.jsx(l,{size:"sm",fw:700,style:{lineHeight:1},children:t[0]}),e.jsx(b,{href:t[2],c:"dimmed",size:"xs",style:{lineHeight:1},children:t[1]})]})]}),e.jsx(l,{size:"sm",mt:"md",children:t[4]})]})}function z({pk:s,type:a}){const i=C(),{data:t}=A({queryKey:["badge",a,s],queryFn:async()=>{let d="";switch(a){case"owner":d=g.owner_list;break;case"user":d=g.user_list;break;case"group":d=g.group_list;break;default:return{}}const n=V(d,s);return i.get(n).then(h=>{switch(h.status){case 200:return h.data;default:return{}}})}}),r=N(),o=c.useMemo(()=>t?se(t,a):e.jsx(v,{height:12,radius:"md"}),[t]);if(!t||t.isLoading||t.isFetching)return e.jsx(v,{height:12,radius:"md"});function x(){return!t||!t.pk?"":a==="user"&&r.isSet("DISPLAY_FULL_NAMES")?t.first_name||t.last_name?`${t.first_name} ${t.last_name}`:t.username:a==="user"?t.username:t.name}return e.jsxs(m,{wrap:"nowrap",gap:"sm",justify:"right",children:[e.jsx(y,{color:"dark",variant:"filled",style:{display:"flex",alignItems:"center"},children:e.jsxs(w,{width:320,shadow:"md",withArrow:!0,openDelay:200,closeDelay:400,children:[e.jsx(w.Target,{children:e.jsx("p",{children:t?.name??x()})}),o]})}),e.jsx(k,{icon:a==="user"?a:t.label})]})}function te(s){return e.jsx(l,{size:"sm",children:Q(s.field_value?.toString())})}function re(s){const a=s?.field_value,i=Number.parseFloat(a.toString());return a==null?e.jsx(l,{size:"sm",children:"'---'"}):e.jsxs(m,{wrap:"nowrap",gap:"xs",justify:"left",children:[e.jsx(l,{size:"sm",children:J(i)}),!!s.field_data?.unit&&e.jsxs(l,{size:"xs",children:["[",s.field_data?.unit,"]"]})]})}function ae(s){const a=s?.field_value;let i=null;return s.field_data?.badge?e.jsx(z,{pk:a,type:s.field_data.badge}):(s?.field_data?.value_formatter?i=s.field_data.value_formatter():a==null?i=e.jsx(l,{size:"sm",children:"'---'"}):i=e.jsx(l,{size:"sm",children:a.toString()}),e.jsxs(m,{wrap:"nowrap",gap:"xs",justify:"space-apart",children:[e.jsxs(m,{wrap:"nowrap",gap:"xs",justify:"left",children:[i,s.field_data.unit&&e.jsx(l,{size:"xs",children:s.unit})]}),s.field_data.user&&e.jsx(z,{pk:s.field_data?.user,type:"user"})]}))}function ie(s){return e.jsx(X,{value:s.field_value})}function ne(s){const a=C(),i=K(),{data:t}=A({queryKey:["detail",s.field_data.model,s.field_value],queryFn:async()=>{if(!s.field_data?.model)return{};const j=q(s.field_data.model);if(!j?.api_endpoint)return{};const L=V(j.api_endpoint,s.field_value);return a.get(L,{params:s.field_data.model_filters??void 0}).then(T=>{switch(T.status){case 200:return T.data;default:return{}}})}}),r=c.useMemo(()=>s?.field_data?.model&&_(s.field_data.model,s.field_value),[s.field_data.model,s.field_value]),o=c.useCallback(j=>{E(r,i,j)},[r]),x=c.useMemo(()=>`/${I()}${r}`,[r]);if(!t||t.isLoading||t.isFetching)return e.jsx(v,{height:12,radius:"md"});if(s.field_data.external)return e.jsx(b,{href:`${s.field_value}`,target:"_blank",rel:"noreferrer noopener",children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"3px"},children:[e.jsx(l,{children:s.field_value}),e.jsx(k,{icon:"external",iconProps:{size:15}})]})});let d=s.field_data?.link??!0,n;s.field_data.model_formatter?n=s.field_data.model_formatter(t)??n:s.field_data.model_field?n=t?.[s.field_data.model_field]??n:n=t?.name;let h;return n===void 0&&(n=t?.name??s.field_data?.backup_value??u._({id:"ATGKLv"}),d=!1,h="red"),e.jsx(e.Fragment,{children:d?e.jsx(b,{href:x,onClick:o,children:e.jsx(l,{children:n})}):e.jsx(l,{c:h,children:n})})}function le(s){return s.field_data.total<=0?e.jsx(l,{size:"sm",children:s.field_data.progress}):e.jsx(O,{size:"lg",value:s.field_data.progress,maximum:s.field_data.total,progressLabel:!0})}function de(s){return e.jsx(Z,{type:s.field_data.model,status:s.field_value})}function ue({value:s}){return e.jsx(H,{value:s})}function oe({item:s,field:a}){function i(o){switch(o){case"boolean":return ie;case"link":return ne;case"progressbar":return le;case"status":return de;case"date":return te;case"number":return re;case"text":case"string":default:return ae}}const t=i(a.type),r=c.useMemo(()=>R(s,a.name),[s,a.name]);return e.jsxs(f.Tr,{style:{verticalAlign:"top"},children:[e.jsx(f.Td,{style:{minWidth:75,lineBreak:"auto",flex:2},children:e.jsxs(m,{gap:"xs",wrap:"nowrap",children:[e.jsx(k,{icon:a.icon??a.name}),e.jsx(l,{style:{paddingLeft:10},children:a.label})]})}),e.jsx(f.Td,{style:{lineBreak:"anywhere",minWidth:100,flex:10,display:"inline-block"},children:e.jsx(t,{field_data:a,field_value:r})}),e.jsx(f.Td,{style:{width:"50"},children:a.copy&&e.jsx(ue,{value:r})})]})}function Se({item:s,fields:a,title:i}){const t=c.useMemo(()=>a.filter(r=>!r.hidden),[a]);return t?.length?e.jsx(B,{p:"xs",withBorder:!0,style:{overflowX:"hidden",width:"100%",minWidth:200},children:e.jsxs(D,{gap:"xs",children:[i&&e.jsx(W,{size:"lg",children:i}),e.jsx(f,{striped:!0,verticalSpacing:5,horizontalSpacing:"sm",children:e.jsx(f.Tbody,{children:t.map((r,o)=>e.jsx(oe,{field:r,item:s},o))})})]})}):e.jsx("div",{})}function Te(s){return e.jsx(B,{p:"xs",children:e.jsx($,{cols:{base:1,"900px":2},type:"container",spacing:"xs",verticalSpacing:"xs",children:s.children})})}function ce(){return e.jsx(S,{title:u._({id:"vYV5VB"}),message:u._({id:"5a3xiK"})})}function fe({status:s}){switch(s){case 401:return e.jsx(ce,{});case 403:return e.jsx(p,{});case 404:return e.jsx(ee,{})}return e.jsx(S,{title:u._({id:"AOPUbq"}),message:u._({id:"yuzYd9"}),status:s})}function me({status:s}){return e.jsx(S,{title:u._({id:"iSWuCp"}),message:u._({id:"vB3crB"}),status:s})}function Fe({query:s,children:a,requiredRole:i,requiredPermission:t}){const r=M(),[o,x]=c.useState(!1);if(c.useEffect(()=>{s.isSuccess&&x(!0)},[s.isSuccess]),s.isError){const d=s.failureReason,n=d?.response?.status??d?.status??0;return n>=500?e.jsx(me,{status:n}):e.jsx(fe,{status:n})}return i&&!r.hasViewRole(i)?e.jsx(p,{}):t&&!r.hasViewPermission(t)?e.jsx(p,{}):!o||!r.isLoggedIn()?e.jsx(U,{children:e.jsx(Y,{children:e.jsx(G,{})})}):e.jsx(e.Fragment,{children:a})}export{Se as D,Te as I,Fe as a};
//# sourceMappingURL=InstanceDetail-CF-uHhEW.js.map
