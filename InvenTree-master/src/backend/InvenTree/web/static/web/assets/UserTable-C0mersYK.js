import{K as A,ag as R,r as l,bb as g,ab as s,j as e,aD as U,ao as f,b1 as G,an as I,ap as L,d as C,c as j,S as w,as as m,$ as E,N as F,ac as M,aj as Q,aa as ee,O as se,a7 as te,e as X,av as B,bz as N,a as re,aq as ie}from"./index-Db7AGPIq.js";import{c as Y,a as O,d as W,as as Z,m as ae}from"./Filter-BgnAqEQC.js";import{u as $,R as V,a as q,I as K}from"./InvenTreeTable-DmN557zY.js";import{R as le}from"./RoleTable-nBfg8RVD.js";import{a as H,K as oe,S as y,X as ne,r as ce}from"./ThemeContext-CxdCkKtz.js";import{D as J}from"./DetailDrawer-DtwyRZtv.js";import{u as D}from"./UseInstance-BPJQEWDW.js";import{I as de}from"./IconChevronRight-V14UdNcU.js";import{I as ue}from"./IconChevronLeft-6FmaJpTs.js";import{B as T}from"./ColumnRenderers-BUH0stTX.js";import{a as pe,I as he}from"./IconUserCircle-CICiZPp2.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M13 15l-3 -3l3 -3",key:"svg-0"}],["path",{d:"M21 12a9 9 0 1 0 -18 0a9 9 0 0 0 18 0z",key:"svg-1"}]],fe=A("outline","circle-chevron-left","CircleChevronLeft",me);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M11 9l3 3l-3 3",key:"svg-0"}],["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0z",key:"svg-1"}]],xe=A("outline","circle-chevron-right","CircleChevronRight",ge);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M5 11m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 16m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M8 11v-5a4 4 0 0 1 8 0",key:"svg-2"}]],_e=A("outline","lock-open","LockOpen",je);function be({id:a,refreshTable:n}){const{instance:d,refreshInstance:t,instanceQuery:{isFetching:u,error:h}}=D({endpoint:f.group_list,pk:a,params:{permission_detail:!0,role_detail:!0,user_detail:!0}}),p=l.useMemo(()=>d?.roles??[],[d]);return u?e.jsx(L,{visible:!0}):h?e.jsx(C,{children:h?.response?.status===404?e.jsx(j,{id:"yO7e9w",values:{id:a}}):e.jsx(j,{id:"rubZxD"})}):e.jsx(w,{children:e.jsxs(m,{defaultValue:"details",children:[e.jsxs(m.Item,{value:"details",children:[e.jsx(m.Control,{children:e.jsx(y,{size:"lg",children:e.jsx(j,{id:"v7zrSW"})})}),e.jsx(m.Panel,{children:e.jsx(Z,{props:{url:f.group_list,pk:a,fields:{name:{label:s._({id:"6YtxFj"}),description:s._({id:"C9r5Py"})}},onFormSuccess:()=>{n(),t()}},id:`group-detail-drawer-${a}`})})]},"details"),e.jsxs(m.Item,{value:"roles",children:[e.jsx(m.Control,{children:e.jsx(y,{size:"lg",children:e.jsx(j,{id:"bkEWg4"})})}),e.jsx(m.Panel,{children:e.jsx(le,{roles:p,editable:!0})})]},"roles")]})})}function Ue({directLink:a=!1}){const n=$("groups"),d=H(),t=R(),u=l.useCallback(i=>{t.hasChangePermission(g.group)&&d(`group-${i}/`)},[t]),h=l.useMemo(()=>[{accessor:"name",sortable:!0,title:s._({id:"6YtxFj"}),switchable:!1}],[]),p=l.useCallback(i=>[V({onClick:()=>u(i.pk),hidden:!t.hasChangePermission(g.group)}),q({hidden:!t.hasDeletePermission(g.group),onClick:()=>{k(i.pk),_.open()}}),{icon:e.jsx(oe,{}),title:s._({id:"LJXs1e"}),onClick:()=>{d(U(g.group,i.pk))}}],[t]),[x,k]=l.useState(-1),_=Y({url:f.group_list,pk:x,title:s._({id:"k/RLDM"}),successMessage:s._({id:"qYB1E/"}),table:n,preFormWarning:s._({id:"X8Qpil"})}),b=O(ve(n)),v=l.useMemo(()=>{const i=[];return i.push(e.jsx(W,{onClick:()=>b.open(),tooltip:s._({id:"bm8pgG"}),hidden:!t.hasAddPermission(g.group)},"add-group")),i},[t]),c=l.useMemo(()=>!a&&t.isStaff()&&t.hasChangeRole(G.admin),[t,a]);return e.jsxs(e.Fragment,{children:[c&&b.modal,c&&_.modal,c&&e.jsx(J,{size:"xl",title:s._({id:"b433OF"}),renderContent:i=>!i||!i.startsWith("group-")?!1:e.jsx(be,{id:i.replace("group-",""),refreshTable:n.refreshTable})}),e.jsx(K,{url:I(f.group_list),tableState:n,columns:h,props:{rowActions:c?p:void 0,tableActions:c?v:void 0,modelType:a?g.group:void 0,onRowClick:c?i=>u(i.pk):void 0}})]})}function ve(a){return{url:f.group_list,title:s._({id:"ql4GRI"}),fields:{name:{label:s._({id:"6YtxFj"}),description:s._({id:"C9r5Py"})}},table:a??void 0}}function P({items:a,itemSelected:n,itemSwitched:d}){return e.jsx(E,{p:"sm",withBorder:!0,style:{width:"100%",height:"100%",verticalAlign:"top"},children:e.jsxs(w,{gap:"xs",justify:"flex-start",align:"stretch",style:{width:"100%"},children:[a.map(t=>e.jsx(C,{p:2,onClick:()=>n(t),onDoubleClick:()=>d(t),style:{width:"100%",cursor:"pointer",backgroundColor:t.selected?"var(--mantine-primary-color-light)":void 0},children:t.label||t.value},t.value)),a.length==0&&e.jsx(C,{size:"sm",fs:"italic",children:s._({id:"dejGov"})})]})})}function ke({available:a,selected:n,onSave:d}){const[t,u]=l.useState([]),[h,p]=l.useState([]);l.useEffect(()=>{p(n),u(a.filter(i=>!n.some(o=>o.value===i.value)))},[a,n]);const x=l.useCallback(i=>{u(o=>o.map(r=>r.value===i.value?{...r,selected:!r.selected}:r))},[u]),k=l.useCallback(i=>{p(o=>o.map(r=>r.value===i.value?{...r,selected:!r.selected}:r))},[p]),_=l.useMemo(()=>t.some(i=>i.selected),[t]),b=l.useMemo(()=>h.some(i=>i.selected),[h]),v=l.useCallback(i=>{i?(p(o=>o.concat(t)),u([])):(p(o=>o.concat(t.filter(r=>r.selected))),u(o=>o.filter(r=>!r.selected)))},[t,u,p]),c=l.useCallback(i=>{i?(u(o=>o.concat(h)),p([])):(u(o=>o.concat(h.filter(r=>r.selected))),p(o=>o.filter(r=>!r.selected)))},[h,u,p]);return e.jsx(E,{p:"sm",withBorder:!0,style:{width:"100%"},children:e.jsxs(w,{gap:"xs",children:[e.jsxs(F,{justify:"space-between",children:[e.jsx(C,{children:s._({id:"csDS2L"})}),e.jsx(C,{children:s._({id:"ylXj1N"})})]}),e.jsxs(F,{justify:"space-aprt",wrap:"nowrap",align:"flex-start",children:[e.jsx(P,{items:t,itemSwitched:()=>{},itemSelected:x}),e.jsxs(w,{gap:"xs",flex:1,children:[e.jsx(M,{variant:"outline",size:"md",disabled:t.length==0,onClick:()=>v(!0),children:e.jsx(xe,{})}),e.jsx(M,{variant:"outline",size:"md",disabled:!_,onClick:()=>v(!1),children:e.jsx(de,{})}),e.jsx(M,{variant:"outline",size:"md",disabled:!b,onClick:()=>c(!1),children:e.jsx(ue,{})}),e.jsx(M,{variant:"outline",size:"md",disabled:h.length==0,onClick:()=>c(!0),children:e.jsx(fe,{})})]}),e.jsx(P,{items:h,itemSelected:k,itemSwitched:()=>{}})]}),e.jsx(Q,{}),e.jsx(F,{justify:"right",gap:"xs",children:e.jsx(ee,{label:s._({id:"tfDRzk"}),children:e.jsx(se,{color:"green",onClick:()=>{d?.(h)},leftSection:e.jsx(te,{}),children:s._({id:"tfDRzk"})})})})]})})}function Ce({id:a,refreshTable:n}){const{instance:d,refreshInstance:t,instanceQuery:{isFetching:u,error:h}}=D({endpoint:f.user_list,pk:a}),p=R(re(c=>c.user?.pk)),x=l.useMemo(()=>p===Number.parseInt(a,10),[p,a]),k=D({endpoint:f.group_list,hasPrimaryKey:!1,defaultValue:[]}),_=l.useMemo(()=>k.instance?.map(c=>({value:c.pk,label:c.name}))??[],[k.instance]),b=l.useMemo(()=>d?.groups?.map(c=>({value:c.pk,label:c.name}))??[],[d]),v=l.useCallback(c=>{d.pk&&X.patch(I(f.user_list,d.pk),{group_ids:c.map(i=>i.value)}).then(()=>{B({title:s._({id:"PE+EwJ"}),message:s._({id:"Zu70eY"}),color:"green"})}).catch(i=>{N({error:i,title:s._({id:"vpc0Z1"})})}).finally(()=>{t(),n()})},[d]);return u?e.jsx(L,{visible:!0}):h?e.jsx(C,{children:h?.response?.status===404?e.jsx(j,{id:"z0pfhl",values:{id:a}}):e.jsx(j,{id:"h/t9U9"})}):e.jsx(w,{gap:"xs",children:e.jsxs(m,{defaultValue:"details",children:[e.jsxs(m.Item,{value:"details",children:[e.jsx(m.Control,{children:e.jsx(y,{size:"lg",children:e.jsx(j,{id:"anfIXl"})})}),e.jsx(m.Panel,{children:e.jsx(Z,{props:{url:f.user_list,pk:a,fields:{username:{},first_name:{},last_name:{},email:{},is_active:{label:s._({id:"bhnh17"}),description:s._({id:"xYgjoW"}),disabled:x},is_staff:{label:s._({id:"F5kfLm"}),description:s._({id:"paSmTV"}),disabled:x},is_superuser:{label:s._({id:"tIIrDc"}),description:s._({id:"dNitd2"}),disabled:x}},postFormContent:x?e.jsx(ie,{title:e.jsx(j,{id:"CE+M2e"}),color:"blue",icon:e.jsx(ce,{}),children:e.jsx(j,{id:"bDFcjC"})}):void 0,onFormSuccess:()=>{n(),t()}},id:`user-detail-drawer-${a}`})})]},"details"),e.jsxs(m.Item,{value:"groups",children:[e.jsx(m.Control,{children:e.jsx(y,{size:"lg",children:e.jsx(j,{id:"FLoqsu"})})}),e.jsx(m.Panel,{children:e.jsx(ke,{available:_,selected:b,onSave:v})})]},"groups")]})})}function Ge({directLink:a}){const n=$("users"),d=H(),t=R(),u=l.useCallback(r=>{t.hasChangePermission(g.user)&&d(`user-${r}/`)},[t]),h=l.useMemo(()=>[{accessor:"username",sortable:!0,switchable:!1},{accessor:"first_name",sortable:!0},{accessor:"last_name",sortable:!0},{accessor:"email",sortable:!0},{accessor:"groups",title:s._({id:"zhrjek"}),sortable:!0,switchable:!0,render:r=>r.groups.length},T({accessor:"is_staff"}),T({accessor:"is_superuser"}),T({accessor:"is_active"})],[]),[p,x]=l.useState(-1),k=l.useCallback(r=>{const S=t.isStaff()||t.isSuperuser();return[V({onClick:()=>u(r.pk),hidden:!S||!t.hasChangePermission(g.user)}),q({hidden:!S||!t.hasDeletePermission(g.user),onClick:()=>{x(r.pk),_.open()}}),{icon:e.jsx(pe,{}),title:s._({id:"LJXs1e"}),onClick:()=>{d(U(g.user,r.pk))}},{icon:e.jsx(he,{}),title:s._({id:"VhMDMg"}),color:"blue",onClick:()=>{x(r.pk),v.open()},hidden:!t.isSuperuser()},{icon:e.jsx(ne,{}),title:s._({id:"L4MPic"}),color:"blue",onClick:()=>{z(r.pk,!1),n.refreshTable()},hidden:!r.is_active},{icon:e.jsx(_e,{}),title:s._({id:"ym16Ho"}),color:"blue",onClick:()=>{z(r.pk,!0),n.refreshTable()},hidden:r.is_active}]},[t]),_=Y({url:f.user_list,pk:p,title:s._({id:"E33LRn"}),successMessage:s._({id:"Z1AUmg"}),table:n,preFormContent:e.jsx(e.Fragment,{}),preFormWarning:s._({id:"af4xhp"})}),b=O(we(n)),v=ae({url:f.user_set_password,method:"PUT",pk:p,title:s._({id:"2gHjVM"}),fields:{password:{field_type:"password"},override_warning:{}},successMessage:s._({id:"ogtYkT"})}),c=l.useMemo(()=>{const r=[],S=t.isStaff()||t.isSuperuser();return r.push(e.jsx(W,{onClick:b.open,tooltip:s._({id:"UbwSmF"}),hidden:!S||!t.hasAddPermission(g.user)},"add-user")),r},[t]),i=l.useMemo(()=>[{name:"is_active",label:s._({id:"F6pfE9"}),description:s._({id:"Y4Mpdd"})},{name:"is_staff",label:s._({id:"uXsB4R"}),description:s._({id:"wrd7Ba"})},{name:"is_superuser",label:s._({id:"agYOFs"}),description:s._({id:"e1FtjW"})}],[]),o=l.useMemo(()=>!a&&t.isStaff()&&t.hasChangeRole(G.admin),[t,a]);return e.jsxs(e.Fragment,{children:[o&&v.modal,o&&b.modal,o&&_.modal,o&&e.jsx(J,{size:"xl",title:s._({id:"GTOcxw"}),renderContent:r=>!r||!r.startsWith("user-")?!1:e.jsx(Ce,{id:r.replace("user-",""),refreshTable:n.refreshTable})}),e.jsx(K,{url:I(f.user_list),tableState:n,columns:h,props:{rowActions:o?k:void 0,tableActions:o?c:void 0,tableFilters:i,onRowClick:o?r=>u(r.pk):void 0,modelType:a?g.user:void 0}})]})}function we(a){return{url:f.user_list,title:s._({id:"Ls08BH"}),fields:{username:{},email:{},first_name:{},last_name:{}},table:a??void 0,successMessage:s._({id:"e7XEqK"})}}async function z(a,n){try{await X.patch(I(f.user_list,a),{is_active:n}),B({title:s._({id:"0XGXZb"}),message:s._({id:"XbZkSg"}),color:"green"})}catch(d){N({error:d,title:s._({id:"6s03dZ"})})}}export{Ue as G,Ge as U,ve as g,we as u};
//# sourceMappingURL=UserTable-C0mersYK.js.map
