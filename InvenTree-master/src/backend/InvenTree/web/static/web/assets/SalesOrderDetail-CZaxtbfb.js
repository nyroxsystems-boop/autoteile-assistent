import{ag as oe,r as l,ab as t,j as s,N as _e,d as f,ao as c,bb as o,b1 as m,an as E,$ as he,az as be,b4 as X,by as J,as as j,S as xe}from"./index-Db7AGPIq.js";import{A as fe}from"./AdminButton-BR7cWvGK.js";import{P as Z}from"./PrimaryActionButton-CsYjCYWq.js";import{u as ke,R as ye,d as Se,a as je,c as ge,I as Ie,B as Ce,P as Re,O as Ae,E as Ee,b as Pe,H as Oe,C as De}from"./InvenTreeTable-DmN557zY.js";import{I as Fe,D as G,a as we}from"./InstanceDetail-CF-uHhEW.js";import{D as Me,A as Te,N as Le}from"./NotesPanel-BpiQDImp.js";import{a as ve,F as ee,al as Ne,a2 as le,E as qe,r as Be,S as te,Y as Ge,ak as We}from"./ThemeContext-CxdCkKtz.js";import{P as ze}from"./PageDetail-Bm50kpyR.js";import{P as He}from"./PanelGroup-Bif3iIGQ.js";import{P as Ue}from"./ParametersPanel-CrcKbDM0.js";import{f as Y,T as Ke,a as x,b as ne,c as Ve,d as Ze,g as Ye,a8 as Qe,p as $e}from"./Filter-BgnAqEQC.js";import{b as Q}from"./formatters-B4ehJgEk.js";import{a as se,b as Xe,c as Je,u as ae}from"./SalesOrderForms-DoG2xqUe.js";import{u as et}from"./UseInstance-BPJQEWDW.js";import{u as tt}from"./ImporterForms-D2fp0CPO.js";import{B as st}from"./BuildOrderTable-DbWov0Ph.js";import{I as at,E as rt}from"./ExtraLineItemTable-DMf1CJ9x.js";import{S as de}from"./SalesOrderAllocationTable-siytHB8m.js";import{A as re}from"./ActionButton-Cv5j5I5R.js";import{P as ie}from"./index-DRtKJP-e.js";import{O as it}from"./OrderPartsWizard-BcMgRjfh.js";import{d as ot}from"./BuildForms-BotNgtQh.js";import{D as lt,b as nt,c as dt,a as ct,L as mt,g as pt}from"./ColumnRenderers-BUH0stTX.js";import{R as ut}from"./RowExpansionIcon-DC7o6kBm.js";import{b as _t}from"./IconChevronDown-CzbIU38Y.js";import{S as ht}from"./SalesOrderShipmentTable-B57Wq2FS.js";import{I as bt}from"./IconBookmark-1j99fCof.js";import"./DesktopAppView-BuH2j218.js";import"./QRCode-BaIEIQ2d.js";import"./browser-DSycY7kT.js";import"./IconDotsVertical-D8D3XsjG.js";import"./IconTags-DnGx22aA.js";import"./YesNoButton-BaVgP5u9.js";import"./ModelType-DSs66IM7.js";import"./GenericErrorPage-D-1fKCA7.js";import"./NotFound-CsJ_VLc_.js";import"./PermissionDenied-BDbEipg4.js";import"./use-hover-Cq0v4QX_.js";import"./index-Chjiymov.js";import"./AttachmentLink-D_UWVUZG.js";import"./PageTitle-B4iaHXKM.js";import"./PluginUIFeature-DCu8wTdG.js";import"./RemoteComponent-uZoHDwds.js";import"./ParameterTable-CGnscd1r.js";import"./CommonForms-DKQecQmS.js";import"./IconUsers-Dr_Sln9A.js";import"./IconAddressBook-CdNRMeyy.js";import"./IconCircleDashedCheck-DnGBn8Eq.js";import"./UseStockAdjustActions-BrgagWbF.js";import"./CompanyForms-CIJgkbDe.js";import"./IconAt-rYwKGkPn.js";import"./IconChevronRight-V14UdNcU.js";function xt({orderId:p,orderDetailRefresh:h,currency:b,customerId:e,editable:u}){const _=ve(),i=oe(),r=ke("sales-order-line-item"),n=l.useMemo(()=>[{accessor:"part",sortable:!0,switchable:!1,minWidth:175,render:a=>s.jsxs(_e,{wrap:"nowrap",children:[a.part_detail?.virtual||s.jsx(ut,{enabled:a.allocated,expanded:r.isRowExpanded(a.pk)}),s.jsx(pt,{part:a.part_detail})]})},{accessor:"part_detail.IPN",title:t._({id:"3wXEsN"}),switchable:!0},lt({accessor:"part_detail.description"}),{accessor:"reference",sortable:!1,switchable:!0},nt({}),dt({accessor:"quantity",sortable:!0}),{accessor:"sale_price",render:a=>Q(a.sale_price,{currency:a.sale_price_currency})},{accessor:"total_price",title:t._({id:"KyZVKD"}),render:a=>Q(a.sale_price,{currency:a.sale_price_currency,multiplier:a.quantity})},ct({accessor:"target_date",sortable:!0,title:t._({id:"ZmykKo"})}),{accessor:"stock",title:t._({id:"oGd3rK"}),render:a=>{if(a.part_detail?.virtual)return s.jsx(f,{size:"sm",fs:"italic",children:t._({id:"A2gkIb"})});const A=a?.available_stock??0,S=a?.available_variant_stock??0,K=A+S,ue=Math.max(a.quantity-a.allocated-a.shipped,0);let V,$=`${Y(K)}`;const B=[];return K<=0?(V="red",$=t._({id:"a5n/wL"})):K<ue&&(V="orange"),S>0&&B.push(s.jsx(f,{size:"sm",children:t._({id:"LdvJ9e"})})),a.building>0&&B.push(s.jsxs(f,{size:"sm",children:[t._({id:"G1xXyB"}),": ",Y(a.building)]})),a.on_order>0&&B.push(s.jsxs(f,{size:"sm",children:[t._({id:"/MB+gl"}),": ",Y(a.on_order)]})),s.jsx(Ke,{value:s.jsx(f,{c:V,children:$}),extra:B,title:t._({id:"odasNw"})})}},{accessor:"allocated",sortable:!0,render:a=>a.part_detail?.virtual?s.jsx(f,{size:"sm",fs:"italic",children:t._({id:"A2gkIb"})}):s.jsx(ie,{progressLabel:!0,value:a.allocated,maximum:a.quantity})},{accessor:"shipped",sortable:!0,render:a=>a.part_detail?.virtual?s.jsx(f,{size:"sm",fs:"italic",children:t._({id:"A2gkIb"})}):s.jsx(ie,{progressLabel:!0,value:a.shipped,maximum:a.quantity})},{accessor:"notes"},mt({accessor:"link"})],[r.isRowExpanded]),[g,P]=l.useState(0),[I,W]=l.useState(null),[O,k]=l.useState({}),z=se({orderId:p,customerId:e,create:!0,currency:b}),C=x({url:c.sales_order_line_list,title:t._({id:"pwb7Yo"}),fields:z,initialData:{...O,sale_price_currency:b},onFormSuccess:h,table:r}),L=se({orderId:p,customerId:e,create:!1}),D=ne({url:c.sales_order_line_list,pk:g,title:t._({id:"vgosWS"}),fields:L,onFormSuccess:h,table:r}),F=Ve({url:c.sales_order_line_list,pk:g,title:t._({id:"tpKh8C"}),onFormSuccess:h,table:r}),v=Xe({itemId:g,orderId:p}),N=x({url:c.sales_order_allocate_serials,pk:p,title:t._({id:"AZE5KS"}),preFormContent:I?s.jsx(he,{withBorder:!0,p:"sm",children:s.jsx(Ye,{instance:I})}):void 0,initialData:O,fields:v,table:r}),H=ot({create:!0,modalId:"build-order-create-from-sales-order"}),q=x({url:c.build_order_list,title:t._({id:"UcPKar"}),modalId:"build-order-create-from-sales-order",fields:H,initialData:O,follow:!0,modelType:o.build}),[d,R]=l.useState([]),y=Je({orderId:p,lineItems:d.filter(a=>a.part_detail?.virtual!==!0),onFormSuccess:()=>{r.refreshTable(),r.clearSelectedRecords()}}),[w,M]=l.useState([]),T=it({parts:w}),U=l.useMemo(()=>[{name:"allocated",label:t._({id:"A/ybx7"}),description:t._({id:"Rk+ZGQ"})},{name:"completed",label:t._({id:"qqWcBV"}),description:t._({id:"x7Nm8D"})}],[]),ce=l.useMemo(()=>[s.jsx(Ze,{tooltip:t._({id:"pwb7Yo"}),onClick:()=>{k({order:p}),C.open()},hidden:!u||!i.hasAddRole(m.sales_order)},"add-line-item"),s.jsx(re,{hidden:!i.hasAddRole(m.purchase_order),disabled:!r.hasSelectedRecords,tooltip:t._({id:"3u5ICq"}),icon:s.jsx(ee,{}),color:"blue",onClick:()=>{M(r.selectedRecords.map(a=>a.part_detail)),T.openWizard()}},"order-parts"),s.jsx(re,{tooltip:t._({id:"L1LMmH"}),icon:s.jsx(_t,{}),disabled:!r.hasSelectedRecords,color:"green",onClick:()=>{R(r.selectedRecords.filter(a=>a.allocated<a.quantity)),y.open()}},"allocate-stock")],[i,p,r.hasSelectedRecords,r.selectedRecords]),me=l.useCallback(a=>{const A=(a?.allocated??0)>(a?.quantity??0),S=a?.part_detail?.virtual??!1;return[{hidden:A||S||!u||!i.hasChangeRole(m.sales_order),title:t._({id:"L1LMmH"}),icon:s.jsx(at,{}),color:"green",onClick:()=>{R([a]),y.open()}},{hidden:!a?.part_detail?.trackable||A||S||!u||!i.hasChangeRole(m.sales_order),title:t._({id:"EIkxpC"}),icon:s.jsx(Ne,{}),color:"green",onClick:()=>{P(a.pk),W(a?.part_detail??null),k({quantity:a.quantity-a.allocated}),N.open()}},{hidden:A||S||!i.hasAddRole(m.build)||!a?.part_detail?.assembly,title:t._({id:"NH34YB"}),icon:s.jsx(le,{}),color:"blue",onClick:()=>{k({part:a.part,quantity:(a?.quantity??1)-(a?.allocated??0),sales_order:p}),q.open()}},{hidden:A||S||!i.hasAddRole(m.purchase_order)||!a?.part_detail?.purchaseable,title:t._({id:"G4SnGh"}),icon:s.jsx(ee,{}),color:"blue",onClick:()=>{M([a.part_detail]),T.openWizard()}},ye({hidden:!u||!i.hasChangeRole(m.sales_order),onClick:()=>{P(a.pk),D.open()}}),Se({hidden:!u||!i.hasAddRole(m.sales_order),onClick:()=>{k(a),C.open()}}),je({hidden:!u||!i.hasDeleteRole(m.sales_order),onClick:()=>{P(a.pk),F.open()}}),ge({title:t._({id:"4BxQBj"}),modelType:o.part,modelId:a.part,navigate:_,hidden:!i.hasViewRole(m.part)})]},[_,i,u]),pe=l.useMemo(()=>({allowMultiple:!0,expandable:({record:a})=>a?.part_detail?.virtual?!1:r.isRowExpanded(a.pk)||a.allocated>0,content:({record:a})=>s.jsx(de,{showOrderInfo:!1,showPartInfo:!1,orderId:p,lineItemId:a.pk,partId:a.part,allowEdit:!0,modelTarget:o.stockitem,modelField:"item",isSubTable:!0})}),[p,r.isRowExpanded]);return s.jsxs(s.Fragment,{children:[D.modal,F.modal,C.modal,q.modal,N.modal,y.modal,T.wizard,s.jsx(Ie,{url:E(c.sales_order_line_list),tableState:r,columns:n,props:{enableSelection:!0,enableDownload:!0,params:{order:p,part_detail:!0},rowActions:me,tableActions:ce,tableFilters:U,rowExpansion:pe}})]})}function bs(){const{id:p}=qe(),h=oe(),b=be(),{instance:e,instanceQuery:u,refreshInstance:_}=et({endpoint:c.sales_order_list,pk:p,params:{customer_detail:!0}}),i=l.useMemo(()=>e.order_currency||e.customer_detail?.currency||b.getSetting("INVENTREE_DEFAULT_CURRENCY"),[e,b]),r=l.useMemo(()=>{if(u.isFetching)return s.jsx(X,{});const d=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:t._({id:"ZVUe1A"}),copy:!0,icon:"reference",hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:t._({id:"876pfE"}),model:o.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:o.salesorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:o.salesorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],R=[{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines,hidden:!e.line_items},{type:"progressbar",name:"shipments",icon:"shipment",label:t._({id:"polrQd"}),total:e.shipments_count,progress:e.completed_shipments_count,hidden:!e.shipments_count},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>i},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>Q(e?.total_price,{currency:i})}],y=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"address",label:t._({id:"g6yaYE"}),icon:"address",value_formatter:()=>e.address_detail?s.jsx(Qe,{instance:e.address_detail}):s.jsx(f,{size:"sm",c:"red",children:t._({id:"dm2vYF"})})},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!e.contact_detail?.email},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!e.contact_detail?.phone},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],w=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),copy:!0,hidden:!e.creation_date},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",hidden:!e.start_date,copy:!0},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),hidden:!e.target_date,copy:!0},{type:"date",name:"shipment_date",label:t._({id:"41ha49"}),hidden:!e.shipment_date,copy:!0}];return s.jsxs(Fe,{children:[s.jsxs(J,{grow:!0,children:[s.jsx(Me,{appRole:m.purchase_order,apiPath:c.company_list,src:e.customer_detail?.image,pk:e.customer}),s.jsx(J.Col,{span:{base:12,sm:8},children:s.jsx(G,{fields:d,item:e})})]}),s.jsx(G,{fields:R,item:e}),s.jsx(G,{fields:y,item:e}),s.jsx(G,{fields:w,item:e})]})},[e,i,u]),n=tt({modelType:o.salesorder}),g=l.useMemo(()=>e.status!=n.COMPLETE&&e.status!=n.CANCELLED?!0:b.isSet("SALESORDER_EDIT_COMPLETED_ORDERS"),[b,e.status,n]),P=ae({}),I=ne({url:c.sales_order_list,pk:e.pk,title:t._({id:"nEK4wx"}),fields:P,onFormSuccess:()=>{_()}}),W=ae({duplicateOrderId:e.pk}),O=l.useMemo(()=>{const d={...e};return delete d.reference,d},[e]),k=x({url:c.sales_order_list,title:t._({id:"VzdnWM"}),fields:W,initialData:O,follow:!0,modelType:o.salesorder}),z=l.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:s.jsx(Be,{}),content:r},{name:"line-items",label:t._({id:"SgduFH"}),icon:s.jsx(Ge,{}),content:s.jsxs(j,{multiple:!0,defaultValue:["line-items","extra-items"],children:[s.jsxs(j.Item,{value:"line-items",children:[s.jsx(j.Control,{children:s.jsx(te,{size:"lg",children:t._({id:"SgduFH"})})}),s.jsx(j.Panel,{children:s.jsx(xt,{orderId:e.pk,orderDetailRefresh:_,currency:i,customerId:e.customer,editable:g})})]},"lineitems"),s.jsxs(j.Item,{value:"extra-items",children:[s.jsx(j.Control,{children:s.jsx(te,{size:"lg",children:t._({id:"l11DG/"})})}),s.jsx(j.Panel,{children:s.jsx(rt,{endpoint:c.sales_order_extra_line_list,orderId:e.pk,editable:g,orderDetailRefresh:_,currency:i,role:m.sales_order})})]},"extraitems")]})},{name:"shipments",label:t._({id:"aljM0q"}),icon:s.jsx(We,{}),content:s.jsx(ht,{orderId:e.pk,customerId:e.customer})},{name:"allocations",label:t._({id:"MD2yP5"}),icon:s.jsx(bt,{}),content:s.jsx(de,{orderId:e.pk,showPartInfo:!0,allowEdit:!0,modelField:"item",modelTarget:o.stockitem})},{name:"build-orders",label:t._({id:"RCVhIP"}),icon:s.jsx(le,{}),hidden:!h.hasViewRole(m.build),content:e?.pk?s.jsx(st,{salesOrderId:e.pk}):s.jsx(X,{})},Ue({model_type:o.salesorder,model_id:e.pk}),Te({model_type:o.salesorder,model_id:e.pk}),Le({model_type:o.salesorder,model_id:e.pk})],[e,p,h,n,h]),C=x({url:E(c.sales_order_issue,e.pk),title:t._({id:"Zk75Wf"}),onFormSuccess:_,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),L=x({url:E(c.sales_order_cancel,e.pk),title:t._({id:"GYdhXE"}),onFormSuccess:_,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),D=x({url:E(c.sales_order_hold,e.pk),title:t._({id:"Pgi6wT"}),onFormSuccess:_,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),F=x({url:E(c.sales_order_complete,e.pk),title:t._({id:"tMUAZW"}),onFormSuccess:_,preFormWarning:t._({id:"huukBM"}),successMessage:t._({id:"NloAZ8"}),fields:{accept_incomplete:{}}}),v=x({url:E(c.sales_order_complete,e.pk),title:t._({id:"O1h5Uc"}),onFormSuccess:_,preFormWarning:t._({id:"DYITap"}),successMessage:t._({id:"W7TghJ"}),fields:{accept_incomplete:{}}}),N=l.useMemo(()=>{const d=h.hasChangeRole(m.sales_order),R=d&&(e.status==n.PENDING||e.status==n.ON_HOLD),y=d&&(e.status==n.PENDING||e.status==n.ON_HOLD||e.status==n.IN_PROGRESS),w=d&&(e.status==n.PENDING||e.status==n.IN_PROGRESS),M=b.isSet("SALESORDER_SHIP_COMPLETE"),T=!M&&d&&e.status==n.IN_PROGRESS,U=d&&(e.status==n.SHIPPED||M&&e.status==n.IN_PROGRESS);return[s.jsx(Z,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!R,color:"blue",onClick:C.open}),s.jsx(Z,{title:t._({id:"7I7mfp"}),icon:"deliver",hidden:!T,color:"blue",onClick:F.open}),s.jsx(Z,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!U,color:"green",onClick:v.open}),s.jsx(fe,{model:o.salesorder,id:e.pk}),s.jsx(Ce,{model:o.salesorder,pk:e.pk,hash:e?.barcode_hash}),s.jsx(Re,{modelType:o.salesorder,items:[e.pk],enableReports:!0,enableLabels:!0}),s.jsx(Ae,{tooltip:t._({id:"/IKytX"}),actions:[Ee({hidden:!d,onClick:I.open,tooltip:t._({id:"mVeaUg"})}),Pe({hidden:!h.hasAddRole(m.sales_order),onClick:k.open,tooltip:t._({id:"oi/3Pq"})}),Oe({tooltip:t._({id:"20mLBC"}),hidden:!w,onClick:D.open}),De({tooltip:t._({id:"tVJk4q"}),hidden:!y,onClick:L.open})]})]},[h,e,n,b]),H=l.useMemo(()=>u.isLoading?[]:[s.jsx($e,{status:e.status_custom_key,type:o.salesorder,options:{size:"lg"}},e.pk)],[e,u]),q=l.useMemo(()=>{let d=e.customer_detail?.name||"";return e.customer_reference&&(d+=` (${e.customer_reference})`),d},[e]);return s.jsxs(s.Fragment,{children:[C.modal,L.modal,D.modal,F.modal,v.modal,I.modal,k.modal,s.jsx(we,{query:u,requiredRole:m.sales_order,children:s.jsxs(xe,{gap:"xs",children:[s.jsx(ze,{title:`${t._({id:"LozYBo"})}: ${e.reference}`,subtitle:q,imageUrl:e.customer_detail?.image,badges:H,actions:N,breadcrumbs:[{name:t._({id:"mUv9U4"}),url:"/sales/"}],lastCrumb:[{name:e.reference,url:`/sales/sales-order/${e.pk}`}],editAction:I.open,editEnabled:h.hasChangePermission(o.salesorder)}),s.jsx(He,{pageKey:"salesorder",panels:z,model:o.salesorder,reloadInstance:_,instance:e,id:e.pk})]})})]})}export{bs as default};
//# sourceMappingURL=SalesOrderDetail-CZaxtbfb.js.map
