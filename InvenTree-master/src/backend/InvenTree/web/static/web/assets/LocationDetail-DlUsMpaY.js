import{ag as w,r as n,ab as e,bb as i,an as y,ao as c,j as t,N,b1 as m,b4 as U,d as W,aD as L,S as z,e as E}from"./index-Db7AGPIq.js";import{t as A,E as G,a as J,r as K,U as X,G as M,a6 as v}from"./ThemeContext-CxdCkKtz.js";import{A as Y}from"./AdminButton-BR7cWvGK.js";import{u as Z,A as H,R as $,I as ee,B as oe,P as te,O as ae,E as se,D as ie}from"./InvenTreeTable-DmN557zY.js";import{I as ne,D as F,a as ce}from"./InstanceDetail-CF-uHhEW.js";import{A as g,a as le,b as O,e as re,d as de,c as pe}from"./Filter-BgnAqEQC.js";import{N as me}from"./NavigationTree-D8kcQU6q.js";import{P as ue}from"./PageDetail-Bm50kpyR.js";import{P as _e}from"./PanelGroup-Bif3iIGQ.js";import{L as ke}from"./LocateItemButton-CGQeChN6.js";import{s as P}from"./PluginUIFeature-DCu8wTdG.js";import{u as be}from"./UseInstance-BPJQEWDW.js";import{u as he}from"./UseStockAdjustActions-BrgagWbF.js";import{P as fe}from"./PartTable-Bj-hT2fm.js";import{S as xe}from"./StockItemTable-CHHhSxX_.js";import{D as je,B}from"./ColumnRenderers-BUH0stTX.js";import"./ActionButton-Cv5j5I5R.js";import"./DesktopAppView-BuH2j218.js";import"./IconChevronDown-CzbIU38Y.js";import"./index-DRtKJP-e.js";import"./QRCode-BaIEIQ2d.js";import"./browser-DSycY7kT.js";import"./IconDotsVertical-D8D3XsjG.js";import"./IconTags-DnGx22aA.js";import"./YesNoButton-BaVgP5u9.js";import"./formatters-B4ehJgEk.js";import"./ModelType-DSs66IM7.js";import"./GenericErrorPage-D-1fKCA7.js";import"./NotFound-CsJ_VLc_.js";import"./PermissionDenied-BDbEipg4.js";import"./IconChevronRight-V14UdNcU.js";import"./PageTitle-B4iaHXKM.js";import"./RemoteComponent-uZoHDwds.js";import"./UsePlugins-BAQCKs7Q.js";import"./ImporterForms-D2fp0CPO.js";import"./IconCircleDashedCheck-DnGBn8Eq.js";import"./ImportPartWizard-DE8Rg4Ga.js";import"./OrderPartsWizard-BcMgRjfh.js";import"./CompanyForms-CIJgkbDe.js";import"./IconAt-rYwKGkPn.js";import"./IconUsers-Dr_Sln9A.js";import"./IconAddressBook-CdNRMeyy.js";function ge({parentId:d}){const a=Z("stocklocation"),r=w(),p=n.useMemo(()=>[{name:"cascade",label:e._({id:"VY386J"}),description:e._({id:"Ue7Vtx"})},{name:"structural",label:e._({id:"PRKZBP"}),description:e._({id:"zW8WBT"})},{name:"external",label:e._({id:"bVhrVt"}),description:e._({id:"ckSQBM"})},{name:"has_location_type",label:e._({id:"Sgyhpp"})},{name:"location_type",label:e._({id:"4sg5Qp"}),description:e._({id:"buIdz6"}),apiUrl:y(c.stock_location_type_list),model:i.stocklocationtype,modelRenderer:s=>s.name}],[]),S=n.useMemo(()=>[{accessor:"name",switchable:!1,render:s=>t.jsxs(N,{gap:"xs",children:[s.icon&&t.jsx(g,{name:s.icon}),s.name]})},je({}),{accessor:"pathstring",sortable:!0},{accessor:"items",sortable:!0},B({accessor:"structural",defaultVisible:!1}),B({accessor:"external",defaultVisible:!1}),{accessor:"location_type",sortable:!1,render:s=>s.location_type_detail?.name}],[]),k=le({url:c.stock_location_list,title:e._({id:"sklcDg"}),fields:P(),focus:"name",initialData:{parent:d},follow:!0,modelType:i.stocklocation,table:a}),[o,b]=n.useState(-1),u=O({url:c.stock_location_list,pk:o,title:e._({id:"Qdjbg8"}),fields:P(),onFormSuccess:s=>a.updateRecord(s)}),x=re({url:c.stock_location_list,items:a.selectedIds,title:e._({id:"vqGtWs"}),fields:{parent:{}},onFormSuccess:a.refreshTable}),I=n.useMemo(()=>{const s=r.hasAddRole(m.stock_location),_=r.hasChangeRole(m.stock_location);return[t.jsx(H,{tooltip:e._({id:"Ego4rz"}),icon:t.jsx(A,{icon:"location"}),disabled:!a.hasSelectedRecords,actions:[{name:e._({id:"OORNPU"}),icon:t.jsx(A,{icon:"location"}),tooltip:e._({id:"dIzYVe"}),hidden:!_,disabled:!a.hasSelectedRecords,onClick:()=>{x.open()}}]}),t.jsx(de,{tooltip:e._({id:"sklcDg"}),onClick:()=>k.open(),hidden:!s},"add-stock-location")]},[r,a.hasSelectedRecords]),h=n.useCallback(s=>{const _=r.hasChangeRole(m.stock_location);return[$({hidden:!_,onClick:()=>{b(s.pk),u.open()}})]},[r]);return t.jsxs(t.Fragment,{children:[k.modal,u.modal,x.modal,t.jsx(ee,{url:y(c.stock_location_list),tableState:a,columns:S,props:{enableSelection:!0,enableDownload:!0,enableLabels:!0,enableReports:!0,params:{parent:d,top_level:d===void 0?!0:void 0},tableFilters:p,tableActions:I,rowActions:h,modelType:i.stocklocation}})]})}function po(){const{id:d}=G(),a=n.useMemo(()=>Number.isNaN(Number.parseInt(d||""))?void 0:d,[d]),r=J(),p=w(),[S,k]=n.useState(!1),{instance:o,refreshInstance:b,instanceQuery:u}=be({endpoint:c.stock_location_list,hasPrimaryKey:!0,pk:a,params:{path_detail:!0}}),x=n.useMemo(()=>{if(a&&u.isFetching)return t.jsx(U,{});const l=[{type:"text",name:"name",label:e._({id:"6YtxFj"}),copy:!0,value_formatter:()=>t.jsxs(N,{gap:"xs",children:[o.icon&&t.jsx(g,{name:o.icon}),o.name]})},{type:"text",name:"pathstring",label:e._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!a},{type:"text",name:"description",label:e._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:e._({id:"+o9hiJ"}),model:i.stocklocation,hidden:!o?.parent}],f=[{type:"text",name:"items",icon:"stock",label:e._({id:"Jbck4N"}),value_formatter:()=>o?.items||"0"},{type:"text",name:"sublocations",icon:"location",label:e._({id:"L7/8CO"}),hidden:!o?.sublocations},{type:"boolean",name:"structural",label:e._({id:"PRKZBP"}),icon:"sitemap"},{type:"boolean",name:"external",label:e._({id:"bVhrVt"})},{type:"string",name:"location_type_detail.name",label:e._({id:"4sg5Qp"}),hidden:!o?.location_type,icon:"packages"}];return t.jsxs(ne,{children:[a&&o?.pk?t.jsx(F,{item:o,fields:l}):t.jsx(W,{children:e._({id:"js9HzF"})}),a&&o?.pk&&t.jsx(F,{item:o,fields:f})]})},[o,u]),I=n.useMemo(()=>[{name:"details",label:e._({id:"AC8C/Z"}),icon:t.jsx(K,{}),content:x},{name:"sublocations",label:a?e._({id:"L7/8CO"}):e._({id:"1eBWAw"}),icon:t.jsx(X,{}),content:t.jsx(ge,{parentId:a})},{name:"stock-items",label:e._({id:"Jbck4N"}),icon:t.jsx(M,{}),content:t.jsx(xe,{tableName:"location-stock",allowAdd:!0,params:{location:a}})},{name:"default_parts",label:e._({id:"D19W4x"}),icon:t.jsx(M,{}),hidden:!o.pk,content:t.jsx(fe,{props:{params:{default_location:o.pk}}})}],[o,a]),h=O({url:c.stock_location_list,pk:a,title:e._({id:"Qdjbg8"}),fields:P(),onFormSuccess:b}),s=n.useMemo(()=>[{value:"false",display_name:e._({id:"+oqXDN"})},{value:"true",display_name:e._({id:"lzGbCT"})}],[]),_=pe({url:c.stock_location_list,pk:a,title:e._({id:"lnETLa"}),fields:{delete_stock_items:{label:e._({id:"j3pJx8"}),required:!0,description:e._({id:"Ml7+Iv"}),field_type:"choice",choices:s},delete_sub_locations:{label:e._({id:"+Ak9BJ"}),required:!0,description:e._({id:"CEDjmR"}),field_type:"choice",choices:s}},onFormSuccess:()=>{o.parent?r(L(i.stocklocation,o.parent)):r("/stock/")}}),V=n.useMemo(()=>({pk:o.pk,model:"location",refresh:b,filters:{in_stock:!0}}),[o]),C=he({formProps:V,enabled:!0,delete:!1,merge:!1,assign:!1}),T=v({title:e._({id:"XaNm5l"}),modelType:i.stockitem,callback:async(l,f)=>{const j=f.stockitem.instance;return E.post(y(c.stock_transfer),{location:o.pk,items:[{pk:j.pk,quantity:j.quantity}]}).then(()=>({success:e._({id:"vdb1YW"})})).catch(D=>(console.error("Error scanning stock item:",D),{error:e._({id:"TL3ZFM"})}))}}),R=v({title:e._({id:"ohwQub"}),modelType:i.stocklocation,callback:async(l,f)=>{const j=f.stocklocation.pk;return E.patch(y(c.stock_location_list,j),{parent:o.pk}).then(()=>({success:e._({id:"1OrE7V"})})).catch(D=>(console.error("Error scanning stock location:",D),{error:e._({id:"nFD3+9"})}))}}),q=n.useMemo(()=>[t.jsx(Y,{model:i.stocklocation,id:o.pk}),t.jsx(ke,{locationId:o.pk}),o.pk?t.jsx(oe,{model:i.stocklocation,pk:o.pk,hash:o?.barcode_hash,perm:p.hasChangeRole(m.stock_location),actions:[{name:"Scan in stock items",icon:t.jsx(A,{icon:"stock"}),tooltip:"Scan item into this location",onClick:T.open},{name:"Scan in container",icon:t.jsx(A,{icon:"unallocated_stock"}),tooltip:"Scan container into this location",onClick:R.open}]}):null,t.jsx(te,{modelType:i.stocklocation,items:[o.pk??0],hidden:!o?.pk,enableLabels:!0,enableReports:!0}),C.dropdown,t.jsx(ae,{tooltip:e._({id:"Ego4rz"}),actions:[se({hidden:!a||!p.hasChangeRole(m.stock_location),tooltip:e._({id:"Qdjbg8"}),onClick:()=>h.open()}),ie({hidden:!a||!p.hasDeleteRole(m.stock_location),tooltip:e._({id:"lnETLa"}),onClick:()=>_.open()})]})],[o,a,p,C.dropdown]),Q=n.useMemo(()=>[{name:e._({id:"blbbPS"}),url:"/stock"},...(o.path??[]).map(l=>({name:l.name,url:L(i.stocklocation,l.pk),icon:l.icon?t.jsx(g,{name:l.icon}):void 0}))],[o]);return t.jsxs(t.Fragment,{children:[h.modal,_.modal,T.dialog,R.dialog,t.jsxs(ce,{query:u,requiredRole:m.stock_location,children:[t.jsxs(z,{children:[t.jsx(me,{title:e._({id:"1eBWAw"}),modelType:i.stocklocation,endpoint:c.stock_location_tree,opened:S,onClose:()=>k(!1),selectedId:o?.pk}),t.jsx(ue,{title:o?.name??a?e._({id:"adXdas"}):e._({id:"blbbPS"}),subtitle:o?.description,icon:o?.icon&&t.jsx(g,{name:o?.icon}),actions:q,editAction:h.open,editEnabled:!!o?.pk&&p.hasChangePermission(i.stocklocation),breadcrumbs:Q,lastCrumb:[{name:o.name,url:`/stock/location/${o.pk}/`}],breadcrumbAction:()=>{k(!0)}}),t.jsx(_e,{pageKey:"stocklocation",panels:I,model:i.stocklocation,reloadInstance:b,id:o?.pk,instance:o})]}),C.modals.map(l=>l.modal)]})]})}export{po as default};
//# sourceMappingURL=LocationDetail-DlUsMpaY.js.map
