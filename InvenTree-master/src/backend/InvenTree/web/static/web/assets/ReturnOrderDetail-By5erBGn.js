import{ag as Q,bb as n,r as i,ab as t,ao as l,j as r,b1 as c,an as k,az as $,b4 as J,d as X,by as q,as as y,S as ee}from"./index-Db7AGPIq.js";import{A as te}from"./AdminButton-BR7cWvGK.js";import{P as G}from"./PrimaryActionButton-CsYjCYWq.js";import{u as re,R as se,a as oe,I as ne,B as ie,P as ae,O as le,E as de,b as ce,H as ue,C as me}from"./InvenTreeTable-DmN557zY.js";import{I as pe,D as O,a as _e}from"./InstanceDetail-CF-uHhEW.js";import{D as he,A as ye,N as be}from"./NotesPanel-BpiQDImp.js";import{E as xe,r as fe,S as U,Y as Re}from"./ThemeContext-CxdCkKtz.js";import{P as ge}from"./PageDetail-Bm50kpyR.js";import{P as Ce}from"./PanelGroup-Bif3iIGQ.js";import{P as ke}from"./ParametersPanel-CrcKbDM0.js";import{a as x,b as Z,c as Se,i as je,d as Ie,a8 as De,p as Pe}from"./Filter-BgnAqEQC.js";import{b as K}from"./formatters-B4ehJgEk.js";import{a as w,b as Ae,u as W}from"./ReturnOrderForms-DH3actnY.js";import{u as Fe}from"./UseInstance-BPJQEWDW.js";import{u as Y}from"./ImporterForms-D2fp0CPO.js";import{I as H,E as Ee}from"./ExtraLineItemTable-DMf1CJ9x.js";import{A as Oe}from"./ActionButton-Cv5j5I5R.js";import{P as Ne,D as Le,S as B,R as Me,b as Te,a as V,N as ve,L as qe}from"./ColumnRenderers-BUH0stTX.js";import"./DesktopAppView-BuH2j218.js";import"./IconChevronDown-CzbIU38Y.js";import"./index-DRtKJP-e.js";import"./QRCode-BaIEIQ2d.js";import"./browser-DSycY7kT.js";import"./IconDotsVertical-D8D3XsjG.js";import"./IconTags-DnGx22aA.js";import"./YesNoButton-BaVgP5u9.js";import"./ModelType-DSs66IM7.js";import"./GenericErrorPage-D-1fKCA7.js";import"./NotFound-CsJ_VLc_.js";import"./PermissionDenied-BDbEipg4.js";import"./use-hover-Cq0v4QX_.js";import"./index-Chjiymov.js";import"./AttachmentLink-D_UWVUZG.js";import"./PageTitle-B4iaHXKM.js";import"./PluginUIFeature-DCu8wTdG.js";import"./RemoteComponent-uZoHDwds.js";import"./ParameterTable-CGnscd1r.js";import"./CommonForms-DKQecQmS.js";import"./IconUsers-Dr_Sln9A.js";import"./IconAddressBook-CdNRMeyy.js";import"./IconCircleDashedCheck-DnGBn8Eq.js";function Ge({orderId:u,order:m,orderDetailRefresh:_,customerId:e,editable:a,currency:p}){const o=re("return-order-line-item"),d=Q(),f=Y({modelType:n.returnorder}),[R,S]=i.useState(0),h=i.useMemo(()=>m.status==f.IN_PROGRESS,[m,f]),N=w({orderId:u,customerId:e,create:!0}),L=w({orderId:u,customerId:e}),j=x({url:l.return_order_line_list,title:t._({id:"pwb7Yo"}),fields:N,initialData:{order:u,price_currency:p},onFormSuccess:_,table:o}),b=Z({url:l.return_order_line_list,pk:R,title:t._({id:"vgosWS"}),fields:L,onFormSuccess:_,table:o}),I=Se({url:l.return_order_line_list,pk:R,title:t._({id:"tpKh8C"}),onFormSuccess:_,table:o}),D=i.useMemo(()=>[Ne({part:"part_detail"}),{accessor:"part_detail.IPN",sortable:!1},Le({accessor:"part_detail.description"}),{accessor:"item_detail.serial",title:t._({id:"VbWX2u"}),switchable:!1,render:s=>s.item_detail.serial&&s.quantity==1?`# ${s.item_detail.serial}`:s.quantity},B({model:n.stockitem,sortable:!1,accessor:"item_detail.status",title:t._({id:"uAQUqI"})}),Me({}),Te({}),B({model:n.returnorderlineitem,sortable:!0,accessor:"outcome"}),{accessor:"price",render:s=>K(s.price,{currency:s.price_currency})},V({accessor:"target_date",title:t._({id:"ZmykKo"})}),V({accessor:"received_date",title:t._({id:"J18WDZ"})}),ve({accessor:"notes"}),qe({})],[]),P=i.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"qVsPia"})},{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"vQY+8t"}),choiceFunction:je(n.returnorderlineitem)}],[]),A=i.useMemo(()=>[r.jsx(Ie,{tooltip:t._({id:"pwb7Yo"}),hidden:!a||!d.hasAddRole(c.return_order),onClick:()=>{j.open()}},"add-line-item"),r.jsx(Oe,{tooltip:t._({id:"ORa4sV"}),icon:r.jsx(H,{}),hidden:!a||h||!d.hasChangeRole(c.return_order),onClick:()=>{g(o.selectedRecords.filter(s=>!s.received_date)),C.open()},disabled:o.selectedRecords.length==0},"receive-items")],[d,a,h,u,o.selectedRecords]),[F,g]=i.useState([]),C=Ae({orderId:u,items:F,onFormSuccess:s=>o.refreshTable()}),M=i.useCallback(s=>[{hidden:!!s?.received_date||!a||!h||!d.hasChangeRole(c.return_order),title:t._({id:"7cTlo3"}),icon:r.jsx(H,{}),onClick:()=>{g([s]),C.open()}},se({hidden:!a||!d.hasChangeRole(c.return_order),onClick:()=>{S(s.pk),b.open()}}),oe({hidden:!a||!d.hasDeleteRole(c.return_order),onClick:()=>{S(s.pk),I.open()}})],[d,a,h]);return r.jsxs(r.Fragment,{children:[j.modal,b.modal,I.modal,C.modal,r.jsx(ne,{url:k(l.return_order_line_list),tableState:o,columns:D,props:{params:{order:u,part_detail:!0,item_detail:!0,order_detail:!0},enableSelection:h&&d.hasChangeRole(c.return_order),tableActions:A,tableFilters:P,rowActions:M,modelField:"item",modelType:n.stockitem}})]})}function Dt(){const{id:u}=xe(),m=Q(),_=$(),{instance:e,instanceQuery:a,refreshInstance:p}=Fe({endpoint:l.return_order_list,pk:u,params:{customer_detail:!0}}),o=Y({modelType:n.returnorder}),d=i.useMemo(()=>e.status==o.PENDING||e.status==o.PLACED||e.status==o.IN_PROGRESS||e.status==o.ON_HOLD,[e,o]),f=i.useMemo(()=>d?!0:_.isSet("RETURNORDER_EDIT_COMPLETED_ORDERS"),[d,_]),R=i.useMemo(()=>e.order_currency||e.customer_detail?.currency||_.getSetting("INVENTREE_DEFAULT_CURRENCY"),[e,_]),S=i.useMemo(()=>{if(a.isFetching)return r.jsx(J,{});const s=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:t._({id:"ZVUe1A"}),icon:"customer",copy:!0,hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:t._({id:"876pfE"}),model:n.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:n.returnorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:n.returnorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],E=[{type:"text",name:"line_items",label:t._({id:"SgduFH"}),icon:"list"},{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>e?.order_currency??e?.customer_detail?.currency},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>K(e?.total_price,{currency:e?.order_currency||e?.customer_detail?.currency})}],T=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"address",label:t._({id:"I/WHQL"}),icon:"address",value_formatter:()=>e.address_detail?r.jsx(De,{instance:e.address_detail}):r.jsx(X,{size:"sm",c:"red",children:t._({id:"dm2vYF"})})},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!e.contact_detail?.email},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!e.contact_detail?.phone},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],v=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),icon:"calendar",copy:!0,hidden:!e.creation_date},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!e.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date}];return r.jsxs(pe,{children:[r.jsxs(q,{grow:!0,children:[r.jsx(he,{appRole:c.purchase_order,apiPath:l.company_list,src:e.customer_detail?.image,pk:e.customer}),r.jsx(q.Col,{span:{base:12,sm:8},children:r.jsx(O,{fields:s,item:e})})]}),r.jsx(O,{fields:E,item:e}),r.jsx(O,{fields:T,item:e}),r.jsx(O,{fields:v,item:e})]})},[e,a]),h=i.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:r.jsx(fe,{}),content:S},{name:"line-items",label:t._({id:"SgduFH"}),icon:r.jsx(Re,{}),content:r.jsxs(y,{multiple:!0,defaultValue:["line-items","extra-items"],children:[r.jsxs(y.Item,{value:"line-items",children:[r.jsx(y.Control,{children:r.jsx(U,{size:"lg",children:t._({id:"SgduFH"})})}),r.jsx(y.Panel,{children:r.jsx(Ge,{orderId:e.pk,order:e,orderDetailRefresh:p,customerId:e.customer,editable:f,currency:R})})]},"lineitems"),r.jsxs(y.Item,{value:"extra-items",children:[r.jsx(y.Control,{children:r.jsx(U,{size:"lg",children:t._({id:"l11DG/"})})}),r.jsx(y.Panel,{children:r.jsx(Ee,{endpoint:l.return_order_extra_line_list,orderId:e.pk,orderDetailRefresh:p,currency:R,editable:f,role:c.return_order})})]},"extraitems")]})},ke({model_type:n.returnorder,model_id:e.pk}),ye({model_type:n.returnorder,model_id:e.pk}),be({model_type:n.returnorder,model_id:e.pk})],[e,u,m]),N=i.useMemo(()=>a.isLoading?[]:[r.jsx(Pe,{status:e.status_custom_key,type:n.returnorder,options:{size:"lg"}})],[e,a]),L=W({}),j=W({duplicateOrderId:e.pk}),b=Z({url:l.return_order_list,pk:e.pk,title:t._({id:"RDcVR0"}),fields:L,onFormSuccess:()=>{p()}}),I=i.useMemo(()=>{const s={...e};return delete s.reference,s},[e]),D=x({url:l.return_order_list,title:t._({id:"mpNlR/"}),fields:j,initialData:I,modelType:n.returnorder,follow:!0}),P=x({url:k(l.return_order_issue,e.pk),title:t._({id:"LUGEsQ"}),onFormSuccess:p,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),A=x({url:k(l.return_order_cancel,e.pk),title:t._({id:"qOAlIV"}),onFormSuccess:p,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),F=x({url:k(l.return_order_hold,e.pk),title:t._({id:"Sd+hNf"}),onFormSuccess:p,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),g=x({url:k(l.return_order_complete,e.pk),title:t._({id:"yDIX54"}),onFormSuccess:p,preFormWarning:t._({id:"DYITap"}),successMessage:t._({id:"W7TghJ"})}),C=i.useMemo(()=>{const s=m.hasChangeRole(c.return_order),E=s&&(e.status==o.PENDING||e.status==o.ON_HOLD),T=s&&(e.status==o.PENDING||e.status==o.PLACED||e.status==o.IN_PROGRESS),v=s&&(e.status==o.PENDING||e.status==o.IN_PROGRESS||e.status==o.ON_HOLD),z=s&&e.status==o.IN_PROGRESS;return[r.jsx(G,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!E,color:"blue",onClick:()=>P.open()}),r.jsx(G,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!z,color:"green",onClick:()=>g.open()}),r.jsx(te,{model:n.returnorder,id:e.pk}),r.jsx(ie,{model:n.returnorder,pk:e.pk,hash:e?.barcode_hash}),r.jsx(ae,{modelType:n.returnorder,items:[e.pk],enableReports:!0,enableLabels:!0}),r.jsx(le,{tooltip:t._({id:"/IKytX"}),actions:[de({hidden:!m.hasChangeRole(c.return_order),tooltip:t._({id:"mVeaUg"}),onClick:()=>{b.open()}}),ce({tooltip:t._({id:"oi/3Pq"}),hidden:!m.hasChangeRole(c.return_order),onClick:()=>D.open()}),ue({tooltip:t._({id:"20mLBC"}),hidden:!T,onClick:()=>F.open()}),me({tooltip:t._({id:"tVJk4q"}),hidden:!v,onClick:()=>A.open()})]})]},[m,e,d,o]),M=i.useMemo(()=>{let s=e.customer_detail?.name||"";return e.customer_reference&&(s+=` (${e.customer_reference})`),s},[e]);return r.jsxs(r.Fragment,{children:[b.modal,P.modal,A.modal,F.modal,g.modal,D.modal,r.jsx(_e,{query:a,requiredRole:c.return_order,children:r.jsxs(ee,{gap:"xs",children:[r.jsx(ge,{title:`${t._({id:"Z6ve1w"})}: ${e.reference}`,subtitle:M,imageUrl:e.customer_detail?.image,badges:N,actions:C,breadcrumbs:[{name:t._({id:"mUv9U4"}),url:"/sales/"}],lastCrumb:[{name:e.reference,url:`/sales/return-order/${e.pk}`}],editAction:b.open,editEnabled:m.hasChangePermission(n.returnorder)}),r.jsx(Ce,{pageKey:"returnorder",panels:h,model:n.returnorder,reloadInstance:a.refetch,instance:e,id:e.pk})]})})]})}export{Dt as default};
//# sourceMappingURL=ReturnOrderDetail-By5erBGn.js.map
