import{r as a,ab as s,ag as M,j as i,ao as p,aq as g,d as j,a7 as A,az as E,bN as T,bb as S,an as q,ak as f}from"./index-Db7AGPIq.js";import{j as L,R as N}from"./PluginUIFeature-DCu8wTdG.js";import{b as v,a as P,N as b}from"./Filter-BgnAqEQC.js";import{P as R}from"./index-DRtKJP-e.js";import{g as O}from"./ColumnRenderers-BUH0stTX.js";import{ac as w,am as V,ab as k}from"./ThemeContext-CxdCkKtz.js";import{I as D}from"./IconUsers-Dr_Sln9A.js";import{I as U}from"./IconAddressBook-CdNRMeyy.js";function Q({duplicateOrderId:e}){const t=E();return a.useMemo(()=>{const r={reference:{},description:{},customer:{disabled:e!=null,filters:{is_customer:!0,active:!0}},customer_reference:{},project_code:{},order_currency:{},start_date:{icon:i.jsx(k,{})},target_date:{icon:i.jsx(k,{})},link:{},contact:{icon:i.jsx(V,{}),adjustFilters:n=>({...n.filters,company:n.data.customer})},address:{icon:i.jsx(U,{}),adjustFilters:n=>({...n.filters,company:n.data.customer})},responsible:{icon:i.jsx(D,{})}};return e&&(r.duplicate={children:{order_id:{hidden:!0,value:e},copy_lines:{},copy_extra_lines:{}}}),t.isSet("PROJECT_CODES_ENABLED",!0)||delete r.project_code,r},[e,t])}function Y({customerId:e,orderId:t,create:r,currency:n}){const[m,l]=a.useState(void 0),[u,o]=a.useState(n??""),[c,d]=a.useState({}),[x,F]=a.useState("1");return a.useEffect(()=>{if(!r)return;const y=T(x,null);if(y==null||y<=0){l(void 0);return}if(!c||!c.price_breaks||c.price_breaks.length===0){l(void 0);return}const h=c?.price_breaks?.filter(_=>_.price_currency==u&&y>=_.quantity).sort((_,C)=>C.quantity-_.quantity);h.length?l(h[0].price):l(void 0)},[c,x,u,r]),a.useMemo(()=>({order:{filters:{customer_detail:!0},disabled:!0,value:r?t:void 0},part:{filters:{active:!0,salable:!0,price_breaks:!0},onValueChange:(h,_)=>d(_)},reference:{},quantity:{onValueChange:h=>{F(h)}},sale_price:{placeholder:m,placeholderAutofill:!0},sale_price_currency:{icon:i.jsx(L,{}),value:u,onValueChange:o},project_code:{description:s._({id:"XruckR"})},target_date:{},notes:{},link:{}}),[m,u,t,r])}function Z({shipmentId:e,onSuccess:t}){const r=M();return v({url:p.sales_order_shipment_list,pk:e,title:s._({id:"+/tsLo"}),preFormContent:i.jsx(g,{color:"green",icon:i.jsx(A,{}),title:s._({id:"+/tsLo"}),children:i.jsx(j,{children:s._({id:"tVwgS8"})})}),fetchInitialData:!1,fields:{checked_by:{hidden:!0,value:r.getUser()?.pk}},successMessage:s._({id:"geK3em"}),onFormSuccess:t})}function I({shipmentId:e,onSuccess:t}){return v({url:p.sales_order_shipment_list,pk:e,title:s._({id:"0NN8nM"}),preFormContent:i.jsx(g,{color:"red",icon:i.jsx(w,{}),title:s._({id:"0NN8nM"}),children:i.jsx(j,{children:s._({id:"u6RcM4"})})}),fetchInitialData:!1,fields:{checked_by:{hidden:!0,value:null}},successMessage:s._({id:"Y1izhb"}),onFormSuccess:t})}function z({props:e,record:t,sourceLocation:r}){const n=a.useMemo(()=>({field_type:"related field",api_url:q(p.stock_item_list),model:S.stockitem,autoFill:!0,filters:{available:!0,part_detail:!0,location_detail:!0,location:r,cascade:r?!0:void 0,part:t.part},value:e.item.stock_item,name:"stock_item",onValueChange:(l,u)=>{if(e.changeFn(e.idx,"stock_item",l),u){const o=u.quantity-u.allocated,c=t.quantity-t.allocated;let d=e.item?.quantity??0;d=Math.max(d,c),d=Math.min(d,o),d!=e.item.quantity&&e.changeFn(e.idx,"quantity",d)}}}),[r,t,e]),m=a.useMemo(()=>({field_type:"number",name:"quantity",required:!0,value:e.item.quantity,onValueChange:l=>{e.changeFn(e.idx,"quantity",l)}}),[e]);return i.jsxs(f.Tr,{children:[i.jsx(f.Td,{children:i.jsx(O,{part:t.part_detail})}),i.jsx(f.Td,{children:i.jsx(R,{value:t.allocated,maximum:t.quantity,progressLabel:!0})}),i.jsx(f.Td,{children:i.jsx(b,{fieldName:"stock_item",fieldDefinition:n,error:e.rowErrors?.stock_item?.message})}),i.jsx(f.Td,{children:i.jsx(b,{fieldName:"quantity",fieldDefinition:m,error:e.rowErrors?.quantity?.message})}),i.jsx(f.Td,{children:i.jsx(N,{onClick:()=>e.removeFn(e.idx)})})]},`table-row-${e.idx}-${t.pk}`)}function ee({orderId:e,shipmentId:t,lineItems:r,onFormSuccess:n}){const[m,l]=a.useState(null);a.useEffect(()=>{l(null)},[e,t,r]);const u=a.useMemo(()=>({source_location:{exclude:!0,required:!1,field_type:"related field",api_url:q(p.stock_location_list),model:S.stocklocation,label:s._({id:"/00Ond"}),description:s._({id:"IArqwk"}),onValueChange:o=>{l(o)}},items:{field_type:"table",value:[],headers:[{title:s._({id:"vgP+9p"}),style:{minWidth:"200px"}},{title:s._({id:"A/ybx7"}),style:{minWidth:"200px"}},{title:s._({id:"igx8Og"}),style:{width:"100%"}},{title:s._({id:"VbWX2u"}),style:{minWidth:"200px"}},{title:"",style:{width:"50px"}}],modelRenderer:o=>{const c=r.find(d=>d.pk==o.item.line_item)??{};return i.jsx(z,{props:o,record:c,sourceLocation:m},`table-row-${o.idx}-${c.pk}`)}},shipment:{filters:{shipped:!1,order_detail:!0,order:e}}}),[e,t,r,m]);return P({title:s._({id:"L1LMmH"}),url:p.sales_order_allocate,pk:e,fields:u,onFormSuccess:n,successMessage:s._({id:"23SrHL"}),size:"80%",initialData:{items:r.map(o=>({line_item:o.pk,quantity:0,stock_item:null}))}})}function te({itemId:e,orderId:t}){return a.useMemo(()=>({line_item:{value:e,hidden:!0},quantity:{},serial_numbers:{},shipment:{filters:{order_detail:!0,order:t,shipped:!1}}}),[e,t])}function ie({customerId:e,pending:t}){return a.useMemo(()=>({order:{disabled:!0},reference:{},shipment_date:{hidden:t??!0},delivery_date:{hidden:t??!0},shipment_address:{placeholder:s._({id:"nzzuLr"}),filters:{company:e,ordering:"-primary"}},tracking_number:{},invoice_number:{},link:{}}),[e,t])}function re({shipmentId:e}){return a.useMemo(()=>({shipment_date:{},tracking_number:{},invoice_number:{},link:{}}),[e])}function se({orderId:e,shipment:t}){return a.useMemo(()=>({item:{disabled:!0},quantity:{},shipment:{disabled:!!t?.shipment_date,hidden:!e,filters:{order:e,shipped:!1}}}),[e,t])}export{Y as a,te as b,ee as c,ie as d,re as e,Z as f,I as g,se as h,Q as u};
//# sourceMappingURL=SalesOrderForms-DoG2xqUe.js.map
