import{K as fe,j as s,b3 as _,ac as z,aa as D,r as t,ay as Le,ab as o,ci as qe,aD as le,b8 as ae,bg as ee,av as ze,an as W,ao as X,bE as J,a8 as Se,a7 as rs,ai as ls,bk as Ae,bj as ce,O as Z,be as Be,az as as,e as cs,Q as ds,aj as pe,bf as us,b9 as ms,al as He,S as V,d as S,$ as Ne,N,am as hs,aw as Ve,aq as Re,cz as de,bF as oe,u as fs,M as ps,aC as gs,bz as Ee}from"./index-Db7AGPIq.js";import{u as ge,a as xs}from"./DesktopAppView-BuH2j218.js";import{w as Cs,aB as $e,aw as xe,aN as js,ai as Ke,ac as ys,z as vs,v as G,aC as De,t as Qe,at as bs,S as Ce,I as ks,a8 as Fs,aO as ws,P as _s,aP as Ts,B as ue,x as Is,aQ as Ms,a as As,aR as Rs}from"./ThemeContext-CxdCkKtz.js";import{b as Ge,a as Es,I as Ds}from"./IconChevronDown-CzbIU38Y.js";import{P as Pe,C as Ps,W as Os}from"./index-DRtKJP-e.js";import{u as Ls,a as me,ai as je,aj as qs,k as zs,ak as Ss,N as Bs,c as Hs,al as Ns}from"./Filter-BgnAqEQC.js";import{A as Vs}from"./ActionButton-Cv5j5I5R.js";import{I as $s,Q as Ks,a as Qs}from"./QRCode-BaIEIQ2d.js";import{I as Gs}from"./IconDotsVertical-D8D3XsjG.js";import{I as Us,a as Ys}from"./IconTags-DnGx22aA.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M4 10a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M6 4v4",key:"svg-1"}],["path",{d:"M6 12v8",key:"svg-2"}],["path",{d:"M10 16a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-3"}],["path",{d:"M12 4v10",key:"svg-4"}],["path",{d:"M12 18v2",key:"svg-5"}],["path",{d:"M16 7a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-6"}],["path",{d:"M18 4v1",key:"svg-7"}],["path",{d:"M18 9v11",key:"svg-8"}]],Ws=fe("outline","adjustments","Adjustments",Js);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]],Zs=fe("outline","download","Download",Xs);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]],sn=fe("outline","filter","Filter",en);function nn({icon:n,actions:e,tooltip:i="",label:a=""}){return s.jsxs(_,{shadow:"xs",children:[s.jsx(_.Target,{children:s.jsx(z,{variant:"default",children:s.jsx(D,{label:i,children:n})})}),s.jsxs(_.Dropdown,{children:[a&&s.jsx(_.Label,{children:a}),e.map((r,u)=>s.jsx(_.Item,{children:r},`${u}-${r}`))]})]})}function tn({disabled:n,debounce:e,placeholder:i,searchCallback:a}){const[r,u]=t.useState(""),[h]=Ls(r,e??500);return t.useEffect(()=>{a(h)},[h]),s.jsx(Le,{value:r,disabled:n,"aria-label":"table-search-input",leftSection:s.jsx(Cs,{}),placeholder:i??o._({id:"A1taO8"}),onChange:m=>u(m.target.value),rightSection:r.length>0?s.jsx(qe,{size:"xs",onClick:()=>{u(""),a("")}}):null})}function Tn(n){return{...n,color:void 0,icon:s.jsx(Ge,{}),onClick:e=>{const i=le(n.modelType,n.modelId);ae(i,n.navigate,e)}}}function In(n){return{...n,title:o._({id:"euc6Ns"}),color:"green",icon:s.jsx(Ke,{})}}function Mn(n){return{...n,title:o._({id:"ePK91l"}),color:"blue",icon:s.jsx($e,{})}}function An(n){return{...n,title:o._({id:"cnGeoo"}),color:"red",icon:s.jsx(xe,{})}}function Rn(n){return{...n,title:o._({id:"dEgA5A"}),color:"red",icon:s.jsx(ys,{})}}function on({title:n,actions:e,disabled:i=!1,index:a}){function r(c){ee(c),h(!u)}const[u,h]=t.useState(!1),m=t.useMemo(()=>e.filter(c=>!c.hidden),[e]);function j(c){return s.jsx(D,{withinPortal:!0,label:c.tooltip??c.title,position:"left",children:s.jsx(_.Item,{color:c.color,leftSection:c.icon,onClick:f=>{ee(f),c.onClick?.(f),h(!1)},disabled:c.disabled||!1,children:c.title})},c.title)}return m.length>0&&s.jsxs(_,{withinPortal:!0,disabled:i,position:"bottom-end",opened:u,onChange:h,children:[s.jsx(_.Target,{children:s.jsx(D,{withinPortal:!0,label:n||o._({id:"7L01XJ"}),children:s.jsx(z,{"aria-label":`row-action-menu-${a??""}`,onClick:r,disabled:i,variant:"subtle",color:"gray",children:s.jsx(js,{})},`row-action-menu-${a??""}`)})}),s.jsx(_.Dropdown,{children:m.map(c=>s.jsx(j,{...c},c.title))})]})}function he({title:n,id:e}){const i=ge(),a=vs(),[r,u]=t.useState(!1);t.useEffect(()=>{e?(u(!0),ze({id:`data-output-${e}`,title:n,loading:!0,autoClose:!1,withCloseButton:!1,message:s.jsx(Pe,{size:"lg",value:0,progressLabel:!0})})):u(!1)},[e,n]),G({enabled:!!e&&r&&a==="visible",refetchInterval:500,queryKey:["data-output",e,n],queryFn:()=>i.get(W(X.data_output,e)).then(h=>{const m=h?.data??{};if(m.errors||m.error){u(!1);const j=m?.error??m?.errors?.error??o._({id:"gzjOvt"});J.update({id:`data-output-${e}`,loading:!1,icon:s.jsx(Se,{}),autoClose:2500,title:n,message:j,color:"red"})}else if(m.complete){if(u(!1),J.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:n,message:o._({id:"TCOQbo"}),color:"green",icon:s.jsx(rs,{})}),m.output){const j=ls(m.output);window.open(j.toString(),"_blank")}}else J.update({id:`data-output-${e}`,loading:!0,autoClose:!1,withCloseButton:!1,message:s.jsx(Pe,{size:"lg",maximum:m.total,value:m.progress,progressLabel:m.total>0,animated:!0})});return m}).catch(()=>(u(!1),J.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:n,message:o._({id:"gzjOvt"}),color:"red"}),{}))})}function ye({icon:n,tooltip:e,tooltipPosition:i,actions:a,disabled:r=!1,hidden:u=!1,noindicator:h=!1,position:m}){const j=t.useMemo(()=>a.some(g=>!g.hidden),[a]),c=t.useMemo(()=>a.find(g=>g.indicator),[a]),f=t.useMemo(()=>Ae(`action-menu-${e}`),[e]);return!u&&j?s.jsxs(_,{position:m??"bottom-end",children:[s.jsx(ce,{disabled:!c,...c?.indicator,children:s.jsx(_.Target,{children:s.jsx(D,{label:e,hidden:!e,position:i??"bottom",children:s.jsx(Z,{variant:h?"transparent":"light",disabled:r,"aria-label":f,p:"0",size:"sm",rightSection:h?null:s.jsx(Es,{stroke:1.5}),styles:{section:{margin:0}},children:n})})})}),s.jsx(_.Dropdown,{children:a.map(g=>{const M=Ae(`${f}-${g.name}`);return g.hidden?null:t.createElement(ce,{disabled:!g.indicator,...g.indicator,key:g.name},s.jsx(D,{label:g.tooltip,hidden:!g.tooltip,position:"left",children:s.jsx(_.Item,{"aria-label":M,leftSection:g.icon,onClick:g.onClick,disabled:g.disabled,children:g.name})}))})})]},f):null}function En({actions:n=[],tooltip:e=o._({id:"0zpgxV"}),hidden:i=!1}){return s.jsx(ye,{icon:s.jsx(Gs,{}),tooltip:e,actions:n,hidden:i,noindicator:!0})}function Dn({model:n,pk:e,hash:i=null,actions:a=[],perm:r=!0}){const u=i===null,h={model:n,pk:e,hash:i};return s.jsx(ye,{tooltip:o._({id:"heU0Hk"}),icon:s.jsx(De,{}),actions:[re({mdl_prop:h,title:o._({id:"mYTVOy"}),icon:s.jsx(De,{}),tooltip:o._({id:"PuPuVa"}),ChildItem:$s}),re({hidden:u||i||!r,mdl_prop:h,title:o._({id:"3Bbgw2"}),icon:s.jsx(ks,{}),tooltip:o._({id:"utafdp"}),ChildItem:Ks}),re({hidden:u||!i||!r,mdl_prop:h,title:o._({id:"ut1J8k"}),icon:s.jsx(Fs,{}),tooltip:o._({id:"AlfG1i"}),ChildItem:Qs}),...a]})}function re({hidden:n=!1,mdl_prop:e,title:i,icon:a,tooltip:r,ChildItem:u}){return{icon:a,name:i,tooltip:r,onClick:()=>{bs.open({title:s.jsx(Ce,{size:"xl",children:i}),children:s.jsx(u,{mdl_prop:e})})},hidden:n}}function Pn(n){return{...n,icon:s.jsx($e,{color:"blue"}),name:o._({id:"ePK91l"}),tooltip:n.tooltip??o._({id:"Qpg4KV"})}}function On(n){return{...n,icon:s.jsx(xe,{color:"red"}),name:o._({id:"cnGeoo"}),tooltip:n.tooltip??o._({id:"ZatbPe"})}}function Ln(n){return{...n,icon:s.jsx(Qe,{icon:"hold",iconProps:{color:"orange"}}),name:o._({id:"YJMNeo"}),tooltip:n.tooltip??o._({id:"YJMNeo"})}}function qn(n){return{...n,icon:s.jsx(Qe,{icon:"cancel",iconProps:{color:"red"}}),name:o._({id:"dEgA5A"}),tooltip:n.tooltip??o._({id:"dEgA5A"})}}function zn(n){return{...n,icon:s.jsx(Ke,{color:"green"}),name:o._({id:"euc6Ns"}),tooltip:n.tooltip??o._({id:"QXHPgY"})}}function rn({items:n,hidden:e,enableLabels:i,enableReports:a,modelType:r}){const u=Be(),h=as(),m=t.useMemo(()=>n.length>0,[n]),j=t.useMemo(()=>u.getSetting("LABEL_DEFAULT_PRINTER"),[u]),[c,f]=t.useState(null),g=t.useMemo(()=>i&&h.isSet("LABEL_ENABLE"),[i,h]),M=t.useMemo(()=>a&&h.isSet("REPORT_ENABLE"),[a,h]),[v,y]=t.useState(void 0),[x,I]=t.useState(void 0);he({title:o._({id:"5cY8gX"}),id:v}),he({title:o._({id:"T6GYw9"}),id:x});const[T,L]=t.useState([]),q=G({enabled:g,queryKey:["printingFields",r,c],gcTime:500,queryFn:()=>cs.options(W(X.label_print),{params:{plugin:c||void 0}}).then(F=>je(F,"POST")||{})}),B=t.useMemo(()=>{const F=q.data||{};return F.template={...F.template,autoFill:!0,filters:{enabled:!0,model_type:r,items:T.join(",")}},F.items={...F.items,value:T,hidden:!0},F.plugin={...F.plugin,default:j,value:c,filters:{active:!0,mixin:"labels"},onValueChange:(K,P)=>{P?.key&&P?.key!=c&&f(P.key)}},F},[j,c,q.data,T]),b=me({url:W(X.label_print),title:o._({id:"kjqRDg"}),modalId:"print-labels",fields:B,timeout:5e3,onOpen:()=>{L(n)},onClose:()=>{f("")},submitText:o._({id:"BZz12Q"}),successMessage:null,onFormSuccess:F=>{f(""),y(F.pk)}}),$=t.useMemo(()=>({template:{autoFill:!0,filters:{enabled:!0,model_type:r,items:T.join(",")}},items:{hidden:!0,value:T}}),[T,r]),p=me({url:W(X.report_print),title:o._({id:"qsurSb"}),modalId:"print-reports",timeout:5e3,fields:$,onOpen:()=>{L(n)},submitText:o._({id:"BZz12Q"}),successMessage:null,onFormSuccess:F=>{I(F.pk)}});return!r||!g&&!M?null:!e&&s.jsxs(s.Fragment,{children:[p.modal,b.modal,s.jsx(ye,{tooltip:o._({id:"/oz6DG"}),icon:s.jsx(ws,{}),position:"bottom-start",disabled:!m,actions:[{name:o._({id:"Y93N6T"}),icon:s.jsx(Us,{}),onClick:()=>b.open(),hidden:!g},{name:o._({id:"ClULGR"}),icon:s.jsx(Ys,{}),onClick:()=>p.open(),hidden:!M}]})]})}function ln(n){const[e,i]=_s({key:`inventree-filterset-${n}`,defaultValue:[],sync:!1,getInitialValueInEffect:!1}),a=t.useCallback(()=>{i([])},[]);return{filterKey:n,activeFilters:e,setActiveFilters:i,clearActiveFilters:a}}function Sn(n,e="pk"){function i(){return`${n.replaceAll("-","")}-${ds()}`}const[a,r]=xs(),u=t.useCallback(()=>{r({})},[]),[h,m]=t.useState(i()),j=t.useCallback(A=>{m(i()),A&&L()},[i]),c=ln(`table-${n}`),[f,g]=t.useState([]),M=t.useCallback(A=>f.includes(A),[f]),[v,y]=t.useState([]),[x,I]=t.useState([]),T=t.useMemo(()=>x.map(A=>A[e||"pk"]),[x]),L=t.useCallback(()=>{I([])},[]),q=t.useMemo(()=>x.length>0,[x]),[B,b]=t.useState(0),[$,p]=t.useState(1),[F,K]=t.useState(""),[P,U]=t.useState([]),O=t.useCallback(A=>{const E=[...P],H=E.findIndex(ne=>ne[e||"pk"]===A.pk);H>=0?E[H]={...E[H],...A}:E.push(A),U(E)},[P]),[se,Q]=t.useState(!1);return{tableKey:h,refreshTable:j,isLoading:se,setIsLoading:Q,filterSet:c,queryFilters:a,setQueryFilters:r,clearQueryFilters:u,expandedRecords:f,setExpandedRecords:g,isRowExpanded:M,selectedRecords:x,selectedIds:T,setSelectedRecords:I,clearSelectedRecords:L,hasSelectedRecords:q,searchTerm:F,setSearchTerm:K,recordCount:B,setRecordCount:b,hiddenColumns:v,setHiddenColumns:y,page:$,setPage:p,records:P,setRecords:U,updateRecord:O,idAccessor:e}}function an({url:n,enabled:e,filters:i,searchTerm:a}){const r=ge(),[u,h]=t.useState("inventree-exporter"),[m,j]=t.useState(void 0);he({title:o._({id:"gAwkCm"}),id:m});const c=t.useMemo(()=>{const v={export:!0};u&&(v.export_plugin=u);for(const[y,x]of Object.entries(i??{}))x!=null&&(v[y]=x);return a&&(v.search=a),v},[u,i,a]),f=G({enabled:!!n&&e,queryKey:["export-fields",u,n,c],gcTime:500,queryFn:()=>r.options(n,{params:c}).then(v=>je(v,"GET")||{})}),g=t.useMemo(()=>{const v=f.data||{},y={export_format:{},export_plugin:{},...v};return y.export_format={...y.export_format,required:!0},y.export_plugin={...y.export_plugin,required:!0,onValueChange:x=>{x&&h(x)}},y},[f]);return me({url:n,queryParams:new URLSearchParams(c),title:o._({id:"CEVW38"}),method:"GET",fields:g,submitText:o._({id:"GS+Mus"}),successMessage:null,timeout:30*1e3,onFormSuccess:v=>{j(v.pk),h("inventree-exporter")}})}function cn({columns:n,onToggleColumn:e}){return s.jsxs(_,{shadow:"xs",closeOnItemClick:!1,children:[s.jsx(_.Target,{children:s.jsx(z,{variant:"transparent","aria-label":"table-select-columns",children:s.jsx(D,{label:o._({id:"kCTFU8"}),position:"top-end",children:s.jsx(Ws,{})})})}),s.jsxs(_.Dropdown,{style:{maxHeight:"400px",overflowY:"auto"},children:[s.jsx(_.Label,{children:o._({id:"kCTFU8"})}),s.jsx(pe,{}),n.filter(i=>i.switchable??!0).map(i=>s.jsx(_.Item,{children:s.jsx(us,{checked:!i.hidden,label:i.title||i.accessor,onChange:()=>e(i.accessor),radius:"sm"})},i.accessor))]})]})}function dn({flt:n,filterSet:e}){const i=t.useCallback(()=>{const a=e.activeFilters.filter(r=>r.name!==n.name);e.setActiveFilters(a)},[n]);return s.jsx(Ne,{p:"sm",shadow:"sm",radius:"xs",children:s.jsxs(N,{justify:"space-between",wrap:"nowrap",children:[s.jsxs(V,{gap:"xs",children:[s.jsx(S,{size:"sm",children:n.label}),s.jsx(S,{size:"xs",children:n.description})]}),s.jsxs(N,{justify:"right",children:[s.jsx(hs,{children:n.displayValue??n.value}),s.jsx(D,{label:o._({id:"rn2/2V"}),withinPortal:!0,children:s.jsx(qe,{size:"md",color:"red",onClick:i})})]})]},n.name)})}function un({filterName:n,filterProps:e,valueOptions:i,onValueChange:a}){const r=t.useCallback(m=>{if(m){const j=m.toString();a(zs(j).format("YYYY-MM-DD"))}else a("")},[a]),[u,h]=t.useState("");switch(e.type){case"api":return s.jsx(Bs,{fieldName:`filter-${n}`,fieldDefinition:{field_type:"related field",api_url:e.apiUrl,filters:e.apiFilter,placeholder:o._({id:"Fo55lj"}),model:e.model,label:o._({id:"Fo55lj"}),onValueChange:(m,j)=>{a(m,e.modelRenderer?.(j))}}});case"text":return s.jsx(Le,{label:o._({id:"wMHvYH"}),value:u,placeholder:o._({id:"Q//Mlp"}),rightSection:s.jsx(z,{"aria-label":"apply-text-filter",variant:"transparent",onClick:()=>a(u),children:s.jsx(Ts,{})}),onChange:m=>h(m.currentTarget.value),onKeyDown:m=>{m.key==="Enter"&&a(u)}});case"date":return s.jsx(Ss,{label:o._({id:"wMHvYH"}),placeholder:o._({id:"A63fc7"}),onChange:r});case"choice":case"boolean":default:return s.jsx(Ve,{data:i,searchable:e.type=="choice",label:o._({id:"wMHvYH"}),withScrollArea:!1,placeholder:o._({id:"Fo55lj"}),onChange:m=>a(m),maxDropdownHeight:800})}}function mn({filterSet:n,availableFilters:e}){const i=t.useMemo(()=>{let c=[];return n.activeFilters&&n.activeFilters.length>0&&(c=n.activeFilters?.map(f=>f.name)??[]),e?.filter(f=>!c.includes(f.name))?.sort((f,g)=>f.label.localeCompare(g.label))?.map(f=>({value:f.name,label:f.label,description:f.description}))??[]},[n.activeFilters,e]),[a,r]=t.useState(null),u=t.useMemo(()=>{const c=e?.find(f=>f.name===a);return c?qs(c):[]},[a]),h=c=>c.type?c.type:c.apiUrl&&c.model?"api":c.choices||c.choiceFunction?"choice":"boolean",m=t.useMemo(()=>{const c=e?.find(f=>f.name===a);return c&&(c.type=h(c)),c},[e,a]),j=t.useCallback((c,f)=>{const g=e.find(y=>y.name===a);if(!g)return;const M=n.activeFilters?.filter(y=>y.name!==a)??[],v={...g,value:c,displayValue:f??u.find(y=>y.value===c)?.label};n.setActiveFilters([...M,v]),r(null)},[a]);return s.jsxs(V,{gap:"xs",children:[s.jsx(Ve,{data:i,searchable:!0,placeholder:o._({id:"hpMOSe"}),label:o._({id:"o7J4JM"}),onChange:c=>r(c),maxDropdownHeight:400}),a&&m&&s.jsx(un,{filterName:a,filterProps:m,valueOptions:u,onValueChange:j})]})}function hn({title:n,availableFilters:e,filterSet:i,opened:a,onClose:r}){const[u,h]=t.useState(!1);t.useEffect(()=>{h(!1)},[i.activeFilters]);const m=t.useMemo(()=>(i?.activeFilters??[]).length>0,[i.activeFilters]);return s.jsxs(ms,{size:"sm",position:"right",withCloseButton:!0,opened:a,onClose:r,closeButtonProps:{"aria-label":"filter-drawer-close"},title:s.jsx(Ce,{size:"lg",children:n??o._({id:"l34cnu"})}),children:[s.jsx(pe,{}),s.jsx(He,{h:"sm"}),s.jsxs(V,{gap:"xs",children:[m&&i.activeFilters?.map(j=>s.jsx(dn,{flt:j,filterSet:i},j.name)),u&&s.jsx(V,{gap:"xs",children:s.jsx(mn,{filterSet:i,availableFilters:e})}),u&&s.jsx(Z,{onClick:()=>h(!1),color:"orange",variant:"subtle",children:s.jsx(S,{children:o._({id:"dEgA5A"})})}),!u&&i.activeFilters.length<e.length&&s.jsx(Z,{onClick:()=>h(!0),color:"green",variant:"subtle",children:s.jsx(S,{children:o._({id:"PzFzS+"})})}),!u&&i.activeFilters.length>0&&s.jsx(Z,{onClick:i.clearActiveFilters,color:"red",variant:"subtle",children:s.jsx(S,{children:o._({id:"J8ECgX"})})})]})]})}function fn({tableUrl:n,tableState:e,tableProps:i,hasSwitchableColumns:a,columns:r,filters:u,toggleColumn:h}){const[m,j]=t.useState(!1),c=t.useMemo(()=>{const x={};for(const[I,T]of Object.entries(i.params??{}))T!=null&&(x[I]=T);if(e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(I=>{x[I.name]=I.value}),e.queryFilters)for(const[I,T]of e.queryFilters)T!=null&&(x[I]=T);return x},[i.params,e.filterSet,e.queryFilters]),f=an({url:n??"",enabled:!!n&&i?.enableDownload!=!1,filters:c,searchTerm:e.searchTerm}),g=Hs({url:n??"",title:o._({id:"NEGzXb"}),preFormContent:s.jsx(Re,{color:"red",title:o._({id:"3kYcuM"}),children:o._({id:"U99rVM"})}),initialData:{items:e.selectedIds},fields:{items:{hidden:!0}},successMessage:o._({id:"B7s1hd"}),onFormError:x=>{ze({id:"bulk-delete-error",title:o._({id:"SlfejT"}),message:o._({id:"NO2Qmx"}),color:"red",icon:s.jsx(Se,{}),autoClose:5e3})},onFormSuccess:()=>{e.clearSelectedRecords(),e.refreshTable(),i.afterBulkDelete&&i.afterBulkDelete()}}),M=t.useMemo(()=>e.queryFilters.has("search"),[e.queryFilters]),v=t.useMemo(()=>(e?.queryFilters?.size??0)>0,[e.queryFilters]),y=t.useMemo(()=>e.selectedRecords?.map(x=>de(x,i.printingAccessor??"pk"))??[],[i.printingAccessor,e.selectedRecords]);return s.jsxs(s.Fragment,{children:[f.modal,g.modal,i.enableFilters&&(u.length??0)>0&&s.jsx(ue,{label:`InvenTreeTableFilterDrawer-${e.tableKey}`,children:s.jsx(hn,{availableFilters:u,filterSet:e.filterSet,opened:m,onClose:()=>j(!1)})}),(v||M)&&s.jsx(Re,{color:"yellow",withCloseButton:!0,title:o._({id:"VUTcDq"}),onClose:()=>e.clearQueryFilters()}),s.jsxs(N,{justify:"apart",grow:!0,wrap:"nowrap",children:[s.jsxs(N,{justify:"left",gap:5,wrap:"nowrap",children:[s.jsx(rn,{items:y,modelType:i.modelType,enableLabels:i.enableLabels,enableReports:i.enableReports}),(i.barcodeActions?.length??0)>0&&s.jsx(nn,{icon:s.jsx(Ds,{}),label:o._({id:"heU0Hk"}),tooltip:o._({id:"heU0Hk"}),actions:i.barcodeActions??[]},"barcode-actions"),i.enableBulkDelete&&s.jsx(Vs,{disabled:!e.hasSelectedRecords,icon:s.jsx(xe,{}),color:"red",tooltip:o._({id:"QZQ+5V"}),onClick:()=>{g.open()}}),i.tableActions?.map((x,I)=>s.jsx(s.Fragment,{children:x},I))]},"custom-actions"),s.jsx(He,{}),s.jsxs(N,{justify:"right",gap:5,wrap:"nowrap",children:[i.enableSearch&&s.jsx(tn,{disabled:M,searchCallback:x=>e.setSearchTerm(x)}),i.enableRefresh&&s.jsx(z,{variant:"transparent","aria-label":"table-refresh",children:s.jsx(D,{label:o._({id:"8RYNR1"}),position:"top-end",children:s.jsx(Is,{onClick:()=>{e.refreshTable(),e.clearSelectedRecords()}})})}),a&&s.jsx(cn,{columns:r,onToggleColumn:h}),i.enableFilters&&u.length>0&&s.jsx(ce,{size:"xs",label:e.filterSet.activeFilters?.length??0,disabled:e.filterSet.activeFilters?.length==0,children:s.jsx(z,{disabled:v,variant:"transparent","aria-label":"table-select-filters",children:s.jsxs(oe,{position:"bottom-end",withinPortal:!0,disabled:v||!e.filterSet.activeFilters?.length,children:[s.jsx(oe.Target,{children:s.jsx(D,{label:o._({id:"l34cnu"}),position:"top-end",disabled:!!e.filterSet.activeFilters?.length,children:s.jsx(sn,{onClick:()=>j(!m)})})}),s.jsx(oe.Dropdown,{children:s.jsx(Ne,{p:"sm",withBorder:!0,children:s.jsxs(V,{gap:"xs",children:[s.jsx(Ce,{size:"md",children:o._({id:"GhOy5V"})}),s.jsx(pe,{}),e.filterSet.activeFilters?.map(x=>s.jsxs(N,{justify:"space-between",gap:"xl",wrap:"nowrap",children:[s.jsx(S,{size:"sm",children:x.label}),s.jsx(S,{size:"xs",children:x.displayValue})]},x.name))]})})})]})})}),n&&i.enableDownload&&s.jsx(z,{variant:"transparent","aria-label":"table-export-data",children:s.jsx(D,{label:o._({id:"ECXmiK"}),position:"top-end",children:s.jsx(Zs,{onClick:f.open})})})]})]})]})}const Oe="--actions--",pn=[10,15,20,25,50,100,500],gn={params:{},noRecordsText:o._({id:"EqGTpW"}),enableDownload:!1,enableLabels:!1,enableReports:!1,enableFilters:!0,enablePagination:!0,enableRefresh:!0,enableSearch:!0,enableSelection:!1,defaultSortColumn:"",barcodeActions:[],printingAccessor:"pk",tableFilters:[],tableActions:[]};function Bn({url:n,tableState:e,tableData:i,columns:a,props:r}){const{userTheme:u}=fs(),{pageSize:h,setPageSize:m,getHiddenColumns:j,setHiddenColumns:c,getTableColumnNames:f,setTableColumnNames:g,getTableSorting:M,setTableSorting:v}=Ms(),[y,x]=t.useState({}),I=ge(),T=As(),{showContextMenu:L}=Rs(),q=Be(),B=t.useMemo(()=>q.isSet("STICKY_TABLE_HEADER"),[q]),b=t.useMemo(()=>{const l=`table-${e.tableKey}`,d=l.indexOf("-mantine");return d>=0?l.substring(0,d):l},[e.tableKey]),$=t.useMemo(()=>r.tableFilters?.filter(l=>l.active!=!1)?.map(l=>({...l,label:l.label??y[l.name]??`${l.name}`}))??[],[r.tableFilters,y]),p=t.useMemo(()=>({...gn,...r}),[r]),F=G({enabled:!!n&&!i,queryKey:["options",n,b,p.params,r.enableColumnCaching],retry:5,retryDelay:l=>(1+l)*250,throwOnError:l=>(Ee({error:l,title:o._({id:"0uyCkG"})}),!0),refetchOnMount:!0,gcTime:5e3,queryFn:async()=>!n||r.enableColumnCaching==!1||y&&Object.keys(y).length>0?null:I.options(n,{params:p.params}).then(l=>{if(l.status==200){const d={},C=je(l,"GET",!0)||{};Ns(C,(k,w)=>{w.label&&(d[k]=w.label)}),x(d),g(b)(d)}return null})});t.useEffect(()=>{if(r.enableColumnCaching==!1)return;const l=f(b);if(l!=null){x(l);return}},[]);const K=t.useMemo(()=>p.enableSelection||p.enableBulkDelete||!1,[p]),P=t.useMemo(()=>r.enableColumnSwitching==!1?!1:a.some(l=>l.hidden==!0?!1:l.switchable!=!1),[a,r.enableColumnSwitching]),U=t.useCallback(l=>{e.setSelectedRecords(l)},[e.setSelectedRecords]),O=t.useMemo(()=>{let l=a.filter(d=>d?.hidden!=!0);return l=l.map(d=>{const C=d.switchable==!1?!1:e.hiddenColumns?.includes(d.accessor)??!1;return{...d,hidden:C,resizable:d.resizable??!0,title:d.title??y[d.accessor]??`${d.accessor}`,cellsStyle:(k,w)=>({minWidth:d.minWidth??100}),titleStyle:(k,w)=>({minWidth:d.minWidth??100})}}),p.rowActions&&l.push({accessor:Oe,title:"   ",hidden:!1,resizable:!1,switchable:!1,width:50,render:(d,C)=>s.jsx(on,{actions:p.rowActions?.(d)??[],disabled:e.selectedRecords.length>0,index:C})}),l},[a,y,p.rowActions,e.hiddenColumns,e.selectedRecords]),se=t.useCallback(l=>{const d=[...O],C=d.findIndex(w=>w.accessor==l);C>=0&&C<d.length&&(d[C].hidden=!d[C].hidden);const k=d.filter(w=>w.hidden).map(w=>w.accessor);e.setHiddenColumns(k),c(b)(k)},[b,O]),Q=Ps({key:b,columns:O,getInitialValueInEffect:!1}),A=t.useMemo(()=>O.map(l=>l.accessor),[O]);t.useEffect(()=>{JSON.stringify(Q.columnsOrder)!=JSON.stringify(A)&&Q.setColumnsOrder(A)},[b,A]),t.useEffect(()=>{e.setPage(1),e.clearSelectedRecords()},[e.searchTerm,e.filterSet.activeFilters,e.queryFilters]),t.useEffect(()=>{(e.page>1&&h*(e.page-1)>e.recordCount||e.page<1)&&e.setPage(1),h<10&&m(25)},[e.records,e.page,h]);const[E,H]=t.useState({columnAccessor:p.defaultSortColumn??"",direction:"asc"}),ne=t.useCallback((l=!1)=>{const d={...p.params};if(e.queryFilters&&e.queryFilters.size>0)for(const[k,w]of e.queryFilters)d[k]=w;else e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(k=>{d[k.name]=k.value});e.searchTerm&&(d.search=e.searchTerm),p.enablePagination&&l&&(d.limit=h,d.offset=(e.page-1)*h);const C=be();return C&&(E.direction=="asc"?d.ordering=C:d.ordering=`-${C}`),d},[E,p.params,p.enablePagination,e.filterSet.activeFilters,e.queryFilters,e.searchTerm,be]),[ve,Ue]=t.useState(!1);t.useEffect(()=>{const l=M(b);l&&l.columnAccessor&&l.direction&&H(l);const d=j(b);if(d==null){const C=a.filter(k=>k.switchable!=!1&&k.defaultVisible==!1).map(k=>k.accessor);c(b)(C),e.setHiddenColumns(C)}else e.setHiddenColumns(d);Ue(!0)},[b]);function be(){const l=E.columnAccessor;return l==""?"":O.find(C=>C.accessor==l)?.ordering||l}const[Ye,Je]=t.useState(p.noRecordsText??o._({id:"EqGTpW"})),We=t.useCallback(l=>{e.setPage(1),H(l),v(b)(l)},[b]),Xe=async()=>{const l=ne(!0);return n?ve?I.get(n,{params:l,timeout:10*1e3}).then(d=>{let C=d.data?.results??d.data??[];return r.dataFormatter&&(C=r.dataFormatter(C)),Array.isArray(C)||(Je(o._({id:"3o3AAs"})),C=[]),e.setRecordCount(d.data?.count??C.length),C}):[]:[]},{data:ke,isFetching:te,isLoading:Fe,refetch:Ze}=G({queryKey:["tabledata",n,e.page,r.params,ve,E.columnAccessor,E.direction,e.tableKey,e.filterSet.activeFilters,e.searchTerm],retry:5,retryDelay:l=>(1+l)*250,throwOnError:l=>(Ee({error:l,title:o._({id:"UJqwtM"})}),!0),enabled:!!n&&!i,queryFn:Xe});t.useEffect(()=>{Ze()},[e.queryFilters]),t.useEffect(()=>{const l=te||Fe||F.isFetching||F.isLoading;l!=e.isLoading&&e.setIsLoading(l)},[te,Fe,F.isFetching,F.isLoading,e.isLoading]);const we=t.useMemo(()=>p.enablePagination!=!1?h:e.recordCount,[p.enablePagination,h,e.recordCount]);t.useEffect(()=>{e.setRecords(i??ke??[])},[i,ke]);const es=t.useCallback(({event:l,record:d,index:C,column:k,columnIndex:w})=>{if(k.accessor!=Oe){if(r.onCellClick)r.onCellClick({event:l,record:d,index:C,column:k,columnIndex:w});else if(r.onRowClick)r.onRowClick(d,C,l);else if(p.modelType){const R=p.modelField??"pk",Y=de(d,R);if(Y){ee(l);const ie=le(p.modelType,Y);ae(ie,T,l)}}}},[r.onRowClick,r.onCellClick]),ss=t.useMemo(()=>!!r.onCellContextMenu||!!r.rowActions||!!r.modelType,[r.onCellContextMenu,r.rowActions,r.modelType]),ns=({record:l,column:d,event:C})=>{if(d?.noContext===!0)return;if(r.onCellContextMenu)return r.onCellContextMenu(l,C);const k=()=>{};let w=[];if(r.rowActions&&(w=r.rowActions(l).map(R=>({key:R.title??"",title:R.title??"",color:R.color,icon:R.icon,onClick:R.onClick??k,hidden:R.hidden,disabled:R.disabled}))),r.modelType&&r.detailAction!==!1){const R=r.modelField??"pk",Y=de(l,R),ie=le(r.modelType,Y),Te=gs[r.modelType]?.label?.();let Ie=o._({id:"2Eoi/a"});Te&&(Ie=o._({id:"qWfvys",values:{model:Te}})),w.push({key:"detail",title:Ie,icon:s.jsx(Ge,{}),onClick:Me=>{ee(Me),ae(ie,T,Me)}})}return L(w)(C)},_e=t.useCallback(l=>{m(l),e.setPage(1),e.refreshTable()},[]),ts=t.useMemo(()=>{if(r.rowExpansion)return{...r.rowExpansion,expanded:{recordIds:e.expandedRecords,onRecordIdsChange:l=>{e.setExpandedRecords(l)}}}},[e.expandedRecords,e.setExpandedRecords,r.rowExpansion]),is=t.useMemo(()=>{let l={};return p.enablePagination&&(l={...l,totalRecords:e.recordCount,recordsPerPage:we,page:Math.max(1,e.page),onPageChange:e.setPage,recordsPerPageOptions:pn,onRecordsPerPageChange:_e}),l},[we,p.enablePagination,e.recordCount,e.page,e.setPage,_e]),os=t.useMemo(()=>!!(p.onCellClick||p.onRowClick||p.modelType),[p.onCellClick,p.onRowClick,p.modelType]);return s.jsx(s.Fragment,{children:s.jsxs(V,{gap:"xs",children:[!p.noHeader&&s.jsx(ue,{label:`InvenTreeTableHeader-${b}`,children:s.jsx(fn,{tableUrl:n,tableState:e,tableProps:p,hasSwitchableColumns:P,columns:O,filters:$,toggleColumn:se})}),s.jsx(ue,{label:`InvenTreeTable-${b}`,children:s.jsx(ps,{pos:"relative",children:s.jsx(Os,{style:{stickyHeader:B?"top":void 0},height:B?"80vh":void 0,withTableBorder:!p.noHeader,withColumnBorders:!0,striped:!0,highlightOnHover:!0,loaderType:u.loader,pinLastColumn:p.rowActions!=null,idAccessor:e.idAccessor??"pk",minHeight:p.minHeight??300,sortStatus:E,onSortStatusChange:We,selectedRecords:K?e.selectedRecords:void 0,onSelectedRecordsChange:K?U:void 0,rowExpansion:ts,fetching:te,noRecordsText:Ye,records:e.records,storeColumnsKey:b,columns:Q.effectiveColumns,onCellClick:os?es:void 0,noHeader:p.noHeader??!1,defaultColumnProps:{textAlign:"left"},onCellContextMenu:ss?ns:void 0,...is})})})]})})}export{ye as A,Dn as B,qn as C,On as D,Pn as E,hn as F,Ln as H,Bn as I,En as O,rn as P,Mn as R,tn as S,An as a,zn as b,Tn as c,In as d,on as e,ln as f,an as g,sn as h,Zs as i,Rn as j,Sn as u};
//# sourceMappingURL=InvenTreeTable-DmN557zY.js.map
