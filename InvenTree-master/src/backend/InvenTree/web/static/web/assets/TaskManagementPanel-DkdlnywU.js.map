{"version":3,"mappings":"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","names":["__iconNode","IconTrashXFilled","createReactComponent","FailedTasksTable","onRecordsUpdated","table","useTable","user","useUserState","error","setError","useState","opened","open","close","useDisclosure","columns","useMemo","accessor","title","_i18n","_","id","sortable","switchable","jsxs","Fragment","jsx","Drawer","StylishText","split","map","line","index","Text","InvenTreeTable","apiUrl","ApiEndpoints","task_failed_list","enableBulkDelete","isStaff","afterBulkDelete","enableSelection","onRowClick","row","result","hideNotification","showNotification","message","color","icon","IconExclamationCircle","PendingTasksTable","tableActions","ActionButton","api","delete","task_pending_list","then","notifications","show","refreshTable","catch","err","response","data","non_field_errors","IconX","hasAddRole","UserRoles","admin","enableSearch","ScheduledTasksTable","Loadable","lazy","TaskManagementPanel","instance","taskInfo","refreshInstance","refreshTaskInfo","useInstance","endpoint","task_overview","hasPrimaryKey","refetchOnMount","defaultValue","updateInterval","is_running","Alert","errorCodeLink","Stack","FactCollection","value","pending_tasks","scheduled_tasks","failed_tasks","Divider","Accordion"],"ignoreList":[0],"sources":["../../../../../../frontend/node_modules/@tabler/icons-react/dist/esm/icons/IconTrashXFilled.mjs","../../../../../../frontend/src/tables/settings/FailedTasksTable.tsx","../../../../../../frontend/src/tables/settings/PendingTasksTable.tsx","../../../../../../frontend/src/pages/Index/Settings/AdminCenter/TaskManagementPanel.tsx"],"sourcesContent":["/**\n * @license @tabler/icons-react v3.34.1 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nconst __iconNode = [[\"path\", { \"d\": \"M20 6a1 1 0 0 1 .117 1.993l-.117 .007h-.081l-.919 11a3 3 0 0 1 -2.824 2.995l-.176 .005h-8c-1.598 0 -2.904 -1.249 -2.992 -2.75l-.005 -.167l-.923 -11.083h-.08a1 1 0 0 1 -.117 -1.993l.117 -.007h16zm-9.489 5.14a1 1 0 0 0 -1.218 1.567l1.292 1.293l-1.292 1.293l-.083 .094a1 1 0 0 0 1.497 1.32l1.293 -1.292l1.293 1.292l.094 .083a1 1 0 0 0 1.32 -1.497l-1.292 -1.293l1.292 -1.293l.083 -.094a1 1 0 0 0 -1.497 -1.32l-1.293 1.292l-1.293 -1.292l-.094 -.083z\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M14 2a2 2 0 0 1 2 2a1 1 0 0 1 -1.993 .117l-.007 -.117h-4l-.007 .117a1 1 0 0 1 -1.993 -.117a2 2 0 0 1 1.85 -1.995l.15 -.005h4z\", \"key\": \"svg-1\" }]];\nconst IconTrashXFilled = createReactComponent(\"filled\", \"trash-x-filled\", \"TrashXFilled\", __iconNode);\n\nexport { __iconNode, IconTrashXFilled as default };\n//# sourceMappingURL=IconTrashXFilled.mjs.map\n","import { t } from '@lingui/core/macro';\nimport { Drawer, Text } from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport { hideNotification, showNotification } from '@mantine/notifications';\nimport { IconExclamationCircle } from '@tabler/icons-react';\nimport { useMemo, useState } from 'react';\n\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { StylishText } from '../../components/items/StylishText';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport { InvenTreeTable } from '../InvenTreeTable';\n\nexport default function FailedTasksTable({\n  onRecordsUpdated\n}: Readonly<{\n  onRecordsUpdated: () => void;\n}>) {\n  const table = useTable('tasks-failed');\n  const user = useUserState();\n\n  const [error, setError] = useState<string>('');\n\n  const [opened, { open, close }] = useDisclosure(false);\n\n  const columns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'func',\n        title: t`Task`,\n        sortable: true,\n        switchable: false\n      },\n      {\n        accessor: 'pk',\n        title: t`Task ID`\n      },\n      {\n        accessor: 'started',\n        title: t`Started`,\n        sortable: true,\n        switchable: false\n      },\n      {\n        accessor: 'stopped',\n        title: t`Stopped`,\n        sortable: true,\n        switchable: false\n      },\n      {\n        accessor: 'attempt_count',\n        title: t`Attempts`\n      }\n    ];\n  }, []);\n\n  return (\n    <>\n      <Drawer\n        opened={opened}\n        size='xl'\n        position='right'\n        title={<StylishText>{t`Error Details`}</StylishText>}\n        onClose={close}\n      >\n        {error.split('\\n').map((line: string, index: number) => {\n          return (\n            <Text key={`error-${index}`} size='sm'>\n              {line}\n            </Text>\n          );\n        })}\n      </Drawer>\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.task_failed_list)}\n        tableState={table}\n        columns={columns}\n        props={{\n          enableBulkDelete: user.isStaff(),\n          afterBulkDelete: onRecordsUpdated,\n          enableSelection: true,\n          onRowClick: (row: any) => {\n            if (row.result) {\n              setError(row.result);\n              open();\n            } else {\n              hideNotification('failed-task');\n              showNotification({\n                id: 'failed-task',\n                title: t`No Information`,\n                message: t`No error details are available for this task`,\n                color: 'red',\n                icon: <IconExclamationCircle />\n              });\n            }\n          }\n        }}\n      />\n    </>\n  );\n}\n","import { t } from '@lingui/core/macro';\nimport { useMemo } from 'react';\n\nimport { ActionButton } from '@lib/components/ActionButton';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { notifications, showNotification } from '@mantine/notifications';\nimport { IconTrashXFilled, IconX } from '@tabler/icons-react';\nimport { api } from '../../App';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport { InvenTreeTable } from '../InvenTreeTable';\n\nexport default function PendingTasksTable({\n  onRecordsUpdated\n}: Readonly<{\n  onRecordsUpdated: () => void;\n}>) {\n  const table = useTable('tasks-pending');\n  const user = useUserState();\n\n  const columns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'func',\n        title: t`Task`,\n        switchable: false\n      },\n      {\n        accessor: 'task_id',\n        title: t`Task ID`\n      },\n      {\n        accessor: 'name',\n        title: t`Name`\n      },\n      {\n        accessor: 'lock',\n        title: t`Created`,\n        sortable: false,\n        switchable: false\n      },\n      {\n        accessor: 'args',\n        title: t`Arguments`\n      },\n      {\n        accessor: 'kwargs',\n        title: t`Keywords`\n      }\n    ];\n  }, []);\n\n  const tableActions = useMemo(() => {\n    return [\n      <ActionButton\n        key='remove-all'\n        icon={<IconTrashXFilled />}\n        tooltip={t`Remove all pending tasks`}\n        onClick={() => {\n          api\n            .delete(`${apiUrl(ApiEndpoints.task_pending_list)}?all=true`)\n            .then(() => {\n              notifications.show({\n                id: 'notes',\n                title: t`Success`,\n                message: t`All pending tasks deleted`,\n                color: 'green'\n              });\n              table.refreshTable();\n            })\n            .catch((err) => {\n              showNotification({\n                title: t`Error while deleting all pending tasks`,\n                message:\n                  err.response.data?.non_field_errors ??\n                  err.message ??\n                  t`Unknown error`,\n                color: 'red',\n                icon: <IconX />\n              });\n            });\n        }}\n        hidden={!user.hasAddRole(UserRoles.admin)}\n      />\n    ];\n  }, [user]);\n\n  return (\n    <InvenTreeTable\n      url={apiUrl(ApiEndpoints.task_pending_list)}\n      tableState={table}\n      columns={columns}\n      props={{\n        afterBulkDelete: onRecordsUpdated,\n        enableBulkDelete: user.isStaff(),\n        enableSelection: true,\n        enableSearch: false,\n        tableActions: tableActions\n      }}\n    />\n  );\n}\n","import { t } from '@lingui/core/macro';\nimport { Accordion, Alert, Divider, Stack, Text } from '@mantine/core';\nimport { lazy } from 'react';\n\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { StylishText } from '../../../../components/items/StylishText';\nimport { errorCodeLink } from '../../../../components/nav/Alerts';\nimport { FactCollection } from '../../../../components/settings/FactCollection';\nimport { Loadable } from '../../../../functions/loading';\nimport { useInstance } from '../../../../hooks/UseInstance';\nimport FailedTasksTable from '../../../../tables/settings/FailedTasksTable';\nimport PendingTasksTable from '../../../../tables/settings/PendingTasksTable';\n\nconst ScheduledTasksTable = Loadable(\n  lazy(() => import('../../../../tables/settings/ScheduledTasksTable'))\n);\n\nexport default function TaskManagementPanel() {\n  const { instance: taskInfo, refreshInstance: refreshTaskInfo } = useInstance({\n    endpoint: ApiEndpoints.task_overview,\n    hasPrimaryKey: false,\n    refetchOnMount: true,\n    defaultValue: {},\n    updateInterval: 30 * 1000\n  });\n\n  return (\n    <>\n      {taskInfo?.is_running == false && (\n        <Alert title={t`Background worker not running`} color='red'>\n          <Text>{t`The background task manager service is not running. Contact your system administrator.`}</Text>\n          {errorCodeLink('INVE-W5')}\n        </Alert>\n      )}\n      <Stack gap='xs'>\n        <FactCollection\n          items={[\n            { title: t`Pending Tasks`, value: taskInfo?.pending_tasks },\n            { title: t`Scheduled Tasks`, value: taskInfo?.scheduled_tasks },\n            { title: t`Failed Tasks`, value: taskInfo?.failed_tasks }\n          ]}\n        />\n        <Divider />\n        <Accordion defaultValue='pending'>\n          <Accordion.Item value='pending' key='pending-tasks'>\n            <Accordion.Control>\n              <StylishText size='lg'>{t`Pending Tasks`}</StylishText>\n            </Accordion.Control>\n            <Accordion.Panel>\n              <PendingTasksTable onRecordsUpdated={refreshTaskInfo} />\n            </Accordion.Panel>\n          </Accordion.Item>\n          <Accordion.Item value='scheduled' key='scheduled-tasks'>\n            <Accordion.Control>\n              <StylishText size='lg'>{t`Scheduled Tasks`}</StylishText>\n            </Accordion.Control>\n            <Accordion.Panel>\n              <ScheduledTasksTable />\n            </Accordion.Panel>\n          </Accordion.Item>\n          <Accordion.Item value='failed' key='failed-tasks'>\n            <Accordion.Control>\n              <StylishText size='lg'>{t`Failed Tasks`}</StylishText>\n            </Accordion.Control>\n            <Accordion.Panel>\n              <FailedTasksTable onRecordsUpdated={refreshTaskInfo} />\n            </Accordion.Panel>\n          </Accordion.Item>\n        </Accordion>\n      </Stack>\n    </>\n  );\n}\n"],"file":"TaskManagementPanel-DkdlnywU.js"}